<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Celia García Márquez ">
<meta name="description" content="Introducción Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.
La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo DROP.
NAT 1.Las máquinas de nuestra red tienen que tener acceso al exterior Estas reglas de iptables ya estaban configuradas en ejercicios anteriores, son las siguientes:
up iptables -t nat -A POSTROUTING -s 10." />
<meta name="keywords" content="blogs, cortafuegos, iptables" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/cortafuegos-perimetral.-iptables/" />


    <title>
        
            Cortafuegos perimetral. Iptables :: Un bit de informacion cada día  — Hello Friend NG Theme
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://unbitdeinformacioncadadia.netlify.app/main.393856bf2c430bb6c01d7af07c6fe966e7cce8073435cfbbc46e590bab7405ef.css">


    
        <link rel="stylesheet" type="text/css" href="css/style.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="https://unbitdeinformacioncadadia.netlify.app/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://unbitdeinformacioncadadia.netlify.app/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://unbitdeinformacioncadadia.netlify.app/favicon-16x16.png">
    <link rel="manifest" href="https://unbitdeinformacioncadadia.netlify.app/site.webmanifest">
    <link rel="mask-icon" href="https://unbitdeinformacioncadadia.netlify.app/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://unbitdeinformacioncadadia.netlify.app/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="Cortafuegos perimetral. Iptables">
<meta itemprop="description" content="Introducción Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.
La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo DROP.
NAT 1.Las máquinas de nuestra red tienen que tener acceso al exterior Estas reglas de iptables ya estaban configuradas en ejercicios anteriores, son las siguientes:
up iptables -t nat -A POSTROUTING -s 10.">
<meta itemprop="datePublished" content="2021-01-25T17:15:21+01:00" />
<meta itemprop="dateModified" content="2021-01-25T17:15:21+01:00" />
<meta itemprop="wordCount" content="3099">
<meta itemprop="image" content="https://unbitdeinformacioncadadia.netlify.app/images/avatar_red.jpg"/>



<meta itemprop="keywords" content="cortafuegos,iptables," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://unbitdeinformacioncadadia.netlify.app/images/avatar_red.jpg"/>

<meta name="twitter:title" content="Cortafuegos perimetral. Iptables"/>
<meta name="twitter:description" content="Introducción Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.
La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo DROP.
NAT 1.Las máquinas de nuestra red tienen que tener acceso al exterior Estas reglas de iptables ya estaban configuradas en ejercicios anteriores, son las siguientes:
up iptables -t nat -A POSTROUTING -s 10."/>



    <meta property="og:title" content="Cortafuegos perimetral. Iptables" />
<meta property="og:description" content="Introducción Vamos a construir un cortafuegos en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.
La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo DROP.
NAT 1.Las máquinas de nuestra red tienen que tener acceso al exterior Estas reglas de iptables ya estaban configuradas en ejercicios anteriores, son las siguientes:
up iptables -t nat -A POSTROUTING -s 10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/cortafuegos-perimetral.-iptables/" />
<meta property="og:image" content="https://unbitdeinformacioncadadia.netlify.app/images/avatar_red.jpg"/>
<meta property="article:published_time" content="2021-01-25T17:15:21+01:00" />
<meta property="article:modified_time" content="2021-01-25T17:15:21+01:00" />






    <meta property="article:published_time" content="2021-01-25 17:15:21 &#43;0100 CET" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://unbitdeinformacioncadadia.netlify.app/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://unbitdeinformacioncadadia.netlify.app/posts/">Blog</a></li><li><a href="https://unbitdeinformacioncadadia.netlify.app/about/">Contacto</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        15 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/cortafuegos-perimetral.-iptables/">Cortafuegos perimetral. Iptables</a>
      </h1>

      

      <div class="post-content">
        <h2 id="introducción">Introducción</h2>
<p>Vamos a construir un <strong>cortafuegos</strong> en dulcinea que nos permita controlar el tráfico de nuestra red. El cortafuegos que vamos a construir debe funcionar tras un reinicio.</p>
<p>La política por defecto que vamos a configurar en nuestro cortafuegos será de tipo <strong>DROP</strong>.</p>
<h3 id="nat">NAT</h3>
<h3 id="1las-máquinas-de-nuestra-red-tienen-que-tener-acceso-al-exterior">1.Las máquinas de nuestra red tienen que tener acceso al exterior</h3>
<p>Estas reglas de iptables ya estaban configuradas en ejercicios anteriores, son las siguientes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">up iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -o eth0 -j MASQUERADE
up iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -o eth0 -j MASQUERADE
</code></pre></div><p>Pero lo vamos a cambiar de forma que esté configurado con la dirección estática. Estas reglas las modificaremos en el fichero <strong>/etc/network/interfaces</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">up iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -o eth0 -j SNAT --to 10.0.0.3
up iptables -t nat -A POSTROUTING -s 10.0.2.0/24 -o eth0 -j SNAT --to 10.0.0.3
</code></pre></div><p>Reiniciamos el servicio y vemos que se ha configurado correctamente. Además podemos ver que tenemos otras reglas ya configuraras para los diferentes servicios que hemos ido configurando a lo largo del curso. Aunque aquí lo único que nos interesan son las lineas de SNAT.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables -t nat -L -nv
Chain PREROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">352</span> packets, <span style="color:#ae81ff">28200</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.0.2.4:80
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 to:10.0.2.4:443
    <span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">94</span> DNAT       udp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            udp dpt:53 to:10.0.1.2:53
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:25 to:10.0.1.2:25

Chain INPUT <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">12</span> packets, <span style="color:#ae81ff">2103</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination

Chain POSTROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">44</span> packets, <span style="color:#ae81ff">2953</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
  <span style="color:#ae81ff">329</span> <span style="color:#ae81ff">24699</span> SNAT       all  --  *      eth0    10.0.1.0/24          0.0.0.0/0            to:10.0.0.3
    <span style="color:#ae81ff">5</span>   <span style="color:#ae81ff">396</span> SNAT       all  --  *      eth0    10.0.2.0/24          0.0.0.0/0            to:10.0.0.3

Chain OUTPUT <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">39</span> packets, <span style="color:#ae81ff">2584</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
</code></pre></div><ul>
<li>Comprobamos que tenemos acceso al exterior desde todas las máquinas del escenario</li>
</ul>
<blockquote>
<p>Suponemos que tenemos bien configurado nuestro servidor DNS que es Freston y que en el fichero /etc/resolv.conf de cada máquina estamos apuntando a él (10.0.1.2)</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#Dulcinea</span>

debian@dulcinea:~$ ping www.google.es
PING www.google.es <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">112</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">231</span> ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">112</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">306</span> ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">112</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">198</span> ms
^C
--- www.google.es ping statistics ---
<span style="color:#ae81ff">4</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 25% packet loss, time 6ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 198.016/245.154/306.043/45.161 ms


<span style="color:#75715e">#Freston</span>
debian@freston:~$ ping www.google.es
PING www.google.es <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>69.7 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>42.10 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>67.8 ms
^C
--- www.google.es ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 5ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 42.993/60.184/69.743/12.183 ms


<span style="color:#75715e">#Sancho</span>

ubuntu@sancho:~$ ping www.google.es
PING www.google.es <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>55.4 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>44.5 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>48.7 ms
^C
--- www.google.es ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 44.477/49.522/55.356/4.476 ms

<span style="color:#75715e">#Quijote</span>
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ping www.google.es
PING www.google.es <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>47.6 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>42.4 ms
<span style="color:#ae81ff">64</span> bytes from mad41s10-in-f3.1e100.net <span style="color:#f92672">(</span>142.250.184.3<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">111</span> time<span style="color:#f92672">=</span>43.5 ms
^C
--- www.google.es ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 449ms

</code></pre></div><h3 id="2-configura-de-manera-adecuada-todas-las-reglas-nat-necesarias-para-que-los-servicios-expuestos-al-exterior-sean-accesibles">2. Configura de manera adecuada todas las reglas NAT necesarias para que los servicios expuestos al exterior sean accesibles.</h3>
<p>Tenemos dos servicios: Servidor DNS y Servidor Web</p>
<h3 id="servidor-dns-freston">Servidor DNS (FRESTON)</h3>
<p>Para ello necesitaremos tener bien configurado nuestro servidor DNS y las reglas pertintentes en Dulcinea para que funcione correctamente de forma que:</p>
<ul>
<li>Esta regla ya la teniamos agregada previamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo iptables -t nat -A PREROUTING -p udp --dport <span style="color:#ae81ff">53</span> -i eth0 -j DNAT --to 10.0.1.2:53
</code></pre></div><ul>
<li>Funciona después de cada reinicio porque hemos instalado un paquete llamado <code>iptables-persistent</code></li>
</ul>
<p>Si editamos el fichero donde tenemos guardadas las reglas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nano /etc/iptables/rules.v4
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">. . .
. . .

<span style="color:#75715e"># Regla para que se puedan realizar consultas desde fuera nuestro DNS</span>

-A PREROUTING -i eth0 -p udp -m udp --dport <span style="color:#ae81ff">53</span> -j DNAT --to-destination 10.0.1.2:53

. . .
. . .

</code></pre></div><ul>
<li>Comprobamos que podemos hacer una consulta desde el exterior y responde correctamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~$ dig @172.22.200.222 ns celia.gonzalonazareno.org

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u3-Debian &lt;&lt;&gt;&gt; @172.22.200.222 ns celia.gonzalonazareno.org
; <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> server found<span style="color:#f92672">)</span>
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER<span style="color:#e6db74">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span style="color:#ae81ff">26194</span>
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: <span style="color:#ae81ff">2</span>

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: <span style="color:#ae81ff">4096</span>
; COOKIE: e11a461c6588fede6608354360421f03b7895a49c1216c3f <span style="color:#f92672">(</span>good<span style="color:#f92672">)</span>
;; QUESTION SECTION:
;celia.gonzalonazareno.org.	IN	NS

;; ANSWER SECTION:
celia.gonzalonazareno.org. <span style="color:#ae81ff">86400</span> IN	NS	dulcinea.celia.gonzalonazareno.org.

;; ADDITIONAL SECTION:
dulcinea.celia.gonzalonazareno.org. <span style="color:#ae81ff">86400</span> IN A	172.22.200.222

;; Query time: <span style="color:#ae81ff">73</span> msec
;; SERVER: 172.22.200.222#53<span style="color:#f92672">(</span>172.22.200.222<span style="color:#f92672">)</span>
;; WHEN: vie mar <span style="color:#ae81ff">05</span> 13:07:31 CET <span style="color:#ae81ff">2021</span>
;; MSG SIZE  rcvd: <span style="color:#ae81ff">121</span>

</code></pre></div><h3 id="servidor-web-quijote">Servidor web (Quijote)</h3>
<p>Nuestro servidor web nos ofrece servicio por el puerto 80 y por el puerto 443 (https), ya teniamos nuestras reglas agregadas que son las siguientes, también contempladas en el fichero de /etc/iptables/rules.v4</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># para usar http puerto 80</span>

sudo iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">80</span> -i eth0 -j DNAT --to 10.0.2.4:80


<span style="color:#75715e"># Para usar https puerto 443</span>

iptables -A OUTPUT -p tcp -m tcp --dport <span style="color:#ae81ff">443</span> -j ACCEPT

sudo iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">443</span> -i eth0 -j DNAT --to 10.0.2.4:443

</code></pre></div><p>Fucionamiento:</p>
<p>Si entramos en la página web <a href="http://www.celia.gonzalonazareno.org">www.celia.gonzalonazareno.org</a></p>
<p><img src="https://unbitdeinformacioncadadia.netlify.app/images/cortafuegos/bienvenido.png" alt="bienvenido.png"></p>
<p>Podemos ver que se han utilizado las dos reglas que hemos añadido</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables -t nat -L -nv
Chain PREROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">416</span> packets, <span style="color:#ae81ff">34596</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">5</span>   <span style="color:#ae81ff">300</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.0.2.4:80
    <span style="color:#ae81ff">5</span>   <span style="color:#ae81ff">300</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 to:10.0.2.4:443

. . .
. . .
</code></pre></div><h2 id="reglas">Reglas</h2>
<h2 id="ping">PING</h2>
<ul>
<li>Tenemos que hacer ping desde todas las maquinas</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Desde dulcinea</span>
debian@dulcinea:~$ ping sancho
PING sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>1.10 ms
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.681 ms
^C
--- sancho.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 3ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.681/0.888/1.095/0.207 ms
debian@dulcinea:~$ ping freston
PING freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.435 ms
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.808 ms
^C
--- freston.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 3ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.435/0.621/0.808/0.188 ms
debian@dulcinea:~$ ping quijote
PING quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>1.17 ms
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.966 ms
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.696 ms
^C
--- quijote.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 5ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.696/0.945/1.173/0.195 ms


<span style="color:#75715e"># Desde freston</span>

debian@freston:~$ ping dulcinea.celia.gonzalonazareno.org
PING dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.469 ms
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.642 ms
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.518 ms
^C
--- dulcinea.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 53ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.469/0.543/0.642/0.072 ms
debian@freston:~$ ping quijote.celia.gonzalonazareno.org
PING quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.47 ms
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.26 ms
^C
--- quijote.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 3ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 1.261/1.364/1.467/0.103 ms
debian@freston:~$ ping sancho.celia.gonzalonazareno.org
PING sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>1.18 ms
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.672 ms
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.592 ms
^C
--- sancho.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 5ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.592/0.816/1.184/0.262 ms


<span style="color:#75715e">## Desde quijote</span>

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ping freston.celia.gonzalonazareno.org
PING freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.18 ms
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.09 ms
^C
--- freston.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 3ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 1.086/1.134/1.182/0.048 ms

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ping dulcinea.celia.gonzalonazareno.org
PING dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.370 ms
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.773 ms
^C
--- dulcinea.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 1ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.370/0.571/0.773/0.202 ms

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ping sancho.celia.gonzalonazareno.org
PING sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>0.745 ms
<span style="color:#ae81ff">64</span> bytes from sancho.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.11<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.27 ms
^C
--- sancho.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 2ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.745/1.007/1.270/0.264 ms

<span style="color:#75715e"># Desde sancho</span>

ubuntu@sancho:~$ ping dulcinea.celia.gonzalonazareno.org
PING dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.611 ms
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.573 ms
<span style="color:#ae81ff">64</span> bytes from dulcinea.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.6<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.568 ms
^C
--- dulcinea.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, 0% packet loss, time 2033ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.568/0.584/0.611/0.019 ms
ubuntu@sancho:~$ ping quijote.celia.gonzalonazareno.org
PING quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.33 ms
<span style="color:#ae81ff">64</span> bytes from quijote.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.2.4<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span> time<span style="color:#f92672">=</span>1.09 ms
^C
--- quijote.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 1.088/1.206/1.325/0.118 ms
ubuntu@sancho:~$ ping freston.celia.gonzalonazareno.org
PING freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.429 ms
<span style="color:#ae81ff">64</span> bytes from freston.celia.gonzalonazareno.org <span style="color:#f92672">(</span>10.0.1.2<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.537 ms
^C
--- freston.celia.gonzalonazareno.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.429/0.483/0.537/0.054 ms


</code></pre></div><h3 id="1-ssh">1. SSH</h3>
<ul>
<li>1.1. Acceder por ssh a todas las máquinas</li>
</ul>
<h4 id="ssh-dulcinea-a-quijote---sancho---freston">SSH DULCINEA A [QUIJOTE - SANCHO - FRESTON]</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">## SSH desde DULCINEA AL RESTO DE MAQUINAS</span>

debian@dulcinea:~$ ssh freston
Linux freston 4.19.0-13-cloud-amd64 <span style="color:#75715e">#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
You have mail.
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 12:46:53 <span style="color:#ae81ff">2021</span> from 10.0.1.6
debian@freston:~$ exit
logout
Connection to freston closed.
debian@dulcinea:~$ ssh centos@quijote
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 13:13:31 <span style="color:#ae81ff">2021</span> from 10.0.2.10
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ exit
logout
Connection to quijote closed.
debian@dulcinea:~$ ssh ubuntu@sancho
Welcome to Ubuntu 20.04.1 LTS <span style="color:#f92672">(</span>GNU/Linux 5.4.0-60-generic x86_64<span style="color:#f92672">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Mar  <span style="color:#ae81ff">5</span> 13:46:27 CET <span style="color:#ae81ff">2021</span>

  System load:  0.08              Processes:             <span style="color:#ae81ff">108</span>
  Usage of /:   37.5% of 9.52GB   Users logged in:       <span style="color:#ae81ff">1</span>
  Memory usage: 69%               IPv4 address <span style="color:#66d9ef">for</span> ens3: 10.0.1.11
  Swap usage:   0%

 * Introducing self-healing high availability clusters in MicroK8s.
   Simple, hardened, Kubernetes <span style="color:#66d9ef">for</span> production, from RaspberryPi to DC.

     https://microk8s.io/high-availability

<span style="color:#ae81ff">63</span> updates can be installed immediately.
<span style="color:#ae81ff">0</span> of these updates are security updates.
To see these additional updates run: apt list --upgradable


*** System restart required ***
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 12:47:25 <span style="color:#ae81ff">2021</span> from 10.0.1.6
ubuntu@sancho:~$ exit
logout
Connection to sancho closed.
</code></pre></div><h4 id="ssh-red-interna---red-dmz">SSH RED INTERNA - RED DMZ</h4>
<p>Vamos a crear dos reglas iptables del tipo FORWARD para poder acceder desde la red interna a la DMZ y viceversa. Las reglas son las siguientes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport <span style="color:#ae81ff">22</span> -m state --state ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i eth2 -o eth1 -p tcp --sport <span style="color:#ae81ff">22</span> -m state --state ESTABLISHED -j ACCEPT
</code></pre></div><p>Comprobamos que se han añadido las reglas correctamente</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables --list
Chain INPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination

Chain FORWARD <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED

Chain OUTPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https

</code></pre></div><h5 id="funcionamiento">Funcionamiento</h5>
<p>Comprobamos que podemos entrar por ssh desde freston a quijote y viceversa</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">## Desde freston entramos a quijote y viceversa.</span>

debian@freston:~$ ssh -A centos@quijote.celia.gonzalonazareno.org
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 18:29:25 <span style="color:#ae81ff">2021</span> from 10.0.1.2

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ hostname
quijote
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ssh debian@freston.celia.gonzalonazareno.org
Linux freston 4.19.0-13-cloud-amd64 <span style="color:#75715e">#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
You have mail.
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 18:29:49 <span style="color:#ae81ff">2021</span> from 10.0.2.4

debian@freston:~$ hostname
freston

<span style="color:#75715e">## Desde quijote entramos a sancho y viceversa</span>

<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ ssh -A ubuntu@sancho.celia.gonzalonazareno.org
Welcome to Ubuntu 20.04.1 LTS <span style="color:#f92672">(</span>GNU/Linux 5.4.0-60-generic x86_64<span style="color:#f92672">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Mar  <span style="color:#ae81ff">5</span> 18:38:53 CET <span style="color:#ae81ff">2021</span>

  System load:  0.0               Processes:             <span style="color:#ae81ff">107</span>
  Usage of /:   37.5% of 9.52GB   Users logged in:       <span style="color:#ae81ff">1</span>
  Memory usage: 63%               IPv4 address <span style="color:#66d9ef">for</span> ens3: 10.0.1.11
  Swap usage:   0%

 * Introducing self-healing high availability clusters in MicroK8s.
   Simple, hardened, Kubernetes <span style="color:#66d9ef">for</span> production, from RaspberryPi to DC.

     https://microk8s.io/high-availability

<span style="color:#ae81ff">63</span> updates can be installed immediately.
<span style="color:#ae81ff">0</span> of these updates are security updates.
To see these additional updates run: apt list --upgradable


*** System restart required ***
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 18:38:44 <span style="color:#ae81ff">2021</span> from 10.0.2.4
ubuntu@sancho:~$ hostname
sancho
ubuntu@sancho:~$ ssh -A centos@quijote.celia.gonzalonazareno.org
The authenticity of host <span style="color:#e6db74">&#39;quijote.celia.gonzalonazareno.org (10.0.2.4)&#39;</span> can<span style="color:#e6db74">&#39;t be established.
</span><span style="color:#e6db74">ECDSA key fingerprint is SHA256:pZTEnytfMqYmtRT/lWIqyDRJAXcbawGuxNeVWCSNQRU.
</span><span style="color:#e6db74">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span style="color:#e6db74">Warning: Permanently added &#39;</span>quijote.celia.gonzalonazareno.org<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span> to the list of known hosts.
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 18:38:28 <span style="color:#ae81ff">2021</span> from 10.0.2.10
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ hostname
quijote

</code></pre></div><ul>
<li>1.2. Todas las máquinas pueden hacer ssh a máquinas del exterior</li>
</ul>
<p>Para ello añadimos las siguientes reglas que aceptan las conexiones ssh tanto de entrada como de salida en dulcinea</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo iptables -A OUTPUT -o eth0 -p tcp --dport <span style="color:#ae81ff">22</span> -j ACCEPT
sudo iptables -A OUTPUT -o eth0 -p tcp --dport <span style="color:#ae81ff">22</span> -j ACCEPT
</code></pre></div><p>Comprobamos que se han añadido</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables -t nat -L -nv
Chain PREROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">63</span> packets, <span style="color:#ae81ff">6533</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.0.2.4:80
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 to:10.0.2.4:443
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       udp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            udp dpt:53 to:10.0.1.2:53
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:25 to:10.0.1.2:25

Chain INPUT <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">6</span> packets, <span style="color:#ae81ff">1475</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination

Chain POSTROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">21</span> packets, <span style="color:#ae81ff">1512</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
   <span style="color:#ae81ff">52</span>  <span style="color:#ae81ff">4103</span> SNAT       all  --  *      eth0    10.0.1.0/24          0.0.0.0/0            to:10.0.0.3
    <span style="color:#ae81ff">3</span>   <span style="color:#ae81ff">228</span> SNAT       all  --  *      eth0    10.0.2.0/24          0.0.0.0/0            to:10.0.0.3

Chain OUTPUT <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">21</span> packets, <span style="color:#ae81ff">1512</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables --list
Chain INPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination

Chain FORWARD <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED

Chain OUTPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https

</code></pre></div><h2 id="dns">DNS</h2>
<ul>
<li>El único dns que pueden usar los equipos de las dos redes es freston, no pueden utilizar un DNS externo.</li>
<li>Dulcinea puede usar cualquier servidor DNS.</li>
<li>Tenemos que permitir consultas dns desde el exterior a freston, para que, por ejemplo, papion-dns pueda preguntar.</li>
</ul>
<blockquote>
<p>Todas estos requisitos ya están dispuestos en anteriores ejercicios.</p>
</blockquote>
<p>Todas las máquinas en el fichero /etc/resolv.conf utilizan el servidor dns de Freston</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nameserver 10.0.1.2
search celia.gonzalonazareno.org
</code></pre></div><h2 id="base-de-datos">BASE DE DATOS</h2>
<ul>
<li>
<p>A la base de datos de sancho sólo pueden acceder las máquinas de la DMZ.</p>
<ul>
<li>En sancho:</li>
</ul>
</li>
</ul>
<p>Editamos el fichero</p>
<p><code>nano /etc/mysql/my.cnf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">port            <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>
</code></pre></div><p>Comprobamos que el puerto que esta utilizando en este caso es el puerto 3306.</p>
<p>Ademas en el mismo fichero nos aseguramos que están estas dos lineas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">...
skip-external-locking
bind-address            <span style="color:#f92672">=</span> 0.0.0.0
...
</code></pre></div><ul>
<li>En dulcinea:</li>
</ul>
<p>Agregamos las reglas de iptables de forma que bloqueamos las conexiones por el puerto 3306 y solo dejamos pasar a quijote con la ip 10.0.2.4</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo iptables -A INPUT -s 10.0.2.4 -p tcp --dport <span style="color:#ae81ff">3306</span> -j ACCEPT
sudo iptables -A OUTPUT -d 10.0.2.4 -p tcp --sport <span style="color:#ae81ff">3306</span> -j ACCEPT
iptables -A INPUT -p tcp --dport <span style="color:#ae81ff">3306</span> -j DROP
iptables -A OUTPUT -p tcp --dport <span style="color:#ae81ff">3306</span> -j DROP
</code></pre></div><ul>
<li>Comprobamos que estan añadidas</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables --list --line-numbers
Chain INPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
num  target     prot opt source               destination         
<span style="color:#ae81ff">1</span>    DROP       tcp  --  anywhere             anywhere             tcp dpt:mysql
<span style="color:#ae81ff">2</span>    ACCEPT     tcp  --  quijote.celia.gonzalonazareno.org  anywhere             tcp dpt:mysql
<span style="color:#ae81ff">3</span>    DROP       tcp  --  anywhere             anywhere             tcp dpt:mysql
<span style="color:#ae81ff">4</span>    ACCEPT     tcp  --  quijote.celia.gonzalonazareno.org  anywhere             tcp dpt:mysql

Chain FORWARD <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
num  target     prot opt source               destination         
<span style="color:#ae81ff">1</span>    ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED
<span style="color:#ae81ff">2</span>    ACCEPT     tcp  --  anywhere             anywhere             tcp spt:ssh state ESTABLISHED

Chain OUTPUT <span style="color:#f92672">(</span>policy ACCEPT<span style="color:#f92672">)</span>
num  target     prot opt source               destination         
<span style="color:#ae81ff">1</span>    ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https
<span style="color:#ae81ff">2</span>    ACCEPT     tcp  --  anywhere             quijote.celia.gonzalonazareno.org  tcp spt:mysql
<span style="color:#ae81ff">3</span>    DROP       tcp  --  anywhere             anywhere             tcp dpt:mysql

</code></pre></div><ul>
<li>Comprobamos que podemos acceder desde quijote a la base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ ssh centos@quijote
Last login: Fri Mar  <span style="color:#ae81ff">5</span> 20:35:52 <span style="color:#ae81ff">2021</span> from 10.0.2.10
<span style="color:#f92672">[</span>centos@quijote ~<span style="color:#f92672">]</span>$ mysql -u celia -p -h bd.celia.gonzalonazareno.org
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
Your MariaDB connection id is <span style="color:#ae81ff">133</span>
Server version: 10.4.17-MariaDB-1:10.4.17+maria~focal-log mariadb.org binary distribution

Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| db_quijote         |
| information_schema |
| mezzanine          |
| mysql              |
| performance_schema |
| wagtail            |
+--------------------+
<span style="color:#ae81ff">6</span> rows in set <span style="color:#f92672">(</span>0.002 sec<span style="color:#f92672">)</span>

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; 

</code></pre></div><h2 id="web">Web</h2>
<p>Las reglas aplicadas son estas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># para usar http puerto 80</span>

sudo iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">80</span> -i eth0 -j DNAT --to 10.0.2.4:80


<span style="color:#75715e"># Para usar https puerto 443</span>

iptables -A OUTPUT -p tcp -m tcp --dport <span style="color:#ae81ff">443</span> -j ACCEPT

sudo iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">443</span> -i eth0 -j DNAT --to 10.0.2.4:443
</code></pre></div><h2 id="servicio-de-correos">Servicio de correos</h2>
<p>Para el correo tenemos aplicada la siguiente regla</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">25</span> -i eth0 -j DNAT --to 10.0.1.2:25
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ae81ff">4</span>        <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:25 to:10.0.1.2:25
</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://unbitdeinformacioncadadia.netlify.app/tags/cortafuegos/">cortafuegos</a></span>
        <span class="tag"><a href="https://unbitdeinformacioncadadia.netlify.app/tags/iptables/">iptables</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        3099 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          25/01/2021 17:15
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Cortafuegos%20perimetral.%20Iptables&amp;caption=Cortafuegos%20perimetral.%20Iptables&amp;canonicalUrl=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Cortafuegos%20perimetral.%20Iptables&amp;body=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f&amp;media=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f;description=Cortafuegos%20perimetral.%20Iptables" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f&amp;title=Cortafuegos%20perimetral.%20Iptables&amp;summary=Cortafuegos%20perimetral.%20Iptables&amp;source=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f&amp;resubmit=true&amp;title=Cortafuegos%20perimetral.%20Iptables" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f;title=Cortafuegos%20perimetral.%20Iptables" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Cortafuegos%20perimetral.%20Iptables%20https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f&amp;t=Cortafuegos%20perimetral.%20Iptables" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Cortafuegos%20perimetral.%20Iptables&amp;url=https%3a%2f%2funbitdeinformacioncadadia.netlify.app%2fposts%2f2021%2f01%2fcortafuegos-perimetral.-iptables%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/02/gesti%C3%B3n-de-peticiones-y-rendimiento-de-servidores-web/">
                <span class="button__icon">←</span>
                <span class="button__text">Gestión de peticiones y rendimiento de servidores Web</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iii./">
                <span class="button__text">Servidor de Correos. Postfix (III).</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
                <span><a href="https://unbitdeinformacioncadadia.netlify.app/">Celia García Márquez</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://unbitdeinformacioncadadia.netlify.app/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://unbitdeinformacioncadadia.netlify.app/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
