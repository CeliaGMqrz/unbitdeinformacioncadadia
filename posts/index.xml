<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Un bit de informacion cada día</title>
    <link>https://unbitdeinformacioncadadia.netlify.app/posts/</link>
    <description>Recent content in Posts on Un bit de informacion cada día</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Mon, 25 Jan 2021 17:15:21 +0100</lastBuildDate><atom:link href="https://unbitdeinformacioncadadia.netlify.app/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Servidor de Correos. Postfix (III).</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iii./</link>
      <pubDate>Mon, 25 Jan 2021 17:15:21 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iii./</guid>
      <description>Gestión de correos desde un cliente Tarea 8: Configurar postfix con Maildir Descripción:
Configura el buzón de los usuarios de tipo Maildir. Envía un correo a tu usuario y comprueba que el correo se ha guardado en el buzón Maildir del usuario del sistema correspondiente. Recuerda que ese tipo de buzón no se puede leer con la utilidad mail.
Configuración:
 Para hacer esta tarea vamos a indicar a postfix en su configuración dónde se van a guardar los nuevos correos.</description>
<<<<<<< HEAD
            <content type="html"><![CDATA[<h2 id="gestión-de-correos-desde-un-cliente">Gestión de correos desde un cliente</h2>
<h3 id="tarea-8-configurar-postfix-con-maildir">Tarea 8: Configurar postfix con Maildir</h3>
<p><strong>Descripción:</strong></p>
<p>Configura el buzón de los usuarios de tipo Maildir. Envía un correo a tu usuario y comprueba que el correo se ha guardado en el buzón <strong>Maildir</strong> del usuario del sistema correspondiente. Recuerda que ese tipo de buzón no se puede leer con la utilidad mail.</p>
<p><strong>Configuración:</strong></p>
<ul>
<li>Para hacer esta tarea vamos a indicar a postfix en su configuración dónde se van a guardar los nuevos correos.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/postfix/main.cf
</code></pre></div><ul>
<li>Añadimos la siguiente línea</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">home_mailbox <span style="color:#f92672">=</span> Maildir/
</code></pre></div><ul>
<li>Reiniciamos el servicio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl restart postfix
</code></pre></div><ul>
<li>Ahora vamos a probar si se ha configurado correctamente para ello vamos a instalar el siguiente paquete</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get install mailutils
</code></pre></div><ul>
<li>Una vez instalado vamos a enviar un correo desde la cuenta de debian, comprobaremos que utilizando mail ya no aparece si no que se almacena en el directorio Maildir</li>
</ul>
<p>Enviamos un correo de prueba a debian</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ echo <span style="color:#e6db74">&#34;prueba&#34;</span>| mail -s <span style="color:#e6db74">&#34;email de prueba&#34;</span> debian
</code></pre></div><p>Comprobamos que con la utilidad mail ya no podemos visualizarlo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ mail
No mail <span style="color:#66d9ef">for</span> debian
debian@kiara:~$ mailq
Mail queue is empty
</code></pre></div><p>Comprobamos que el correo de prueba o los correos de prueba que hemos enviado se han incluido dentro del directorio /Maildir.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ ls Maildir/
cur                  dovecot.list.index.log  dovecot-uidvalidity           subscriptions
dovecot.index.cache  dovecot.mailbox.log     dovecot-uidvalidity.601e9f0c  tmp
dovecot.index.log    dovecot-uidlist         new

debian@kiara:~$ ls Maildir/new/
1612893822.V801I61e44M2366.kiara  1612893826.V801I61e43M8243.kiara

debian@kiara:~$ cat Maildir/new/161289382
1612893822.V801I61e44M2366.kiara  1612893826.V801I61e43M8243.kiara

debian@kiara:~$ cat Maildir/new/1612893826.V801I61e43M8243.kiara
Return-Path: &lt;debian@iesgn05.es&gt;
X-Original-To: debian
Delivered-To: debian@iesgn05.es
Received: by kiara.iesgn05.es <span style="color:#f92672">(</span>Postfix, from userid 1000<span style="color:#f92672">)</span>
	id 0135161E45; Tue,  <span style="color:#ae81ff">9</span> Feb <span style="color:#ae81ff">2021</span> 18:03:46 +0000 <span style="color:#f92672">(</span>UTC<span style="color:#f92672">)</span>
To: debian@iesgn05.es
Subject: email de prueba
MIME-Version: 1.0
Content-Type: text/plain; charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>
Content-Transfer-Encoding: 8bit
Message-Id: &lt;20210209180346.0135161E45@kiara.iesgn05.es&gt;
Date: Tue,  <span style="color:#ae81ff">9</span> Feb <span style="color:#ae81ff">2021</span> 18:03:46 +0000 <span style="color:#f92672">(</span>UTC<span style="color:#f92672">)</span>
From: Debian &lt;debian@iesgn05.es&gt;
</code></pre></div><p>Esto mismo lo podemos hacer con el usuario root y sería el mismo procedimiento.</p>
<h3 id="tarea-9-instalación-de-dovecot-protocolo-imap">Tarea 9: Instalación de dovecot. Protocolo IMAP.</h3>
<p><strong>Descripción:</strong>
Instala configura dovecot para ofrecer el protocolo IMAP. Configura dovecot de manera adecuada para ofrecer autentificación y cifrado</p>
<h4 id="911-conceptos">9.11. Conceptos:</h4>
<ul>
<li>
<p><strong>Dovecot</strong>: es un servidor de IMAP Y POP3 de código abierto para sistemas Linux. Puede trabajar con mbox y Maildir.</p>
</li>
<li>
<p><strong>IMAP</strong>: Es un protocolo de acceso a mensajes de Internet, que permite el acceso a mensajes almacenados en un servidor de internet. A través de IMAP se puede tener acceso al correo electrónico teniendo acceso a la red. Se ejecuta en los puertos 143 y 993 (SSL).</p>
</li>
</ul>
<p>Es importante saber que utiliza la <strong>sincronización</strong> para garantizar que se guarde una copia de los mensajes en los diferentes directorios inicados en el servidor y así quedarán ordenados los correos.</p>
<ul>
<li><strong>Pop</strong>: Protocolo de oficina de correo. También es usado para la obtencion de mensajes de correo electrónico almacenados en un servidor remoto. Ya no se utliza normalmente.</li>
</ul>
<blockquote>
<p><strong>Diferencias entre IMAP y POP</strong>: La diferencia principal entre estos dos protocolos es que IMAP almacena los mensajes en el servidor de correo y sus copias en los directorios de forma ordenada mientras que POP3 los descarga y almacena de forma local sólo en la bandeja de entrada.</p>
</blockquote>
<p><strong>Tipos de buzones</strong></p>
<p>Hasta ahora hemos utilizado el buzon <strong>mbox</strong> a través del protocolo POP3, pero ahora vamos a utlizar el buzón <strong>Maildir</strong>, en el que los mensajes se guardan en un directorio llamado Maildir, imprescindible para el protocolo que vamos a usar <strong>IMAP</strong>.</p>
<blockquote>
<p>La configuracion de <strong>maildir</strong> la hemos realizado en la tarea anterior.</p>
</blockquote>
<h4 id="92-instalación-de-dovecot">9.2. Instalación de dovecot</h4>
<ul>
<li>Instalamos los paquetes pertintentes que vamos a usar para dovecot.</li>
</ul>
<blockquote>
<p>No es necesario descargar <em>dovecot-pop3d</em> porque en esta práctica solo vamos a usar IMAP, pero puede ser interesante descargarlo para probar su funcionamiento.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install dovecot-imapd dovecot-pop3d dovecot-core
</code></pre></div><h4 id="93-cifrado">9.3. Cifrado</h4>
<p>Ahora vamos a crear los certificados con LET&rsquo;S ENCRYPT. Para que sean de confianza.
Los usaremos despues para configurar SSL.</p>
<h5 id="crear-certificados-con-lets-encrypt">Crear certificados con Let&rsquo;s Encrypt</h5>
<ul>
<li>Instalamos cerbot</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/apt/sources.list
<span style="color:#75715e"># Agregamos:</span>
deb http://ftp.debian.org/debian buster-backports main
<span style="color:#75715e"># Actualizamos:</span>
apt-get update
<span style="color:#75715e"># Instalamos:</span>
apt install certbot -t buster-backports
</code></pre></div><ul>
<li>Es importante que paremos el servicio de apache o nginx si están en funcionamiento</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo systemctl stop nginx
</code></pre></div><p>Ejecutamos el proceso para crear los certificados para mail.iesgn05.es</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo certbot certonly --standalone -d mail.iesgn05.es
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer None
Obtaining a new certificate
Performing the following challenges:
http-01 challenge <span style="color:#66d9ef">for</span> mail.iesgn05.es
Waiting <span style="color:#66d9ef">for</span> verification...
Cleaning up challenges

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/mail.iesgn05.es/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/mail.iesgn05.es/privkey.pem
   Your cert will expire on 2021-05-07. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   <span style="color:#e6db74">&#34;certbot renew&#34;</span>
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let<span style="color:#960050;background-color:#1e0010">&#39;</span>s Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre></div><h4 id="94-configuración-de-postfix-y-dovecot">9.4. Configuración de postfix y dovecot</h4>
<ul>
<li>Adoptaremos la siguiente configuración en postfix</li>
</ul>
<p><code>sudo nano /etc/postfix/main.cf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># See /usr/share/postfix/main.cf.dist for a commented, more complete version</span>
<span style="color:#75715e"># Debian specific:  Specifying a file name will cause the first</span>
<span style="color:#75715e"># line of that file to be used as the name.  The Debian default</span>
<span style="color:#75715e"># is /etc/mailname.</span>
<span style="color:#75715e">#myorigin = /etc/mailname</span>

smtpd_banner <span style="color:#f92672">=</span> $myhostname ESMTP $mail_name <span style="color:#f92672">(</span>Debian/GNU<span style="color:#f92672">)</span>
biff <span style="color:#f92672">=</span> no

<span style="color:#75715e"># appending .domain is the MUA&#39;s job.</span>
append_dot_mydomain <span style="color:#f92672">=</span> no

<span style="color:#75715e"># Uncomment the next line to generate &#34;delayed mail&#34; warnings</span>
<span style="color:#75715e">#delay_warning_time = 4h</span>

readme_directory <span style="color:#f92672">=</span> no

<span style="color:#75715e"># See http://www.postfix.org/COMPATIBILITY_README.html -- default to 2 on</span>
<span style="color:#75715e"># fresh installs.</span>
compatibility_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>

<span style="color:#75715e"># TLS parameters</span>
smtpd_tls_cert_file<span style="color:#f92672">=</span>/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file<span style="color:#f92672">=</span>/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls<span style="color:#f92672">=</span>yes
smtpd_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtpd_scache
smtp_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtp_scache

<span style="color:#75715e"># See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for</span>
<span style="color:#75715e"># information on enabling SSL in the smtp client.</span>

smtpd_relay_restrictions <span style="color:#f92672">=</span> permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname <span style="color:#f92672">=</span> kiara.iesgn05.es
alias_maps <span style="color:#f92672">=</span> hash:/etc/aliases
alias_database <span style="color:#f92672">=</span> hash:/etc/aliases
myorigin <span style="color:#f92672">=</span> /etc/mailname
mydestination <span style="color:#f92672">=</span> $myhostname, iesgn05.es, kiara.iesgn05.es, localhost.iesgn05.es, localhost
relayhost <span style="color:#f92672">=</span>
mynetworks <span style="color:#f92672">=</span> 127.0.0.0/8 <span style="color:#f92672">[</span>::ffff:127.0.0.0<span style="color:#f92672">]</span>/104 <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>/128
mailbox_size_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
recipient_delimiter <span style="color:#f92672">=</span> +
inet_interfaces <span style="color:#f92672">=</span> all
inet_protocols <span style="color:#f92672">=</span> all

<span style="color:#75715e"># Con esta línea alojaremos los correos en /Maildir/</span>
home_mailbox <span style="color:#f92672">=</span> Maildir/

<span style="color:#75715e"># SMTP-Auth settings</span>
<span style="color:#75715e"># Esta es la configuración adoptada para dovecot</span>
smtpd_sasl_type <span style="color:#f92672">=</span> dovecot
smtpd_sasl_path <span style="color:#f92672">=</span> private/auth
smtpd_sasl_auth_enable <span style="color:#f92672">=</span> yes
smtpd_sasl_security_options <span style="color:#f92672">=</span> noanonymous
smtpd_sasl_local_domain <span style="color:#f92672">=</span> $myhostname
smtpd_recipient_restrictions <span style="color:#f92672">=</span> permit_mynetworks,permit_auth_destination,permit_sasl_authenticated,reject
</code></pre></div><ul>
<li>Editamos el fichero de configuración de los permisos de acceso para postfix</li>
</ul>
<p><code>nano /etc/dovecot/conf.d/10-auth.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Disable LOGIN command and all other plaintext authentications unless</span>
<span style="color:#75715e"># SSL/TLS is used (LOGINDISABLED capability). Note that if the remote IP</span>
<span style="color:#75715e"># matches the local IP (ie. you&#39;re connecting from the same computer), the</span>
<span style="color:#75715e"># connection is considered secure and plaintext authentication is allowed.</span>
<span style="color:#75715e"># See also ssl=required setting.</span>
disable_plaintext_auth <span style="color:#f92672">=</span> no

. . .

<span style="color:#75715e"># En este fichero nos aseguramos que se encuentra esta configuracion</span>
auth_mechanisms <span style="color:#f92672">=</span> plain
</code></pre></div><p><strong>¡¡ATENCIÓN!!</strong></p>
<p>En la primera linea si la descomentamos e indicamos un &lsquo;no&rsquo; , tenemos que ser conscientes de que la seguridad de nuestro servidor está en juego. Se recomienda dejarlo en &lsquo;yes&rsquo; para que los usuarios se autentifiquen sólo a través de conexiones seguras con SSL/TLS. <strong>Utilizar IMAP sin SSL/TLS se considera imprudente.</strong>
En este caso le indicaremos que no, ya que, tendremos la configuracion tipo SSL como &lsquo;yes&rsquo;.</p>
<ul>
<li>Cambiamos la configuracion del siguiente fichero de la siguiente manera, estamos modificando la ruta de donde se guardan los correos al directorio personal en la raiz donde se encuentra Maildir.</li>
</ul>
<p><code>sudo nano /etc/dovecot/conf.d/10-mail.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#mail_location = mbox:~/mail:INBOX=/var/mail/%u</span>
mail_location <span style="color:#f92672">=</span> maildir:~/Maildir

. . .

<span style="color:#75715e"># Group to enable temporarily for privileged operations. Currently this is</span>
<span style="color:#75715e"># used only with INBOX when either its initial creation or dotlocking fails.</span>
<span style="color:#75715e"># Typically this is set to &#34;mail&#34; to give access to /var/mail.</span>
mail_privileged_group <span style="color:#f92672">=</span> mail
mail_access_groups <span style="color:#f92672">=</span> mail

</code></pre></div><ul>
<li>
<p>Tendremos que crear también un CNAME en la zona dns que apunte a imap, y asegurarnos que el puerto 143 y el 993 estén abiertos.</p>
</li>
<li>
<p>Miramos si los puertos están abiertos</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo netstat -putona | grep <span style="color:#e6db74">&#39;143&#39;</span>
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:143             0.0.0.0:*               LISTEN      313/dovecot          off <span style="color:#f92672">(</span>0.00/0/0<span style="color:#f92672">)</span>
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::143                  :::*                    LISTEN      313/dovecot          off <span style="color:#f92672">(</span>0.00/0/0<span style="color:#f92672">)</span>


debian@kiara:~$ sudo netstat -putona | grep <span style="color:#e6db74">&#39;993&#39;</span>
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:993             0.0.0.0:*               LISTEN      1096/dovecot         off <span style="color:#f92672">(</span>0.00/0/0<span style="color:#f92672">)</span>
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::993                  :::*                    LISTEN      1096/dovecot         off <span style="color:#f92672">(</span>0.00/0/0<span style="color:#f92672">)</span>

</code></pre></div><ul>
<li>Creamos el CNAME en la zona DNS</li>
</ul>
<p><img src="/images/ovh_correo/imap.png" alt="imap.png"></p>
<ul>
<li>Habilitamos la opción &lsquo;protocols&rsquo; estableciendo como valor imap</li>
</ul>
<p><code>sudo nano /etc/dovecot/dovecot.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Añadir la siguiente linea</span>
protocols <span style="color:#f92672">=</span> imap
<span style="color:#75715e"># Buscar y descomentar la siguiete línea</span>
listen <span style="color:#f92672">=</span> *, ::
</code></pre></div><ul>
<li>Comprobamos que está habilitada la configuación para ssl, pero en este caso hemos reemplazado los antiguos certificados por los que hemos creado con <strong>letsencrypt</strong>. Estos certificados los hemos copiado al directorio <strong>/ect/dovecot/private</strong></li>
</ul>
<p><code>sudo nano /etc/dovecot/conf.d/10-ssl.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">## SSL settings</span>

<span style="color:#75715e"># SSL/TLS support: yes, no, required. &lt;doc/wiki/SSL.txt&gt;</span>
ssl <span style="color:#f92672">=</span> yes

<span style="color:#75715e"># PEM encoded X.509 SSL/TLS certificate and private key. They&#39;re opened before</span>
<span style="color:#75715e"># dropping root privileges, so keep the key file unreadable by anyone but</span>
<span style="color:#75715e"># root. Included doc/mkcert.sh can be used to easily generate self-signed</span>
<span style="color:#75715e"># certificate, just make sure to update the domains in dovecot-openssl.cnf</span>

<span style="color:#75715e">#ssl_cert = &lt;/etc/dovecot/private/dovecot.pem</span>
<span style="color:#75715e">#ssl_key = &lt;/etc/dovecot/private/dovecot.key</span>

ssl_cert <span style="color:#f92672">=</span> &lt;/etc/dovecot/private/fullchain.pem
ssl_key <span style="color:#f92672">=</span> &lt;/etc/dovecot/private/privkey.pem

</code></pre></div><ul>
<li>Comprobamos nuestra configuracion de <strong>postfix</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo postconf -n
alias_database <span style="color:#f92672">=</span> hash:/etc/aliases
alias_maps <span style="color:#f92672">=</span> hash:/etc/aliases
append_dot_mydomain <span style="color:#f92672">=</span> no
biff <span style="color:#f92672">=</span> no
compatibility_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
home_mailbox <span style="color:#f92672">=</span> Maildir/
inet_interfaces <span style="color:#f92672">=</span> all
inet_protocols <span style="color:#f92672">=</span> all
mailbox_size_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
mydestination <span style="color:#f92672">=</span> $myhostname, iesgn05.es, kiara.iesgn05.es, localhost.iesgn05.es, localhost
myhostname <span style="color:#f92672">=</span> kiara.iesgn05.es
mynetworks <span style="color:#f92672">=</span> 127.0.0.0/8 <span style="color:#f92672">[</span>::ffff:127.0.0.0<span style="color:#f92672">]</span>/104 <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>/128
myorigin <span style="color:#f92672">=</span> /etc/mailname
readme_directory <span style="color:#f92672">=</span> no
recipient_delimiter <span style="color:#f92672">=</span> +
relayhost <span style="color:#f92672">=</span>
smtp_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtp_scache
smtpd_banner <span style="color:#f92672">=</span> $myhostname ESMTP $mail_name <span style="color:#f92672">(</span>Debian/GNU<span style="color:#f92672">)</span>
smtpd_recipient_restrictions <span style="color:#f92672">=</span> permit_mynetworks,permit_auth_destination,permit_sasl_authenticated,reject
smtpd_relay_restrictions <span style="color:#f92672">=</span> permit_mynetworks permit_sasl_authenticated defer_unauth_destination
smtpd_sasl_auth_enable <span style="color:#f92672">=</span> yes
smtpd_sasl_local_domain <span style="color:#f92672">=</span> $myhostname
smtpd_sasl_path <span style="color:#f92672">=</span> private/auth
smtpd_sasl_security_options <span style="color:#f92672">=</span> noanonymous
smtpd_sasl_type <span style="color:#f92672">=</span> dovecot
smtpd_tls_cert_file <span style="color:#f92672">=</span> /etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file <span style="color:#f92672">=</span> /etc/ssl/private/ssl-cert-snakeoil.key
smtpd_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtpd_scache
</code></pre></div><ul>
<li>Reiniciamos los servicios</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl restart postfix
sudo systemctl restart dovecot
</code></pre></div><ul>
<li>Comprobamos los puertos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo netstat -tlpn
Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:993             0.0.0.0:*               LISTEN      20901/dovecot
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:3306            0.0.0.0:*               LISTEN      658/mysqld
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:143             0.0.0.0:*               LISTEN      20901/dovecot
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      568/sshd
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:25              0.0.0.0:*               LISTEN      20572/master
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::993                  :::*                    LISTEN      20901/dovecot
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::143                  :::*                    LISTEN      20901/dovecot
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                   :::*                    LISTEN      568/sshd
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::25                   :::*                    LISTEN      20572/master
</code></pre></div><h4 id="95-cuenta-de-correo-en-evolution">9.5. Cuenta de correo en Evolution</h4>
<ul>
<li>Ahora vamos a ir a Evolution desde nuestra máquina anfitriona. Y seguiremos los siguientes pasos:</li>
</ul>
<blockquote>
<p>Archivo &gt; Nuevo &gt; Cuenta de correo</p>
</blockquote>
<p>Indicamos la dirección de correo que en este caso es <strong><a href="mailto:debian@iesgn05.es">debian@iesgn05.es</a></strong> y el nombre que le vayamos a poner a la cuenta para identificarla.</p>
<p><img src="/images/ovh_correo/f1.png" alt="f1.png"></p>
<p>Una vez verificada la direccion del servidor nos mostrará el protocolo que ofrece, en este caso solo estamos ofreciendo IMAP por lo que se nos pondrá por defecto.</p>
<p>Añadiremos el servidor donde ofrecemos imap, en este caso es <strong>imap.iesgn05.es</strong> que es el CNAME que agregamos previamente a nuestro DNS. Indicaremos el puerto 993 ya que, es el puerto seguro por donde va cifrada la conexión, con el método de cifrado TLS como habiamos configurado en los ficheros anteriormente.</p>
<p>La autentificación será por contraseña, en este caso es la contraseña de nuestro usuario debian.</p>
<p><img src="/images/ovh_correo/f2.png" alt="f2.png"></p>
<p>Dejaremos por defecto las opciones de recepción</p>
<p><img src="/images/ovh_correo/f3.png" alt="f3.png"></p>
<p>En este apartado veremos que se usará SMTP para la conexión al servidor. Indicaremos  en este caso es <strong>smtp.iesgn05.es</strong> y el puerto 465. (Esto aún no funcionará porque no hemos habilitado el SMPTPS)</p>
<p><img src="/images/ovh_correo/SMTP.png" alt="SMTP.png"></p>
<p>Aquí nos mostrará un resumen de nuestra configuración</p>
<p><img src="/images/ovh_correo/ev5.png" alt="ev5.png"></p>
<p>Si previamente en la configuración no hemos cambiado los certificados nos pasará lo siguiente:</p>
<hr>
<p>Le daremos a Siguiente y nos preguntará por el certificado que hemos proporcionado, como no esta firmado por una autoridad certificadora conocida nos preguntará si queremos aceptarla. En este caso como sabemos que es nuestra le damos a Aceptar permanentemente.</p>
<p><img src="/images/ovh_correo/confianza.png" alt="confianza.png"></p>
<hr>
<p>Pero en este caso no nos lo ha preguntado porque confía en nuestro certificado expedido por Let&rsquo;s Encrypt.</p>
<p>Ahora podemos comprobar que se ha sincronizado por el protocolo IMAP nuestra cuenta de correo en Evolution, en la siguiente imagen podemos ver todos los correos de prueba que hemos recibido y se encuentran en la bandeja de entrada:</p>
<p><img src="/images/ovh_correo/finalconcertificado.png" alt="finalconcertificado.png"></p>
<h3 id="prueba-de-funcionamiento">Prueba de funcionamiento</h3>
<p>Vamos a enviar un correo desde Gmail a <a href="mailto:debian@iesgn05.es">debian@iesgn05.es</a> y comprobamos que llega a la bandeja de entrada:</p>
<p><img src="/images/ovh_correo/prueba1.png" alt="prueba1.png"></p>
<p><img src="/images/ovh_correo/prueba2.png" alt="prueba2.png"></p>
<p>Podemos ver el log de la prueba que hemos realizado</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo tail -f  /var/log/mail.log
Feb  <span style="color:#ae81ff">9</span> 20:10:34 kiara dovecot: imap-login: Login: user<span style="color:#f92672">=</span>&lt;debian&gt;, method<span style="color:#f92672">=</span>PLAIN, rip<span style="color:#f92672">=</span>46.234.128.74, lip<span style="color:#f92672">=</span>146.59.196.84, mpid<span style="color:#f92672">=</span>22103, TLS, session<span style="color:#f92672">=</span>&lt;ieAV4ey6Phgu6oBK&gt;
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/smtpd<span style="color:#f92672">[</span>22106<span style="color:#f92672">]</span>: warning: database /etc/aliases.db is older than source file /etc/aliases
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/smtpd<span style="color:#f92672">[</span>22106<span style="color:#f92672">]</span>: connect from mail-oo1-f41.google.com<span style="color:#f92672">[</span>209.85.161.41<span style="color:#f92672">]</span>
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/smtpd<span style="color:#f92672">[</span>22106<span style="color:#f92672">]</span>: DFE3E620CB: client<span style="color:#f92672">=</span>mail-oo1-f41.google.com<span style="color:#f92672">[</span>209.85.161.41<span style="color:#f92672">]</span>
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/cleanup<span style="color:#f92672">[</span>22115<span style="color:#f92672">]</span>: DFE3E620CB: message-id<span style="color:#f92672">=</span>&lt;CA+p9fxpwk2ggF9rrYUC77m6Dm1cViAuqz7vz5+W8hAAV<span style="color:#f92672">==</span>KQWw@mail.gmail.com&gt;
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/qmgr<span style="color:#f92672">[</span>20575<span style="color:#f92672">]</span>: DFE3E620CB: from<span style="color:#f92672">=</span>&lt;cgarmai95@gmail.com&gt;, size<span style="color:#f92672">=</span>2927, nrcpt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>queue active<span style="color:#f92672">)</span>
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/local<span style="color:#f92672">[</span>22116<span style="color:#f92672">]</span>: warning: database /etc/aliases.db is older than source file /etc/aliases
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/local<span style="color:#f92672">[</span>22116<span style="color:#f92672">]</span>: DFE3E620CB: to<span style="color:#f92672">=</span>&lt;debian@iesgn05.es&gt;, relay<span style="color:#f92672">=</span>local, delay<span style="color:#f92672">=</span>0.02, delays<span style="color:#f92672">=</span>0.01/0.01/0/0, dsn<span style="color:#f92672">=</span>2.0.0, status<span style="color:#f92672">=</span>sent <span style="color:#f92672">(</span>delivered to maildir<span style="color:#f92672">)</span>
Feb  <span style="color:#ae81ff">9</span> 20:10:36 kiara postfix/qmgr<span style="color:#f92672">[</span>20575<span style="color:#f92672">]</span>: DFE3E620CB: removed
Feb  <span style="color:#ae81ff">9</span> 20:10:37 kiara postfix/smtpd<span style="color:#f92672">[</span>22106<span style="color:#f92672">]</span>: disconnect from mail-oo1-f41.google.com<span style="color:#f92672">[</span>209.85.161.41<span style="color:#f92672">]</span> ehlo<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> starttls<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> mail<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> rcpt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> bdat<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> quit<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> commands<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>


</code></pre></div><h3 id="tarea-11-mandar-correos-desde-un-cliente-remoto">Tarea 11: Mandar correos desde un cliente remoto.</h3>
<p><strong>Descripción:</strong></p>
<p>Configura de manera adecuada postfix para que podamos mandar un correo desde un cliente remoto. La conexión entre cliente y servidor debe estar autentificada con SASL usando dovecor y además debe estar cifrada. Para cifrar esta comunicación puedes usar dos opciones:</p>
<ul>
<li>ESMTP + STARTTLS: Usando el puerto 567/tcp enviamos de forma segura el correo al servidor.</li>
<li>SMTPS: Utiliza un puerto no estándar (465) para SMTPS (Simple Mail Transfer Protocol Secure). No es una extensión de smtp. Es muy parecido a HTTPS.</li>
</ul>
<p>Elige una de las opciones anterior para realizar el cifrado. Y muestra la configuración de un cliente de correo (evolution, thunderbird, …) y muestra como puedes enviar los correos.</p>
<h4 id="111-smtps-configuración">11.1. SMTPS. Configuración</h4>
<p>Previamente hemos agregado un CNAME indicando smtp.iesgn05.es para kiara.iesgn05.es en la zona DNS.</p>
<p>Ahora vamos a intentar mandar un correo desde el servidor a gmail.</p>
<p>Creamos el certificado con LetsEncrypt para smtp, previamente hemos creado un CNAME con SMTP para kiara.iesgn05.es</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo certbot certonly --standalone -d smtp.iesgn05.es
</code></pre></div><ul>
<li>Para usar SMTPS hay que descomentar las siguientes lineas</li>
</ul>
<p><code>sudo nano /etc/postfix/master.cf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smtp      inet  n       -       y       -       -       smtpd
smtps     inet  n       -       y       -       -       smtpd
  -o syslog_name<span style="color:#f92672">=</span>postfix/smtps
  -o smtpd_tls_wrappermode<span style="color:#f92672">=</span>yes
  -o smtpd_sasl_auth_enable<span style="color:#f92672">=</span>yes
  -o smtpd_client_restrictions<span style="color:#f92672">=</span>$mua_client_restrictions
  -o milter_macro_daemon_name<span style="color:#f92672">=</span>ORIGINATING
</code></pre></div><ul>
<li>Editamos el fichero de configuracion de postfix, cambiamos la configuracion indicando los nuevos certificados. Añadiremos la siguiente configuración de forma que activamos TLS para que nuestros correos sean seguros y reconozcan los certificados.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo nano /etc/postfix/main.cf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">...
<span style="color:#75715e"># TLS parameters</span>

smtpd_use_tls<span style="color:#f92672">=</span>yes
smtpd_tls_key_file <span style="color:#f92672">=</span> /etc/letsencrypt/live/smtp.iesgn05.es/privkey.pem
smtpd_tls_cert_file <span style="color:#f92672">=</span> /etc/letsencrypt/live/smtp.iesgn05.es/fullchain.pem
smtpd_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtpd_scache
smtp_tls_session_cache_database <span style="color:#f92672">=</span> btree:<span style="color:#e6db74">${</span>data_directory<span style="color:#e6db74">}</span>/smtp_scache

smtp_tls_security_level <span style="color:#f92672">=</span> may
smtpd_tls_security_level <span style="color:#f92672">=</span> may
smtp_tls_note_starttls_offer <span style="color:#f92672">=</span> yes
smtpd_tls_loglevel <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
smtpd_tls_received_header <span style="color:#f92672">=</span> yes
...
</code></pre></div><ul>
<li>Reiniciamos los servicios</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~$ sudo systemctl restart postfix
debian@kiara:~$ sudo systemctl restart dovecot
</code></pre></div><ul>
<li>Comprobamos los puertos. Vemos que se ha abierto el puerto 465 de SMTPS</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">debian@kiara:~/Maildir/new$ sudo netstat -tlnp
Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:993             0.0.0.0:*               LISTEN      32704/dovecot       
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:3306            0.0.0.0:*               LISTEN      658/mysqld          
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:143             0.0.0.0:*               LISTEN      32704/dovecot       
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:465             0.0.0.0:*               LISTEN      1157/master         
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      568/sshd            
tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:25              0.0.0.0:*               LISTEN      1157/master         
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::993                  :::*                    LISTEN      32704/dovecot       
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::143                  :::*                    LISTEN      32704/dovecot       
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::465                  :::*                    LISTEN      1157/master         
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                   :::*                    LISTEN      568/sshd            
tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::25                   :::*                    LISTEN      1157/master      
</code></pre></div><h4 id="funcionamiento">Funcionamiento</h4>
<ul>
<li>En Evolution cambiamos la configuracion de smtp de la siguiente forma</li>
</ul>
<p><img src="/images/ovh_correo/SMTP.png" alt="SMTP.png"></p>
<ul>
<li>Probamos enviar algun correo al nuestro personal</li>
</ul>
<p><img src="/images/ovh_correo/pruebae.png" alt="pruebae.png"></p>
<ul>
<li>Vemos que lo hemos recibido en gmail correctamente y conoce el certificado ya que está expedido por la autoridad de LetsEncrypt</li>
</ul>
<p><img src="/images/ovh_correo/recibido.png" alt="recibido.png"></p>
<p><img src="/images/ovh_correo/recibido2.jpeg" alt="recibido2.jpeg"></p>
<ul>
<li>Lo contestamos y comprobamos que recibe y envía correctamente correos</li>
</ul>
<p><img src="/images/ovh_correo/recibidook.png" alt="recibidook.png"></p>
]]></content>
        </item>
        
        <item>
            <title>Servidor de Correos. Postfix (IV). Webmail Roundcube.</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iv.-webmail-roundcube./</link>
            <pubDate>Mon, 25 Jan 2021 17:15:21 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iv.-webmail-roundcube./</guid>
            <description>Descripción (Tarea 10 y 12)
Vamos a instalar un webmail (Roundcube), sobre Debian Buster alojado en una máquina de OVH, para gestionar el correo del equipo mediante una interfaz web. Recibo y envío de correos.
RoundCube es un cliente de correo electrónico IMAP, de código abierto y escrito en PHP. Para instalar este webmail deberemos de tener en funcionamiento un servidor de correos.
1. Requisitos:   Tener en funcionamiento un servidor de web, en este caso usaremos Nginx</description>
            <content type="html"><![CDATA[<h2 id="descripción">Descripción</h2>
<p>(Tarea 10 y 12)</p>
<p>Vamos a instalar un webmail (Roundcube), sobre Debian Buster alojado en una máquina de OVH, para gestionar el correo del equipo mediante una interfaz web. Recibo y envío de correos.</p>
<p><strong>RoundCube</strong> es un cliente de correo electrónico IMAP, de código abierto y escrito en PHP. Para instalar este webmail deberemos de tener en funcionamiento un servidor de correos.</p>
<h2 id="1-requisitos">1. Requisitos:</h2>
<ul>
<li>
<p>Tener en funcionamiento un servidor de web, en este caso usaremos <a href="https://github.com/CeliaGMqrz/servidor_Nginx">Nginx</a></p>
</li>
<li>
<p>Un gestor de base de datos, usaremos <strong>MariaDB</strong>.</p>
</li>
<li>
<p>Servidor de correos, en este caso usaremos <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-i/">Postfix</a></p>
</li>
<li>
<p>Un servidor DNS, en este caso OVH se encarga de ello pero podemos configurarlo con <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-un-dns-con-bind9/">Bind9</a>, de forma que se cree un subdominio o dominio que se usará para roundcube, en este caso el subdominio será <em>correo.iesgn05.es.</em> que es un CNAME de nuestra máquina <em>kiara.iesgn05.es</em>.</p>
</li>
</ul>
<h2 id="2-instalación-de-extensiones-php">2. Instalación de extensiones PHP</h2>
<ul>
<li>Intalamos las extensiones que nos harán falta para roundcube</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get install php php-cli php-gd php-intl php-fpm php-curl php-imagick php-mysql php-zip php-xml php-mbstring php-bcmath -y
</code></pre></div><ul>
<li>Establecer zona horaria en php.ini, según la nuestra evidentemente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo  sed  -i  <span style="color:#e6db74">&#39;s /; date.timezone = / date.timezone = Europe \ / Madrid / g&#39;</span>  / etc / php / 7.3 / fpm / php.ini

</code></pre></div><ul>
<li>Reiniciar php-fpm</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl reiniciar php7.3-fpm
</code></pre></div><h2 id="2-configuración-mariadb-crear-usuario-y-base-de-datos-para-roundcube">2. Configuración MariaDB. Crear usuario y base de datos para roundcube</h2>
<ul>
<li>Entramos a MySQL como superusuario</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo mysql -u root -p
</code></pre></div><ul>
<li>Creamos la base de datos para roundcube</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">CREATE DATABASE roundcube DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
</code></pre></div><ul>
<li>Creamos el usuario para la base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">CREATE USER <span style="color:#e6db74">&#39;roundcube&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;password&#39;</span>;
</code></pre></div><ul>
<li>Le otorgamos los permisos necesarios para la nueva base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">GRANT ALL PRIVILEGES ON roundcube.* TO <span style="color:#e6db74">&#39;roundcube&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
</code></pre></div><ul>
<li>Actualizamos los permisos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flush privileges;
</code></pre></div><ul>
<li>Salimos del MySQL</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">quit
</code></pre></div><h2 id="3-crear-certificado-para-usar-https-con-letsencrypt">3. Crear certificado para usar https con Letsencrypt</h2>
<ul>
<li>Si no tenemos instalado LetsEncrypt lo instalamos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/apt/sources.list
<span style="color:#75715e"># Agregamos:</span>
deb http://ftp.debian.org/debian buster-backports main
<span style="color:#75715e"># Actualizamos:</span>
apt-get update
<span style="color:#75715e"># Instalamos:</span>
apt install certbot -t buster-backports
<span style="color:#75715e"># Una vez instlado comentamos la línea de backports de nuevo y volvemos a hacer un apt update, porque ya no nos hará falta.</span>
</code></pre></div><ul>
<li>Paramos nuestro servidor web nginx</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl stop nginx
</code></pre></div><ul>
<li>Creamos los certificados para correo.iesgn05.es</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo certbot -d correo.iesgn05.es --agree-tos -m debian@iesgn05.es
</code></pre></div><h2 id="4-configuración-de-nginx">4. Configuración de NGINX</h2>
<p>Una vez instalado y configurado Nginx con un sitio web inicial y comprobado que el sitio web funciona vamos a configurar el virtualhost que va servir nuestro webmail.</p>
<ul>
<li>Crearemos un fichero de configuración nuevo</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/nginx/sites-avaliable/correo.iesgn05.es.conf
</code></pre></div><ul>
<li>Le añadimos el siguiente contenido, como podemos ver hemos añadido la configuración pertinente para usar https y que sea un sitio de confianza. Tambien podemos ver que hemos añadido los parámetros pertinentes para que php funcione.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">server <span style="color:#f92672">{</span>
    listen 80;
    server_name correo.iesgn05.es;
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">301</span> https://$host$request_uri;
<span style="color:#f92672">}</span>
 
server <span style="color:#f92672">{</span>
    listen <span style="color:#ae81ff">443</span> ssl http2;
    server_name correo.iesgn05.es;
    root /var/www/roundcubemail;
    index index.php index.htm index.html;
 
    ssl_certificate /etc/letsencrypt/live/correo.iesgn05.es/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/correo.iesgn05.es/privkey.pem;
 
    location / <span style="color:#f92672">{</span>
        try_files $uri $uri/ /index.php?$args;
    <span style="color:#f92672">}</span>
 
    location ~ <span style="color:#ae81ff">\.</span>php<span style="color:#f92672">(</span>?:$|/<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        try_files $uri <span style="color:#f92672">=</span>404;
        fastcgi_split_path_info ^<span style="color:#f92672">(</span>.+<span style="color:#ae81ff">\.</span>php<span style="color:#f92672">)(</span>/.+<span style="color:#f92672">)</span>$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param HTTPS on;
        fastcgi_param modHeadersAvailable true;
        fastcgi_pass unix:/run/php/php7.3-fpm.sock;
        fastcgi_intercept_errors on;
        fastcgi_buffers <span style="color:#ae81ff">4</span> 256k;
        fastcgi_busy_buffers_size 256k;
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="5-instalación-de-roundcube">5. Instalación de Roundcube</h2>
<ul>
<li>Obtenemos el paquete</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo wget https://github.com/roundcube/roundcubemail/releases/download/1.4.8/roundcubemail-1.4.8-complete.tar.gz -P /var/www/
</code></pre></div><ul>
<li>Lo descomprimimos en el documenroot</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo tar zxvf /var/www/roundcubemail-1.4.8-complete.tar.gz -C /var/www/
</code></pre></div><ul>
<li>Renombramos el directorio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo mv /var/www/roundcubemail-1.4.8 /var/www/roundcubemail
</code></pre></div><ul>
<li>Le damos los permisos necesarios para nginx</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo chown www-data:www-data -R /var/www/roundcubemail
</code></pre></div><ul>
<li>Comprobamos que la sintaxis de nginx es correcta, reinciamos el servicio y comprobamos que está en funcionamiento.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nginx -t
sudo systemctl restart nginx
sudo systemctl status nginx
</code></pre></div><ul>
<li>Nos dirigmos al navegador e introducimos la url: correo.iesgn05.es/installer</li>
</ul>
<p>Nos saldrá el entorno de instalación de roundcube.</p>
<p><img src="/images/ovh_correo/r1.png" alt="r1.png"></p>
<p>Fuentes:</p>
<ul>
<li><a href="https://atetux.com/how-to-install-roundcube-webmail-1-4-on-debian-10">https://atetux.com/how-to-install-roundcube-webmail-1-4-on-debian-10</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Configurar LDAPs en Debian. OpenLDAP. (Freston)</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-ldaps-en-debian.-openldap.-freston/</link>
            <pubDate>Mon, 25 Jan 2021 09:27:32 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-ldaps-en-debian.-openldap.-freston/</guid>
            <description>¡! Este post está relacionado con un entrono de trabajo con openstack incluido en otras entradas de mi blog.
=======
    </item>
    
    <item>
      <title>Servidor de Correos. Postfix (IV). Webmail Roundcube.</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iv.-webmail-roundcube./</link>
      <pubDate>Mon, 25 Jan 2021 17:15:21 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-iv.-webmail-roundcube./</guid>
      <description>Descripción (Tarea 10 y 12)
Vamos a instalar un webmail (Roundcube), sobre Debian Buster alojado en una máquina de OVH, para gestionar el correo del equipo mediante una interfaz web. Recibo y envío de correos.
RoundCube es un cliente de correo electrónico IMAP, de código abierto y escrito en PHP. Para instalar este webmail deberemos de tener en funcionamiento un servidor de correos.
1. Requisitos:   Tener en funcionamiento un servidor de web, en este caso usaremos Nginx</description>
    </item>
    
    <item>
      <title>Configurar LDAPs en Debian. OpenLDAP. (Freston)</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-ldaps-en-debian.-openldap.-freston/</link>
      <pubDate>Mon, 25 Jan 2021 09:27:32 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-ldaps-en-debian.-openldap.-freston/</guid>
      <description>¡! Este post está relacionado con un entrono de trabajo con openstack incluido en otras entradas de mi blog.
>>>>>>> ac672a39f702734aefd8768e524390a50ae08158
1. Introducción LDAP. Protocolo Ligero de Acceso a Directorio. ¿Qué es LDAP?
Es un protocolo muy utilizado por empresas que apuestan por el software libre al utilizar distribuciones de Linux para construir un **directorio activo **en el que se gestionan las credenciales de los trabajadores, los permisos y estaciones de trabajo.</description>
    </item>
    
    <item>
      <title>Proyecto: Escenario planteado sobre OpenStack</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/proyecto-escenario-planteado-sobre-openstack/</link>
      <pubDate>Fri, 22 Jan 2021 12:48:10 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/proyecto-escenario-planteado-sobre-openstack/</guid>
      <description>Introducción En el IES Gonzalo Nazareno, en el segundo año del ciclo superior de Administración de sistemas informáticos en red, se ha propuesto un escenario implantado sobre Openstack en el que nosotros, los alumnos, hemos puesto en práctica muchas tareas relacionadas con servidores linux.
Trabajamos con sistemas operativos Linux, entre ellos con distribuciones como Debian Buster, Centos7, Centos8 y Ubuntu Server 20.04.
Tratamos con los diferentes sistemas y la instalación y configuración de servidores web como Apache2 o Nginx, bases de datos, cifrado con openssl, servicios como bind9 para DNS, directorio activo como OpenLDAP, entre otros&amp;hellip;</description>
    </item>
    
    <item>
      <title>Servidor de Correos. Postfix (I)</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-i/</link>
      <pubDate>Fri, 22 Jan 2021 12:48:10 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-i/</guid>
      <description>1. Objetivo. Instalación y configuración de un servidor de correos en una máquina de OVH, para el dominio iesgn05. El nombre del servidor de correo será mail.iesgn05.es.
Configurar un registro SPF, que es un mecanismo de autenticación que mediante un registro DNS de tipo TXT describe las direcciones IPs y nombres DNS autorizados a enviar correo @DOMINIO.
Suponiendo que el servidor de correo se llama mail.iesgn05.es, crearemos un registro MX siendo este mail.</description>
    </item>
    
    <item>
      <title>Servidor de Correos. Postfix (II). Alias y Redirecciones.</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-ii.-alias-y-redirecciones./</link>
      <pubDate>Fri, 22 Jan 2021 12:48:10 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-correos.-postfix-ii.-alias-y-redirecciones./</guid>
      <description>1. Uso de cron para notificar a root de una tarea Vamos a comprobar como los procesos del servidor pueden mandar correos para informar sobre su estado. Por ejemplo cada vez que se ejecuta una tarea cron podemos enviar un correo informando del resultado. Normalmente estos correos se mandan al usuario root del servidor, para ello:
Vamos a crear un script sencillo que muestre las 10 últimas líneas de log de postfix:</description>
    </item>
    
    <item>
      <title>Instalación de aplicación web CMS python</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/instalaci%C3%B3n-de-aplicaci%C3%B3n-web-cms-python/</link>
      <pubDate>Thu, 21 Jan 2021 13:04:33 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/instalaci%C3%B3n-de-aplicaci%C3%B3n-web-cms-python/</guid>
      <description>Objetivo: En este post vamos a trabajar sobre el entorno de trabajo de openstack nuevamente, el mismo sobre el que tratamos en el blog.
La máquina virtual sobre la que trabajamos es un Centos 8, nuestro llamado Quijote.
El objetivo es desplegar un CMS python, en este caso wagtail, basado en django.
1. Instalación de wagtail. Entorno de desarrollo: Creación del entorno virtual.  Primero tendremos que crear un entorno virtual en nuestra máquina anfitriona.</description>
    </item>
    
    <item>
      <title>Configurar HTTPS en Centos 8 (Quijote)</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-https-en-centos-8-quijote/</link>
      <pubDate>Thu, 21 Jan 2021 10:11:23 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/configurar-https-en-centos-8-quijote/</guid>
      <description>¡! Este post está relacionado con un entrono de trabajo con openstack incluido en otras entradas de mi blog.
1. Creación de un certificado SSL Wilcard Concepto: ¿Qué es un certificado SSL Wilcard?
Es un certificado que protege la dirección URL de un sitio web, así como también sus subdominios.
Crear clave privada y certificado
El certificado principalmente se va a generar en Freston, nuestra máquina donde tenemos configurado el DNS de nuestro escenario.</description>
    </item>
    
    <item>
      <title>Servidor de base de datos. MariaDB en Ubuntu</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-base-de-datos.-mariadb-en-ubuntu/</link>
      <pubDate>Wed, 13 Jan 2021 14:51:48 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-de-base-de-datos.-mariadb-en-ubuntu/</guid>
      <description>En sancho (Ubuntu) vamos a instalar un servidor de base de datos mariadb (bd.celia.gonzalonazareno.org).
1. Instalación de mariadb en Ubuntu Antes de nada tendremos que actualizar la paquetería
sudo apt-get update sudo apt-get upgrade Instalamos mysql agregando el repositorio
sudo apt-get install software-properties-common sudo apt-key adv --fetch-keys &amp;#39;https://mariadb.org/mariadb_release_signing_key.asc&amp;#39; sudo add-apt-repository &amp;#39;deb [arch=amd64,arm64,ppc64el] https://mirror.one.com/mariadb/repo/10.4/ubuntu focal main&amp;#39; sudo apt install mariadb-server Procederemos a la instalación segura de mysql
sudo mysql_secure_installation ubuntu@sancho:~$ sudo mysql_secure_installation NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE!</description>
    </item>
    
    <item>
      <title>Servidor Web Apache2 (httpd) en Centos8</title>
      <link>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-web-apache2-httpd-en-centos8/</link>
      <pubDate>Wed, 13 Jan 2021 11:36:08 +0100</pubDate>
      
      <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2021/01/servidor-web-apache2-httpd-en-centos8/</guid>
      <description>Este artículo trata sobre la instalación de un servidor web Apache2 sobre Centos8 incluido dentro de un entorno previamente creado en un cloud. Las entradas anteriores son las siguientes:
  Instalación inicial de los servidores
  Modificación del escenario
  Actualización de Centos7 a Centos8
  1. Descripción de la tarea: En quijote (CentOs)(Servidor que está en la DMZ) vamos a instalar un servidor web apache. Configura el servidor para que sea capaz de ejecutar código php (para ello vamos a usar un servidor de aplicaciones** php-fpm**).</description>
    </item>
    
  </channel>
</rss>
