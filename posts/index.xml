<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Un bit de informacion cada día</title>
        <link>https://unbitdeinformacioncadadia.netlify.app/posts/</link>
        <description>Recent content in Posts on Un bit de informacion cada día</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Mon, 30 Nov 2020 20:59:38 +0100</lastBuildDate>
        <atom:link href="https://unbitdeinformacioncadadia.netlify.app/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Actualizacion de centos7 a Centos8</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/actualizacion-de-centos7-a-centos8/</link>
            <pubDate>Mon, 30 Nov 2020 20:59:38 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/actualizacion-de-centos7-a-centos8/</guid>
            <description>Objetivo: Actualizar CentOS 7 a CentOS 8 garantizando que todos los servicios previos continúen funcionando:
 Actualmente tenemos la versión 7.9.2009 de Centos
[root@quijote centos]# cat /etc/centos-release CentOS Linux release 7.9.2009 (Core) Vamos a proceder a actualizar Centos siguiendo varios pasos.
Preparar el sistema para su actualización Habilitamos el repositorio de &amp;lsquo;epel-release&amp;rsquo;
yum install epel-release -y Necesitaremos instalar las herramientas para el gestor de paquetes YUM
yum install yum-utils -y Resolvemos los paquetes RPM, de forma que, rpmconf se encarga de buscar los archivos .</description>
            <content type="html"><![CDATA[<h3 id="objetivo">Objetivo:</h3>
<p>Actualizar CentOS 7 a CentOS 8 garantizando que todos los servicios previos continúen funcionando:</p>
<hr>
<p>Actualmente tenemos la versión 7.9.2009 de Centos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[root@quijote centos]<span style="color:#75715e"># cat /etc/centos-release</span>
CentOS Linux release 7.9.2009 (Core)
</code></pre></div><p>Vamos a proceder a actualizar Centos siguiendo varios pasos.</p>
<h3 id="preparar-el-sistema-para-su-actualización">Preparar el sistema para su actualización</h3>
<p>Habilitamos el repositorio de &lsquo;epel-release&rsquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">yum install epel-release -y
</code></pre></div><p>Necesitaremos instalar las herramientas para el gestor de paquetes YUM</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">yum install yum-utils -y
</code></pre></div><p>Resolvemos los paquetes RPM, de forma que, rpmconf se encarga de buscar los archivos .rpmnew, .rpmsave y .rpmorigfiles y indicar si mantenemos la versión actual o no.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">yum install rpmconf -y
rpmconf -a
</code></pre></div><p>Limpiamos los paquetes que no necesitamos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">package-cleanup --leaves
package-cleanup --orphans
</code></pre></div><h3 id="gestor-de-paqutes-dnf">Gestor de paqutes: DNF</h3>
<p>DNF es el gestor de paquetes que sustituye a YUM, y necesitamos instalarlo para nuestra nueva versión.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">yum install dnf
</code></pre></div><p>Lo mejor es desinstalar YUM, no entran en conflicto si se instalan los dos pero no es necesario.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf -y remove yum yum-metadata-parser
rm -Rf /etc/yum
</code></pre></div><h3 id="actualizar-versión-de-centos-7-a-centos-8">Actualizar versión de Centos 7 a Centos 8</h3>
<p>Actualizamos el sistema</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf upgrade -y
</code></pre></div><h3 id="habilitar-repositorios-de-centos-8">Habilitar repositorios de Centos 8</h3>
<p>Habilitamos los repositorios propios de Centos 8</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf install \
http<span style="color:#960050;background-color:#1e0010">:</span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-repos-8.2-2.2004.0.1.el8.x86_64.rpm \
http<span style="color:#960050;background-color:#1e0010">:</span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-release-8.2-2.2004.0.1.el8.x86_64.rpm \
http<span style="color:#960050;background-color:#1e0010">:</span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-gpg-keys-8.2-2.2004.0.1.el8.noarch.rpm

</code></pre></div><p>Actualiamos repositorios</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf upgrade -y epel-release
</code></pre></div><p>Limpiamos la caché y eliminamos los archivos temporales</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf makecache
dnf clean all
</code></pre></div><p>Eliminamos las versiones de kernel que ya no nos sirven</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">rpm -e `rpm -q kernel`
</code></pre></div><p>Eliminamos los paquetes conflictivos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">rpm -e --nodeps sysvinit-tools

</code></pre></div><p>Ahora <strong>actualizamos todo el sistema</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf -y --releasever=8 --allowerasing --setopt=deltarpm=false distro-sync
</code></pre></div><p>Es posible que nos encontremos con paquetes conflictivos. En mi caso he tenido que resolver estos conflictos de esta forma.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">rpm -e --justdb python36-rpmconf-1.0.22-1.el7.noarch rpmconf-1.0.22-1.el7.noarch
rpm -e --justdb --nodeps python3-setuptools-39.2.0-10.el7.noarch
rpm -e --justdb --nodeps python3-pip-9.0.3-7.el7_7.noarch
rpm -e --justdb --nodeps vim-minimal

dnf upgrade --best --allowerasing rpm
</code></pre></div><p>Volvemos a ejecutar el mismo proceso que antes, y no deberia de darnos más conflictos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf -y --releasever=8 --allowerasing --setopt=deltarpm=false distro-sync
</code></pre></div><h3 id="versión-de-kernel-y-paquetes-mínimos">Versión de kernel y paquetes mínimos</h3>
<p>Instalamos el último kernel de Centos 8</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf install -y kernel-core
</code></pre></div><p>Instalamos los paquetes mínimos del sistema</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dnf -y groupupdate <span style="color:#e6db74">&#34;Core&#34;</span> <span style="color:#e6db74">&#34;Minimal Install&#34;</span> \
--allowerasing --skip-broken
</code></pre></div><p>Reiniciamos el sistema</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">reboot
</code></pre></div><p>Comprobamos que se ha actualizado correctamente y tiene la ultima versión de kernel a día de hoy</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[centos@quijote ~]$ cat /etc/redhat-release
CentOS Linux release 8.2.2004 (Core) 
[centos@quijote ~]$ uname -ro
4.18.0-193.28.1.el8_2.x86_64 GNU/Linux

</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Configurar HTTPS con Let&#39;s Encrypt en un servidor con Nginx</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/configurar-https-con-lets-encrypt-en-un-servidor-con-nginx/</link>
            <pubDate>Sun, 29 Nov 2020 21:09:40 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/configurar-https-con-lets-encrypt-en-un-servidor-con-nginx/</guid>
            <description>HTTPS (Seguridad) Objetivo: Vamos a configurar el protocolo HTTPS para el acceso a nuestras aplicaciones, para ello tienes que tener en cuenta los siguiente.
1. Vamos a utilizar el servicio letsencrypt para solicitar los certificados de nuestras páginas. Let&amp;rsquo;s Encrypt se trata de una autoridad de certificación, conocida como CA, libre y gratuita, que permite generar certificados SSL gratuitos y automáticos para nuestros sitios web, con el objetivo de promover que el tráfico de Internet sea seguro.</description>
            <content type="html"><![CDATA[<h2 id="https-seguridad">HTTPS (Seguridad)</h2>
<h3 id="objetivo">Objetivo:</h3>
<p>Vamos a configurar el protocolo HTTPS para el acceso a nuestras aplicaciones, para ello tienes que tener en cuenta los siguiente.</p>
<h2 id="1-vamos-a-utilizar-el-servicio-letsencrypt-para-solicitar-los-certificados-de-nuestras-páginas">1. Vamos a utilizar el servicio letsencrypt para solicitar los certificados de nuestras páginas.</h2>
<p>Let&rsquo;s Encrypt se trata de una <strong>autoridad de certificación</strong>, conocida como CA, libre y gratuita, que permite generar certificados SSL gratuitos y automáticos para nuestros sitios web, con el objetivo de promover que el tráfico de Internet sea seguro.</p>
<h2 id="2-explica-detenidamente-cómo-se-solicita-un-certificado-en-lets-encrypt-en-tu-explicación-deberás-responder-a-estas-preguntas">2. Explica detenidamente cómo se solicita un certificado en Let&rsquo;s Encrypt. En tu explicación deberás responder a estas preguntas:</h2>
<p><strong>¿Qué función tiene el cliente ACME?</strong></p>
<p>El cliente ACME permite automatizar la implementación de certificados SSL/TLS y eliminar el tiempo que pasa llevando a cabo las instalaciones de certificados manualmente.</p>
<p><strong>¿Qué configuración se realiza en el servidor web?</strong></p>
<p>Se toma una configuración para proteger el sitio web de tal manera que, autogenera un certificado y una clave para asegurar nuestro sitio y añade los puertos de escucha al 443 que son los necesarios para el sistema de seguridad ssl.</p>
<p><strong>¿Qué pruebas realiza Let&rsquo;s Encrypt para asegurar que somos los administrados del sitio web?</strong></p>
<p>Let&rsquo;s Encrypt identifica el administrador del servidor por la llave pública. La primera vez que el software del agente interactúa con este, genera un par de claves y demuestra a Let&rsquo;s Encrypt que el servidor controla uno o más dominios.</p>
<p>Puede demostrar el control sobre el dominio de dos formas, aprovisionando de un recurso HTTP en un fichero (well-known URI) o aprovisionando un record DNS.</p>
<p><strong>¿Se puede usar el DNS para verificar que somos administradores del sitio?</strong></p>
<p>Sí. Crea un registro en el DNS con una determinada información que permite verificar que somos administradores del sitio.</p>
<hr>
<p>Para solicitar un certificado en Let&rsquo;s Encrypt necesitamos una herramienta (el agente cerbot): Cerbot que será el que permita su obtención. Para ello vamos a instalar esta herramienta, con el plugin para nginx.</p>
<p><strong>Instalar cerbot</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano /etc/apt/sources.list
<span style="color:#75715e"># Agregamos:</span>
deb http<span style="color:#960050;background-color:#1e0010">:</span>//ftp.debian.org/debian buster-backports main
<span style="color:#75715e"># Actualizamos:</span>
apt-get update
<span style="color:#75715e"># Instalamos:</span>
apt install python-certbot-nginx -t buster-backports
</code></pre></div><p><strong>Obtener Certificado</strong></p>
<p>Ejecutamos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">cerbot --nginx -d www.iesgn05.es
</code></pre></div><p>Como es la primera vez que iniciamos cerbot nos pedirá un correo electrónico y que aceptemos las condiciones y términos.</p>
<p>Tendremos decirle que todas las peticiones las redirija a un https y ya tendremos nuestro certificado.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/home/debian<span style="color:#75715e"># certbot --nginx -d www.iesgn05.es</span>
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected<span style="color:#960050;background-color:#1e0010">:</span> Authenticator nginx, Installer nginx
Enter email address (used <span style="color:#66d9ef">for</span> urgent renewal and security notices) (Enter <span style="color:#e6db74">&#39;c&#39;</span> to
cancel)<span style="color:#960050;background-color:#1e0010">:</span> cg.marquez95@gmail.com

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please read the Terms of Service at
https<span style="color:#960050;background-color:#1e0010">:</span>//letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
agree <span style="color:#66d9ef">in</span> order to register with the ACME server at
https<span style="color:#960050;background-color:#1e0010">:</span>//acme-v02.api.letsencrypt.org/directory
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(A)gree/(C)ancel<span style="color:#960050;background-color:#1e0010">:</span> A

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing to share your email address with the Electronic Frontier
Foundation, a founding partner of the Let<span style="color:#e6db74">&#39;s Encrypt project and the non-profit
</span><span style="color:#e6db74">organization that develops Certbot? We&#39;</span>d like to send you email about our work
encrypting the web, EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: Y
Obtaining a new certificate
Performing the following challenges<span style="color:#960050;background-color:#1e0010">:</span>
http-01 challenge <span style="color:#66d9ef">for</span> www.iesgn05.es
Waiting <span style="color:#66d9ef">for</span> verification...
Cleaning up challenges
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/iesgn05

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1<span style="color:#960050;background-color:#1e0010">:</span> No redirect - Make no further changes to the webserver configuration.
2<span style="color:#960050;background-color:#1e0010">:</span> Redirect - Make all requests redirect to secure HTTPS access. Choose this <span style="color:#66d9ef">for</span>
new sites, or <span style="color:#66d9ef">if</span> you<span style="color:#e6db74">&#39;re confident your site works on HTTPS. You can undo this
</span><span style="color:#e6db74">change by editing your web server&#39;</span>s configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then <span style="color:#66d9ef">[enter]</span> (press <span style="color:#e6db74">&#39;c&#39;</span> to cancel)<span style="color:#960050;background-color:#1e0010">:</span> 2
Redirecting all traffic on port 80 to ssl <span style="color:#66d9ef">in</span> /etc/nginx/sites-enabled/iesgn05

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations! You have successfully enabled https<span style="color:#960050;background-color:#1e0010">:</span>//www.iesgn05.es

You should test your configuration at<span style="color:#960050;background-color:#1e0010">:</span>
https<span style="color:#960050;background-color:#1e0010">:</span>//www.ssllabs.com/ssltest/analyze.html<span style="color:#66d9ef">?</span>d=www.iesgn05.es
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES<span style="color:#960050;background-color:#1e0010">:</span>
 - Congratulations! Your certificate and chain have been saved at<span style="color:#960050;background-color:#1e0010">:</span>
   /etc/letsencrypt/live/www.iesgn05.es/fullchain.pem
   Your key file has been saved at<span style="color:#960050;background-color:#1e0010">:</span>
   /etc/letsencrypt/live/www.iesgn05.es/privkey.pem
   Your cert will expire on 2021-02-27. To obtain a new or tweaked
   version of this certificate <span style="color:#66d9ef">in</span> the future, simply run certbot again
   with the <span style="color:#e6db74">&#34;certonly&#34;</span> option. To non-interactively renew *all* of
   your certificates, run <span style="color:#e6db74">&#34;certbot renew&#34;</span>
 - Your account credentials have been saved <span style="color:#66d9ef">in</span> your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.
 - <span style="color:#66d9ef">If</span> you like Certbot, please consider supporting our work by<span style="color:#960050;background-color:#1e0010">:</span>

   Donating to ISRG / Let<span style="color:#960050;background-color:#1e0010">&#39;</span>s Encrypt<span style="color:#960050;background-color:#1e0010">:</span>   https<span style="color:#960050;background-color:#1e0010">:</span>//letsencrypt.org/donate
   Donating to EFF<span style="color:#960050;background-color:#1e0010">:</span>                    https<span style="color:#960050;background-color:#1e0010">:</span>//eff.org/donate<span style="color:#f92672">-le</span>

</code></pre></div><p>Como nos dice el certificado se ha generado en la ruta <em>/etc/letsencrypt/live/www.iesgn05.es/fullchain.pem</em> y la clave está en  <em>/etc/letsencrypt/live/www.iesgn05.es/privkey.pem</em></p>
<p>Ahora podemos comprobar que nuestro sitio es un sitio seguro:</p>
<p><img src="/images/ovh_https/seguro1.jpeg" alt="seguro1.jpeg"></p>
<p><img src="/images/ovh_https/certificado.png" alt="certificado.png"></p>
<h2 id="3-utiliza-dos-ficheros-de-configuración-de-nginx-uno-para-la-configuración-del-virtualhost-http-y-otro-para-la-configuración-del-virtualhost-https">3. Utiliza dos ficheros de configuración de nginx: uno para la configuración del virtualhost HTTP y otro para la configuración del virtualhost HTTPS.</h2>
<p>Para configurar nuestro dominio <a href="http://www.iesgn05.es">www.iesgn05.es</a>, hemos utilizado el plugin de certbox nginx por lo que no necesitamos un segundo fichero para hacer la redirección. En el mismo fichero de configuración está la redirección.</p>
<p><strong><a href="http://www.iesgn05.es">www.iesgn05.es</a></strong></p>
<p>Esto es lo que ha añadido cerbot en la configuración de nuestro fichero iesgn05</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">    listen [::]<span style="color:#960050;background-color:#1e0010">:</span>443 ssl ipv6only=on; <span style="color:#75715e"># managed by Certbot</span>
    listen 443 ssl; <span style="color:#75715e"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/www.iesgn05.es/fullchain.pem; <span style="color:#75715e"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/www.iesgn05.es/privkey.pem; <span style="color:#75715e"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf; <span style="color:#75715e"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; <span style="color:#75715e"># managed by Certbot</span>

}

server {
    <span style="color:#66d9ef">if</span> ($host = www.iesgn05.es) {
        <span style="color:#66d9ef">return</span> 301 https<span style="color:#960050;background-color:#1e0010">:</span>//$host$request_uri;
    } <span style="color:#75715e"># managed by Certbot</span>


        listen 80;
        listen [::]<span style="color:#960050;background-color:#1e0010">:</span>80;

        server_name www.iesgn05.es;
    <span style="color:#66d9ef">return</span> 404; <span style="color:#75715e"># managed by Certbot</span>
}
</code></pre></div><p><strong>portal.iesgn05.es</strong></p>
<p>Sin embargo para configurar nuestro dominio portal.iesgn05.es vamos a configurar dos ficheros de configuración, uno para http y otro para https.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">certbot certonly --standalone --preferred-challenges http -d portal.iesgn05.es
</code></pre></div><p>Vemos que se ha generado unas claves</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/home/debian<span style="color:#75715e"># ls /etc/letsencrypt/live/portal.iesgn05.es/</span>
cert.pem  chain.pem  fullchain.pem  privkey.pem  README

</code></pre></div><p>Ahora ponemos la configuración adecuada en el fichero https de portal.iesgn05.es</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/etc/nginx/sites-available<span style="color:#75715e"># cat /etc/nginx/sites-available/portal.iesgn05.es</span>
<span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server {

<span style="color:#75715e">#        listen 80;</span>
<span style="color:#75715e">#        listen [::]:80;</span>

        root /var/www/portal.iesgn05.es;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
	index index.html index.htm index.php;
        server_name portal.iesgn05.es;

  location / {

    <span style="color:#75715e"># First attempt to serve request as file, then</span>
    <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>

    try_files $uri $uri/ =404 @rewrite;

  }

  location @rewrite {

    <span style="color:#75715e"># Some modules enforce no slash (/) at the end of the URL</span>
    <span style="color:#75715e"># Else this rewrite block wouldnt be needed (GlobalRedirect)</span>

    rewrite ^/(.*)$ /index.php<span style="color:#66d9ef">?</span>q=$1;

  }

        location ~\.php$ {
               include snippets/fastcgi-php.conf;
               <span style="color:#75715e"># With php-fpm (or other unix sockets):</span>
               fastcgi_pass unix<span style="color:#960050;background-color:#1e0010">:</span>/run/php/php7.3-fpm.sock;
               <span style="color:#75715e"># With php-cgi (or other tcp sockets):</span>
               <span style="color:#75715e">#fastcgi_pass 127.0.0.1:9000;</span>
        }

    listen [::]<span style="color:#960050;background-color:#1e0010">:</span>443 ssl;
    listen 443 ssl;

    ssl_certificate /etc/letsencrypt/live/portal.iesgn05.es/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/portal.iesgn05.es/privkey.pem;

    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

}

</code></pre></div><h2 id="4-realiza-una-redirección-o-una-reescritura-para-que-cuando-accedas-a-http-te-redirija-al-sitio-https">4. Realiza una redirección o una reescritura para que cuando accedas a HTTP te redirija al sitio HTTPS.</h2>
<p>Fichero de configuración para http <strong>portal.iesgn05.es.http</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/etc/nginx/sites-available<span style="color:#75715e"># cat /etc/nginx/sites-available/portal.iesgn05.es.http </span>
<span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server {
    listen 80;
    listen [::]<span style="color:#960050;background-color:#1e0010">:</span>80;
    server_name portal.iesgn05.es;
    <span style="color:#66d9ef">return</span> 301 https<span style="color:#960050;background-color:#1e0010">:</span>//portal.iesgn05.es$request_uri;
}

</code></pre></div><h2 id="5-comprueba-que-se-ha-creado-una-tarea-cron-que-renueva-el-certificado-cada-3-meses">5. Comprueba que se ha creado una tarea cron que renueva el certificado cada 3 meses.</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">0 3 * * * certbot --nginx renew &gt;/dev/null 2&gt;&amp;1
</code></pre></div><p>Lo comprobamos haceiendo una simulacion</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/etc/nginx/sites-available<span style="color:#75715e"># certbot renew --dry-run</span>
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Processing /etc/letsencrypt/renewal/portal.iesgn05.es.conf
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Cert not due <span style="color:#66d9ef">for</span> renewal, but simulating renewal <span style="color:#66d9ef">for</span> dry run
Plugins selected<span style="color:#960050;background-color:#1e0010">:</span> Authenticator nginx, Installer nginx
Renewing an existing certificate
Performing the following challenges<span style="color:#960050;background-color:#1e0010">:</span>
http-01 challenge <span style="color:#66d9ef">for</span> portal.iesgn05.es
Waiting <span style="color:#66d9ef">for</span> verification...
Cleaning up challenges

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
new certificate deployed with reload of nginx server; fullchain is
/etc/letsencrypt/live/portal.iesgn05.es/fullchain.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Processing /etc/letsencrypt/renewal/www.iesgn05.es.conf
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Cert not due <span style="color:#66d9ef">for</span> renewal, but simulating renewal <span style="color:#66d9ef">for</span> dry run
Plugins selected<span style="color:#960050;background-color:#1e0010">:</span> Authenticator nginx, Installer nginx
Renewing an existing certificate
Performing the following challenges<span style="color:#960050;background-color:#1e0010">:</span>
http-01 challenge <span style="color:#66d9ef">for</span> www.iesgn05.es
Waiting <span style="color:#66d9ef">for</span> verification...
Cleaning up challenges

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
new certificate deployed with reload of nginx server; fullchain is
/etc/letsencrypt/live/www.iesgn05.es/fullchain.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
** DRY RUN<span style="color:#960050;background-color:#1e0010">:</span> simulating <span style="color:#e6db74">&#39;certbot renew&#39;</span> close to cert expiry
**          (The test certificates below have not been saved.)

Congratulations, all renewals succeeded. The following certs have been renewed<span style="color:#960050;background-color:#1e0010">:</span>
  /etc/letsencrypt/live/portal.iesgn05.es/fullchain.pem (success)
  /etc/letsencrypt/live/www.iesgn05.es/fullchain.pem (success)
** DRY RUN<span style="color:#960050;background-color:#1e0010">:</span> simulating <span style="color:#e6db74">&#39;certbot renew&#39;</span> close to cert expiry
**          (The test certificates above have not been saved.)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES<span style="color:#960050;background-color:#1e0010">:</span>
 - Your account credentials have been saved <span style="color:#66d9ef">in</span> your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.

</code></pre></div><h2 id="6-comprueba-que-las-páginas-son-accesible-por-https-y-visualiza-los-detalles-del-certificado-que-has-creado">6. Comprueba que las páginas son accesible por HTTPS y visualiza los detalles del certificado que has creado.</h2>
<p><a href="http://www.iesgn05.es">www.iesgn05.es</a></p>
<ul>
<li><img src="/images/ovh_https/certificado.png" alt="certificado.png"></li>
</ul>
<p><a href="http://www.iesgn05.es/cloud">www.iesgn05.es/cloud</a></p>
<ul>
<li><img src="/images/ovh_https/cloud_seguro.png" alt="cloud_seguro.png"></li>
</ul>
<p>portal.iesgn05.es</p>
<ul>
<li>
<p><img src="/images/ovh_https/portal_seguro.png" alt="portal_seguro.png"></p>
</li>
<li>
<p><img src="/images/ovh_https/portal_seguro1.png" alt="portal_seguro1.png"></p>
</li>
</ul>
<h2 id="7-modifica-la-configuración-del-cliente-de-nextcloud-para-comprobar-que-sigue-en-funcionamiento-con-https">7. Modifica la configuración del cliente de Nextcloud para comprobar que sigue en funcionamiento con HTTPS.</h2>
<p>Eliminamos la sincronización existente y añadimos una nueva para que se haga correctamente la redirección a https</p>
<p><img src="/images/ovh_https/cliente.png" alt="cliente.png"></p>
]]></content>
        </item>
        
        <item>
            <title>Instalación/migración de aplicaciones web PHP</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n/migraci%C3%B3n-de-aplicaciones-web-php/</link>
            <pubDate>Sat, 28 Nov 2020 20:44:54 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n/migraci%C3%B3n-de-aplicaciones-web-php/</guid>
            <description>OBJETIVO:
Realizar la migración de la aplicación drupal que tienes instalada en el entorno de desarrollo a nuestro entorno de producción, para ello ten en cuenta lo siguiente:
 1. La aplicación se tendrá que migrar a un nuevo virtualhost al que se accederá con el nombre portal.iesgnXX.es.  Crear el nuevo virtualhost portal.iesgn05.es  cp /etc/nginx/sites-available/iesgn05 /etc/nginx/sites-available/portal.iesgn05.es nano /etc/nginx/sites-available/portal.iesgn05.es # Default server configuration # server { listen 80; listen [::]:80; root /var/www/portal.</description>
            <content type="html"><![CDATA[<p>OBJETIVO:</p>
<p>Realizar la migración de la aplicación drupal que tienes instalada en el entorno de desarrollo a nuestro entorno de producción, para ello ten en cuenta lo siguiente:</p>
<hr>
<h3 id="1-la-aplicación-se-tendrá-que-migrar-a-un-nuevo-virtualhost-al-que-se-accederá-con-el-nombre-portaliesgnxxes">1. La aplicación se tendrá que migrar a un nuevo virtualhost al que se accederá con el nombre portal.iesgnXX.es.</h3>
<ul>
<li>Crear el nuevo virtualhost portal.iesgn05.es</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">cp /etc/nginx/sites-available/iesgn05 /etc/nginx/sites-available/portal.iesgn05.es
nano /etc/nginx/sites-available/portal.iesgn05.es
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server {
        listen 80;
        listen [::]<span style="color:#960050;background-color:#1e0010">:</span>80;

        root /var/www/portal.iesgn05.es;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html index.php;

        server_name portal.iesgn05.es;

        location / {
                try_files $uri $uri/ =404;
        }


        location ~\.php$ {
               include snippets/fastcgi-php.conf;
               <span style="color:#75715e"># With php-fpm (or other unix sockets):</span>
               fastcgi_pass unix<span style="color:#960050;background-color:#1e0010">:</span>/run/php/php7.3-fpm.sock;
               <span style="color:#75715e"># With php-cgi (or other tcp sockets):</span>
               <span style="color:#75715e">#fastcgi_pass 127.0.0.1:9000;</span>
        }

}

</code></pre></div><p>Creamos el directorio y el html</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mkdir /var/www/portal.iesgn05.es
nano /var/www/portal.iesgn05.es/index.html
</code></pre></div><ul>
<li>Necesitaremos otra zona DNS</li>
</ul>
<p><img src="/images/ovh_php/cname.png" alt="cname.png"></p>
<ul>
<li>Comprobamos que podemos acceder al sitio</li>
</ul>
<p><img src="/images/ovh_php/portal1.png" alt="portal1.png"></p>
<h3 id="2-vamos-a-nombrar-el-servicio-de-base-de-datos-que-tenemos-en-producción-como-es-un-servicio-interno-no-la-vamos-a-nombrar-en-la-zona-dns-la-vamos-a-nombrar-usando-resolución-estática-el-nombre-del-servicio-de-base-de-datos-se-debe-llamar-bdiesgnxxes">2. Vamos a nombrar el servicio de base de datos que tenemos en producción. Como es un servicio interno no la vamos a nombrar en la zona DNS, la vamos a nombrar usando resolución estática. El nombre del servicio de base de datos se debe llamar: bd.iesgnXX.es.</h3>
<ul>
<li>Utilizamos la resolución estática</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">127.0.0.1       bd.iesgn05.es
</code></pre></div><h3 id="3-por-lo-tanto-los-recursos-que-deberás-crear-en-la-base-de-datos-serán-respeta-los-nombres">3. Por lo tanto los recursos que deberás crear en la base de datos serán (respeta los nombres):</h3>
<ul>
<li>
<p>Dirección de la base de datos: bd.iesgnXX.es</p>
</li>
<li>
<p>Base de datos: bd_drupal</p>
</li>
<li>
<p>Usuario: user_drupal</p>
</li>
<li>
<p>Password: pass_drupal</p>
</li>
<li>
<p>Comprobamos que mariadb esta en funcionamiento</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www<span style="color:#75715e"># systemctl status mariadb</span>
<span style="color:#960050;background-color:#1e0010">●</span> mariadb.service - MariaDB 10.3.25 database server
   Loaded<span style="color:#960050;background-color:#1e0010">:</span> loaded (/lib/systemd/system/mariadb.service; enabled; vendor preset<span style="color:#960050;background-color:#1e0010">:</span> enabled)
   Active<span style="color:#960050;background-color:#1e0010">:</span> active (running) since Mon 2020-11-23 08<span style="color:#960050;background-color:#1e0010">:</span>57<span style="color:#960050;background-color:#1e0010">:</span>32 UTC; 4 days ago
     Docs<span style="color:#960050;background-color:#1e0010">:</span> man<span style="color:#960050;background-color:#1e0010">:</span>mysqld(8)
           https<span style="color:#960050;background-color:#1e0010">:</span>//mariadb.com/kb/en/library/systemd/
  <span style="color:#66d9ef">Process</span><span style="color:#960050;background-color:#1e0010">:</span> 488 ExecStartPre=/usr/bin/install -m 755 -o mysql -g root -d /var/run/mysqld (code=exited, sta
  <span style="color:#66d9ef">Process</span><span style="color:#960050;background-color:#1e0010">:</span> 517 ExecStartPre=/bin/sh -c systemctl unset-environment _WSREP_START_POSITION (code=exited, st
  <span style="color:#66d9ef">Process</span><span style="color:#960050;background-color:#1e0010">:</span> 524 ExecStartPre=/bin/sh -c [ ! -e /usr/bin/galera_recovery ] &amp;&amp; VAR= ||   VAR=`cd /usr/bin/..
  <span style="color:#66d9ef">Process</span><span style="color:#960050;background-color:#1e0010">:</span> 608 ExecStartPost=/bin/sh -c systemctl unset-environment _WSREP_START_POSITION (code=exited, s
  <span style="color:#66d9ef">Process</span><span style="color:#960050;background-color:#1e0010">:</span> 611 ExecStartPost=/etc/mysql/debian-start (code=exited, status=0/SUCCESS)
 Main PID<span style="color:#960050;background-color:#1e0010">:</span> 577 (mysqld)
   Status<span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;Taking your SQL requests now...&#34;</span>
    Tasks<span style="color:#960050;background-color:#1e0010">:</span> 30 (limit<span style="color:#960050;background-color:#1e0010">:</span> 2318)
   Memory<span style="color:#960050;background-color:#1e0010">:</span> 101.3M
   CGroup<span style="color:#960050;background-color:#1e0010">:</span> /system.slice/mariadb.service
           <span style="color:#960050;background-color:#1e0010">└─</span>577 /usr/sbin/mysqld

Warning<span style="color:#960050;background-color:#1e0010">:</span> Journal has been rotated since unit was started. Log output is incomplete or unavailable.

</code></pre></div><ul>
<li>Creamos la base de datos, y el usuario y le damos privilegios.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">MariaDB [(none)]&gt; create database bd_drupal
    -&gt; ;
Query OK, 1 row affected (0.000 sec)

MariaDB [(none)]&gt; create user <span style="color:#e6db74">&#39;user_drupal&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span>;
Query OK, 0 rows affected (0.000 sec)

MariaDB [(none)]&gt; grant all privileges on bd_drupal.* to <span style="color:#e6db74">&#39;user_drupal&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span> identified by <span style="color:#e6db74">&#39;pass_drupal&#39;</span>;
Query OK, 0 rows affected (0.000 sec)

</code></pre></div><h3 id="4-realiza-la-migración-de-la-aplicación">4. Realiza la migración de la aplicación.</h3>
<ul>
<li>Hacemos una copia de seguridad de la base de datos de local, y la mandamos a nuestro servidor. La base de datos se encuentra alojada en el cliente ya que creamos la opción multinodo que usaba la base de datos en otro nodo. Entonces entramos en el cliente y hacemos la copia de seguridad de la base de datos. Después la mandamos a nuestro servidor.</li>
</ul>
<p>Copia de seguridad:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mysqldump -v --opt --events --routines --triggers --default-character-set=utf8 -u user -p test &gt; db_backup_db_test`date +<span style="color:#66d9ef">%</span>Y<span style="color:#66d9ef">%</span>m<span style="color:#66d9ef">%</span>d_<span style="color:#66d9ef">%</span>H<span style="color:#66d9ef">%</span>M<span style="color:#66d9ef">%</span>S`.sql
</code></pre></div><p>Enviar al servidor de ovh:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~$ scp db_backup_db_test20201127_130410.sql debian@kiara.iesgn05.es<span style="color:#960050;background-color:#1e0010">:</span>/home/debian
db_backup_db_test20201127_130410.sql                       100%   11MB  20.3MB/s   00<span style="color:#960050;background-color:#1e0010">:</span>00  
</code></pre></div><ul>
<li>Pasamos el sitio web celia-drupal al servidor de ovh</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>/var/www<span style="color:#75715e"># scp celia-drupal.zip celiagm@192.168.100.11:/home/celiagm</span>

celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~$ scp celia-drupal.zip debian@kiara.iesgn05.es<span style="color:#960050;background-color:#1e0010">:</span>/home/debian

</code></pre></div><ul>
<li>Lo descomprimimos en el lugar adecuado, copiamos el contenido de nuestro sitio web a</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www<span style="color:#75715e"># unzip celia-drupal.zip </span>
root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www/celia-drupal<span style="color:#75715e"># cp -r * ../portal.iesgn05.es/</span>
</code></pre></div><ul>
<li>Restauramos la base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/home/debian<span style="color:#75715e"># mysql -u user_drupal --password=pass_drupal bd_drupal &lt; db_backup_db_test20201127_130410.sql</span>
</code></pre></div><ul>
<li>Entramos como user_drupal y comprobamos que se ha restaurado correctamente</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">MariaDB [(none)]&gt; use bd_drupal;
Reading table information <span style="color:#66d9ef">for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB <span style="color:#66d9ef">[bd_drupal]</span>&gt; show tables;
+-------------------------------------------------+
| Tables_in_bd_drupal                             |
+-------------------------------------------------+
| batch                                           |
| block_content                                   |
| block_content__body                             |
| block_content__field_clean_blog_header_backgrou |
| block_content__field_clean_blog_header_image    |
| block_content_field_data                        |
| block_content_field_revision                    |
| block_content_r__846f9b8ab9                     |
| block_content_r__93aa615698                     |
| block_content_revision                          |
| block_content_revision__body                    |
| cache_bootstrap                                 |
| cache_config                                    |
| cache_container                                 |
| cache_data                                      |
| cache_default                                   |
| cache_discovery                                 |
| cache_dynamic_page_cache                        |
| cache_entity                                    |
| cache_menu                                      |
| cache_page                                      |
| cache_render                                    |
| cache_toolbar                                   |
| cachetags                                       |
| comment                                         |
| comment__comment_body                           |
| comment_entity_statistics                       |
| comment_field_data                              |
| config                                          |
| file_managed                                    |
| file_usage                                      |
| flood                                           |
| history                                         |
| key_value                                       |
| key_value_expire                                |
| locale_file                                     |
| locales_location                                |
| locales_source                                  |
| locales_target                                  |
| menu_link_content                               |
| menu_link_content_data                          |
| menu_link_content_field_revision                |
| menu_link_content_revision                      |
| menu_tree                                       |
| node                                            |
| node__body                                      |
| node__comment                                   |
| node__field_image                               |
| node__field_tags                                |
| node_access                                     |
| node_field_data                                 |
| node_field_revision                             |
| node_revision                                   |
| node_revision__body                             |
| node_revision__comment                          |
| node_revision__field_image                      |
| node_revision__field_tags                       |
| path_alias                                      |
| path_alias_revision                             |
| queue                                           |
| router                                          |
| search_dataset                                  |
| search_index                                    |
| search_total                                    |
| semaphore                                       |
| sequences                                       |
| sessions                                        |
| shortcut                                        |
| shortcut_field_data                             |
| shortcut_set_users                              |
| taxonomy_index                                  |
| taxonomy_term__parent                           |
| taxonomy_term_data                              |
| taxonomy_term_field_data                        |
| taxonomy_term_field_revision                    |
| taxonomy_term_revision                          |
| taxonomy_term_revision__parent                  |
| user__roles                                     |
| user__user_picture                              |
| users                                           |
| users_data                                      |
| users_field_data                                |
| votingapi_result                                |
| votingapi_vote                                  |
| watchdog                                        |
+-------------------------------------------------+
85 rows <span style="color:#66d9ef">in</span> set (0.001 sec)

</code></pre></div><ul>
<li>Tenemos que modificar un fichero de configuración que es settings.php que se encuentra en nuestro virtualhosting del servidor. Nos vamos al final del fichero y vemos la configuración de las bases de datos que vamos a modificar, actualmente tiene este aspecto que apuntaba a nuestra anterior base de datos que hemos eliminado.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano /var/www/portal.iesgn05.es/drupal-9.0.7/sites/<span style="color:#66d9ef">default</span>/settings.php 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$databases[<span style="color:#e6db74">&#39;default&#39;</span>][<span style="color:#e6db74">&#39;default&#39;</span>] = array (
  <span style="color:#e6db74">&#39;database&#39;</span> =&gt; <span style="color:#e6db74">&#39;bd_drupal&#39;</span>,
  <span style="color:#e6db74">&#39;username&#39;</span> =&gt; <span style="color:#e6db74">&#39;user_drupal&#39;</span>,
  <span style="color:#e6db74">&#39;password&#39;</span> =&gt; <span style="color:#e6db74">&#39;pass_drupal&#39;</span>,
  <span style="color:#e6db74">&#39;prefix&#39;</span> =&gt; <span style="color:#e6db74">&#39;&#39;</span>,
  <span style="color:#e6db74">&#39;host&#39;</span> =&gt; <span style="color:#e6db74">&#39;bd.iesgn05.es&#39;</span>,
  <span style="color:#e6db74">&#39;port&#39;</span> =&gt; <span style="color:#e6db74">&#39;3306&#39;</span>,
  <span style="color:#e6db74">&#39;namespace&#39;</span> =&gt; <span style="color:#e6db74">&#39;Drupal\\Core\\Database\\Driver\\mysql&#39;</span>,
  <span style="color:#e6db74">&#39;driver&#39;</span> =&gt; <span style="color:#e6db74">&#39;mysql&#39;</span>,
);

</code></pre></div><ul>
<li>Nos aseguramos que tenemos instalado php y los módulos necesarios</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">apt-get install php php-mysql php-xml
</code></pre></div><ul>
<li>Reiniciamos el servicio de mariadb y nginx</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">systemctl restart mariadb
systemctl restart nginx
</code></pre></div><h3 id="5-asegurate-que-las-url-limpias-de-drupal-siguen-funcionando-en-nginx">5. Asegurate que las URL limpias de drupal siguen funcionando en nginx.</h3>
<p>Siguiendo esta <a href="http://www.kreanto.com/es/blog/configurando-las-url-limpias-drupal-un-servidor-web-nginx">guía</a>:</p>
<p>Añadimos el sistema de url limipas en Drupal.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server {
        listen 80;
        listen [::]<span style="color:#960050;background-color:#1e0010">:</span>80;

        root /var/www/portal.iesgn05.es;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>

        index index.html index.htm index.php;
        server_name portal.iesgn05.es;

        location / {
                try_files $uri $uri/ =404 @rewrite;
        }


        location ~\.php$ {
               include snippets/fastcgi-php.conf;
               <span style="color:#75715e"># With php-fpm (or other unix sockets):</span>
               fastcgi_pass unix<span style="color:#960050;background-color:#1e0010">:</span>/run/php/php7.3-fpm.sock;
               <span style="color:#75715e"># With php-cgi (or other tcp sockets):</span>
               <span style="color:#75715e">#fastcgi_pass 127.0.0.1:9000;</span>
        }


         location @rewrite {

         <span style="color:#75715e"># Some modules enforce no slash (/) at the end of the URL</span>
         <span style="color:#75715e"># Else this rewrite block wouldnt be needed (GlobalRedirect)</span>

         rewrite ^/(.*)$ /index.php<span style="color:#66d9ef">?</span>q=$1;

         }

}

</code></pre></div><p>Comprobamos el funcionamiento</p>
<p><img src="/images/ovh_php/funcionamiento1.png" alt="funcionamiento1.png"></p>
<h3 id="6-la-aplicación-debe-estar-disponible-en-la-url-portaliesgnxxes-sin-ningún-directorio">6. La aplicación debe estar disponible en la URL: portal.iesgnXX.es (Sin ningún directorio).</h3>
<p>Copiamos el contenido al directorio de nuestro virtualhost</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www/portal.iesgn05.es<span style="color:#75715e"># cp -r /home/debian/drupal-9.0.7/ .</span>
root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www/portal.iesgn05.es<span style="color:#75715e"># rm index.html </span>
root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www/portal.iesgn05.es<span style="color:#75715e"># ls -a</span>
.	       composer.lock  drupal-9.0.7    example.gitignore  index.php    profiles	  themes
..	       core	      .editorconfig   .gitattributes	 INSTALL.txt  README.txt  update.php
autoload.php   .csslintrc     .eslintignore   .htaccess		 LICENSE.txt  robots.txt  vendor
composer.json  drupal	      .eslintrc.json  .ht.router.php	 modules      sites	  web.config

root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/var/www/portal.iesgn05.es<span style="color:#75715e"># systemctl restart nginx</span>

</code></pre></div><p>Comprobamos que funciona</p>
<ul>
<li>
<p><img src="/images/ovh_php/funcionamiento2.png" alt="funcionamiento2.png"></p>
</li>
<li>
<p><img src="/images/ovh_php/func3.png" alt="func3.png"></p>
</li>
</ul>
<h2 id="instalación--migración-de-la-aplicación-nextcloud">Instalación / migración de la aplicación Nextcloud</h2>
<h3 id="1-instala-la-aplicación-web-nextcloud-en-tu-entorno-de-desarrollo">1. Instala la aplicación web Nextcloud en tu entorno de desarrollo.</h3>
<ul>
<li>Descargamos <a href="https://download.nextcloud.com/server/releases/nextcloud-20.0.2.zip">Nextcloud</a> para servidores. Lo podemos descargar y pasar al sevidor o directamente descargar con wget copiando el enlace.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">wget https<span style="color:#960050;background-color:#1e0010">:</span>//download.nextcloud.com/server/releases/nextcloud-20.0.2.zip
</code></pre></div><ul>
<li>Vamos a crear un virtualhosting para nextcloud, para ello creamos el directorio del documentroot:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mkdir /var/www/nextcloud
mv nextcloud-20.0.2.zip /var/www/nextcloud/
unzip /var/www/nextcloud-20.0.2.zip 
chown -R www-data<span style="color:#960050;background-color:#1e0010">:</span>www-data /var/www/nextcloud/
</code></pre></div><ul>
<li>Creamos la base de datos necesaria para nextcloud y el usuario que la va administrar, le damos los privilegios</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>~<span style="color:#75715e"># mysql -u root -p</span>
Enter password<span style="color:#960050;background-color:#1e0010">:</span> 
Welcome to the MariaDB monitor.  Commands <span style="color:#66d9ef">end</span> with ; or \g.
Your MariaDB connection id is 36
Server version<span style="color:#960050;background-color:#1e0010">:</span> 10.3.25-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB [(none)]&gt; create database nextcloud;
Query OK, 1 row affected (0.002 sec)

MariaDB [(none)]&gt; create user <span style="color:#e6db74">&#39;user_next&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
Query OK, 0 rows affected (0.005 sec)

MariaDB [(none)]&gt; grant all privileges on nextcloud.* to <span style="color:#e6db74">&#39;user_next&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> identified by <span style="color:#e6db74">&#39;pass_next&#39;</span>;
Query OK, 0 rows affected (0.003 sec)

MariaDB [(none)]&gt; flush privileges;
Query OK, 0 rows affected (0.002 sec)


</code></pre></div><ul>
<li>Ahora creamos el virtualhosting para nextcloud</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">cp /etc/apache2/sites-available/celia-drupal.conf /etc/apache2/sites-available/nextcloud.conf
nano /etc/apache2/sites-available/nextcloud.conf

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">&lt;VirtualHost *<span style="color:#960050;background-color:#1e0010">:</span>80&gt;
        ServerName www.celia.nextcloud.org
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/nextcloud
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">a2ensite nexcloud.conf
systemctl restart apache2
systemctl restart mariadb
</code></pre></div><ul>
<li>Nos salen ciertos errores porque necesitamos instalar varios módulos</li>
</ul>
<p><img src="/images/ovh_php/error1.png" alt="error1.png"></p>
<ul>
<li>Los instalamos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">apt-get install php-zip php-curl php-intl php-imagick php-xml
</code></pre></div><ul>
<li>Comprobamos que funciona</li>
</ul>
<p><img src="/images/ovh_php/inst_next.png" alt="inst_next.png"></p>
<h3 id="instalación-de-nextcloud">Instalación de NextCloud</h3>
<p>Nos pide que pongamos un usuario y una contraseña. Ademas vamos a indicar el nombre de la base de datos, el nombre del usuario y contraseña que administra la base de datos y el host, en este caso sera localhost.</p>
<p><img src="/images/ovh_php/datos.png" alt="datos.png"></p>
<p>Y le damos a &lsquo;Finish Setup&rsquo;, así comenzará la instalación</p>
<p><img src="/images/ovh_php/apps.png" alt="apps.png"></p>
<p>Comprobamos que ya tenemos nextcloud operativo</p>
<p><img src="/images/ovh_php/funcionamiento10.png" alt="funcionamiento10.png"></p>
<h3 id="2-realiza-la-migración-al-servidor-en-producción-para-que-la-aplicación-sea-accesible-en-la-url-wwwiesgnxxescloud">2. Realiza la migración al servidor en producción, para que la aplicación sea accesible en la URL: <a href="http://www.iesgnXX.es/cloud">www.iesgnXX.es/cloud</a></h3>
<ul>
<li>Hacemos una copia de la base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mysqldump -v --opt --events --routines --triggers --default-character-set=utf8 -u user_next -p nextcloud &gt; db_backup_nextcloud`date +<span style="color:#66d9ef">%</span>Y<span style="color:#66d9ef">%</span>m<span style="color:#66d9ef">%</span>d_<span style="color:#66d9ef">%</span>H<span style="color:#66d9ef">%</span>M<span style="color:#66d9ef">%</span>S`.sql
</code></pre></div><ul>
<li>Comprimimos el directorio &lsquo;nextcloud&rsquo;</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">zip -r nextcloud nextcloud
</code></pre></div><ul>
<li>Los enviamos a nuestro servidor en producción por scp</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>/var/www<span style="color:#75715e"># scp nextcloud.zip debian@kiara.iesgn05.es:/home/debian</span>
The authenticity of host <span style="color:#e6db74">&#39;kiara.iesgn05.es (146.59.196.84)&#39;</span> can<span style="color:#e6db74">&#39;t be established.
</span><span style="color:#e6db74">ECDSA key fingerprint is SHA256:/9MCxCfHcwtoje2tVFGYmtJ1kWZj5fqlDbRBYzOXzJg.
</span><span style="color:#e6db74">Are you sure you want to continue connecting (yes/no)? yes
</span><span style="color:#e6db74">Warning: Permanently added &#39;</span>kiara.iesgn05.es,146.59.196.84<span style="color:#e6db74">&#39; (ECDSA) to the list of known hosts.
</span><span style="color:#e6db74">debian@kiara.iesgn05.es&#39;</span>s password<span style="color:#960050;background-color:#1e0010">:</span> 
nextcloud.zip                                                          100%  199MB  28.4MB/s   00<span style="color:#960050;background-color:#1e0010">:</span>07    
root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>/var/www<span style="color:#75715e"># cd </span>
root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>~<span style="color:#75715e"># ls</span>
db_backup_nextcloud20201128_143440.sql	drupal.tar.gz
root@debian-cms<span style="color:#960050;background-color:#1e0010">:</span>~<span style="color:#75715e"># scp db_backup_nextcloud20201128_143440.sql debian@kiara.iesgn05.es:/home/debian</span>
debian@kiara.iesgn05.es<span style="color:#960050;background-color:#1e0010">&#39;</span>s password<span style="color:#960050;background-color:#1e0010">:</span> 
db_backup_nextcloud20201128_143440.sql    
</code></pre></div><ul>
<li>Creamos la base de datos y el usuario en nuestro servidor en producción</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@kiara<span style="color:#960050;background-color:#1e0010">:</span>/home/debian<span style="color:#75715e"># mysql -u root -p</span>
Enter password<span style="color:#960050;background-color:#1e0010">:</span> 
Welcome to the MariaDB monitor.  Commands <span style="color:#66d9ef">end</span> with ; or \g.
Your MariaDB connection id is 1403
Server version<span style="color:#960050;background-color:#1e0010">:</span> 10.3.25-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB [(none)]&gt; create database nextcloud;
Query OK, 1 row affected (0.000 sec)

MariaDB [(none)]&gt; create user <span style="color:#e6db74">&#39;user_next&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span>;
Query OK, 0 rows affected (0.000 sec)

MariaDB [(none)]&gt; grant all privileges on nextcloud.* to <span style="color:#e6db74">&#39;user_next&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span> identified by <span style="color:#e6db74">&#39;pass_next&#39;</span>;
Query OK, 0 rows affected (0.001 sec)

MariaDB [(none)]&gt; flush privileges;
Query OK, 0 rows affected (0.000 sec)

</code></pre></div><ul>
<li>Restauramos la base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mysql -u user_next --password=pass_next nextcloud &lt; db_backup_nextcloud20201128_143440.sql 
</code></pre></div><ul>
<li>Descomprimimos el directorio en /var/www/iesgn05/cloud</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">mv nextcloud.zip /var/www/
unzip nextcloud.zip 
chown -R www-data<span style="color:#960050;background-color:#1e0010">:</span>www-data cloud
</code></pre></div><ul>
<li>Configuramos nuestro virtualhost iesgn05 para que al acceder a <a href="http://www.iesgn05.es/cloud">www.iesgn05.es/cloud</a> nos muestre el servicio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server {
        listen 80;
        listen [::]<span style="color:#960050;background-color:#1e0010">:</span>80;

        server_name www.iesgn05.es;

        root /var/www/iesgn05;


        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.php;

        location =/ {
                <span style="color:#66d9ef">return</span> 301 $scheme<span style="color:#960050;background-color:#1e0010">:</span>//www.iesgn05.es/principal;

                try_files $uri $uri/ =404;
        }




        location @rewrite {
                <span style="color:#75715e"># Some modules enforce no slash (/) at the end of the URL</span>
                <span style="color:#75715e"># Else this rewrite block wouldnt be needed (GlobalRedirect)</span>

                rewrite ^/(.*)$ /index.php<span style="color:#66d9ef">?</span>q=$1;
        }

        <span style="color:#75715e"># pass PHP scripts to FastCGI server</span>
        location ~ \.php$ {
                include snippets/fastcgi-php.conf;

                <span style="color:#75715e"># With php-fpm (or other unix sockets):</span>
                fastcgi_pass unix<span style="color:#960050;background-color:#1e0010">:</span>/run/php/php7.3-fpm.sock;
                <span style="color:#75715e"># With php-cgi (or other tcp sockets):</span>
                <span style="color:#75715e">#fastcgi_pass 127.0.0.1:9000;</span>
        }

location = /robots.txt {
                allow all;
                log_not_found off;
                access_log off;
        }

        location /.well-known {
                rewrite ^/\.well-known/host-meta\.json  /cloud/public.php<span style="color:#66d9ef">?</span>service=host-meta-json    last;
                rewrite ^/\.well-known/host-meta        /cloud/public.php<span style="color:#66d9ef">?</span>service=host-meta         last;
                rewrite ^/\.well-known/webfinger        /cloud/public.php<span style="color:#66d9ef">?</span>service=webfinger         last;
                rewrite ^/\.well-known/nodeinfo         /cloud/public.php<span style="color:#66d9ef">?</span>service=nodeinfo          last;

                location = /.well-known/carddav   { <span style="color:#66d9ef">return</span> 301 /cloud/remote.php/dav/; }
                location = /.well-known/caldav    { <span style="color:#66d9ef">return</span> 301 /cloud/remote.php/dav/; }

                try_files $uri $uri/ =404;
        }

        location ^~ /cloud {
                client_max_body_size 512M;
                fastcgi_buffers 64 4K;

                gzip on;
                gzip_vary on;
                gzip_comp_level 4;
                gzip_min_length 256;
                gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;
                gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject a$

                add_header Referrer-Policy                      <span style="color:#e6db74">&#34;no-referrer&#34;</span>   always;
                add_header X-Content-Type-Options               <span style="color:#e6db74">&#34;nosniff&#34;</span>       always;
                add_header X-Download-Options                   <span style="color:#e6db74">&#34;noopen&#34;</span>        always;
                add_header X-Frame-Options                      <span style="color:#e6db74">&#34;SAMEORIGIN&#34;</span>    always;
                add_header X-Permitted-Cross-Domain-Policies    <span style="color:#e6db74">&#34;none&#34;</span>          always;
                add_header X-Robots-Tag                         <span style="color:#e6db74">&#34;none&#34;</span>          always;
                add_header X-XSS-Protection                     <span style="color:#e6db74">&#34;1; mode=block&#34;</span> always;

                fastcgi_hide_header X-Powered-By;
                index index.php index.html /cloud/index.php$request_uri;

                expires 1m;

        location = /cloud {
            <span style="color:#66d9ef">if</span> ( $http_user_agent ~ ^DavClnt ) {
                <span style="color:#66d9ef">return</span> 302 /cloud/remote.php/webdav/$is_args$args;
            }
        }

        location ~ ^/cloud/(?<span style="color:#960050;background-color:#1e0010">:</span>build|tests|config|lib|3rdparty|templates|data)(?<span style="color:#960050;background-color:#1e0010">:</span>$|/)    { <span style="color:#66d9ef">return</span> 404; }
        location ~ ^/cloud/(?<span style="color:#960050;background-color:#1e0010">:</span>\.|autotest|occ|issue|indie|db_|console)                { <span style="color:#66d9ef">return</span> 404; }

        location ~ \.php(?<span style="color:#960050;background-color:#1e0010">:</span>$|/) {
            fastcgi_split_path_info ^(.+?\.php)(/.*)$;
            set $path_info $fastcgi_path_info;

            try_files $fastcgi_script_name =404;

            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            fastcgi_param PATH_INFO $path_info;

            fastcgi_param modHeadersAvailable true;
            fastcgi_param front_controller_active true;
            fastcgi_pass unix<span style="color:#960050;background-color:#1e0010">:</span>/run/php/php7.3-fpm.sock;

            fastcgi_intercept_errors on;
            fastcgi_request_buffering off;
        }

        location ~ \.(?<span style="color:#960050;background-color:#1e0010">:</span>css|js|svg|gif)$ {
            try_files $uri /cloud/index.php$request_uri;
            expires 6M;
            access_log off;
        }

        location ~ \.woff2?$ {
            try_files $uri /cloud/index.php$request_uri;
            expires 7d;
            access_log off;
        }

        location /cloud {
            try_files $uri $uri/ /cloud/index.php$request_uri;
        }
}


}

</code></pre></div><p>Comprobamos que funciona</p>
<ul>
<li>
<p><img src="/images/ovh_php/next7.png" alt="next7.png"></p>
</li>
<li>
<p><img src="/images/ovh_php/next8.png" alt="next8.png"></p>
</li>
</ul>
<h3 id="3-instala-en-un-ordenador-el-cliente-de-nextcloud-y-realiza-la-configuración-adecuada-para-acceder-a-tu-nube">3. Instala en un ordenador el cliente de nextcloud y realiza la configuración adecuada para acceder a &ldquo;tu nube&rdquo;.</h3>
<p>Instalar paquete</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ sudo apt install nextcloud-desktop
</code></pre></div><p>Ejecutamos el software, en este caso como hemos elegido nuestra máquina fisica hemos escogido el entorno gráfico</p>
<ul>
<li><img src="/images/ovh_php/cliente1.png" alt="cliente1.png"></li>
</ul>
<p>Ponemos la dirección del servidor. Nos mostraŕa un mensaje de advertencia porque no es un sitio seguro y le damos a continuar.</p>
<p>Nos pide el usuario y la contraseña, le pasamos las credenciales y continuamos.</p>
<p>Nos pide configurar las opciones de la carpeta local. Si desea sincronizar carpetas. Y elegir que carpeta vamos a elegir en para la subida y bajada de datos</p>
<ul>
<li><img src="/images/ovh_php/cliente3.png" alt="cliente3.png"></li>
</ul>
<p>Vemos que se sincroniza correctamente</p>
<ul>
<li><img src="/images/ovh_php/cliente4.png" alt="cliente4.png"></li>
</ul>
<p>Podemos comprobar que se ha sincronizado correctamente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/Nextcloud$ ls
 Documents               Nextcloud.png                   Talk
<span style="color:#e6db74">&#39;Nextcloud intro.mp4&#39;</span>    Photos
<span style="color:#e6db74">&#39;Nextcloud Manual.pdf&#39;</span>  <span style="color:#e6db74">&#39;Reasons to use Nextcloud.pdf&#39;</span>

</code></pre></div><p>Vamos a probar el funcionamiento:</p>
<p>Creamos un fichero de texto en la carpeta Nextcloud</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">touch fichero.txt
</code></pre></div><p>Vamos a la dirección de nuestro cloud en el navegador y comprobamos que se ha subido correctamente</p>
<ul>
<li>
<p><img src="/images/ovh_php/fichero.png" alt="fichero.png"></p>
</li>
<li>
<p><img src="/images/ovh_php/fichero1.png" alt="fichero1.png"></p>
</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Instalar Openstackclient y deshabilitar la seguridad de puertos</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalar-openstackclient-y-deshabilitar-la-seguridad-de-puertos/</link>
            <pubDate>Thu, 19 Nov 2020 19:31:53 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalar-openstackclient-y-deshabilitar-la-seguridad-de-puertos/</guid>
            <description>Necesitamos instalar Openstackclient, para ello lo vamos hacer desde un entorno virtual para no comprometer la paquetería de nuestro sistema, ya que no es necesario para nuestro sistema actualmente.
 Recordamos como creamos un entorno virtual con venv
 Instalamos el paquete necesario para instalar módulos:  apt-get install python3-venv  Desde el usuario sin privilegios podemos crear un entorno virtual con python3:  python3 -m venv entorno  Activar y desactivar el entorno  source entorno/bin/activate (entorno)$ deactivate  Usando el entorno virtual creado previamente, vamos a instalar el paquete Openstackclient (necesitaremos la libreria de python3).</description>
            <content type="html"><![CDATA[<p>Necesitamos instalar <em>Openstackclient</em>, para ello lo vamos hacer desde un entorno virtual para no comprometer la paquetería de nuestro sistema, ya que no es necesario para nuestro sistema actualmente.</p>
<hr>
<p>Recordamos como creamos un <strong>entorno virtual</strong> con <em>venv</em></p>
<ul>
<li>Instalamos el paquete necesario para instalar módulos:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt-get install python3-venv
</code></pre></div><ul>
<li>Desde el usuario sin privilegios podemos crear un entorno virtual con python3:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python3 -m venv entorno
</code></pre></div><ul>
<li>Activar y desactivar el entorno</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">source entorno/bin/activate
<span style="color:#f92672">(</span>entorno<span style="color:#f92672">)</span>$ deactivate
</code></pre></div><hr>
<p>Usando el entorno virtual creado previamente, vamos a instalar el paquete Openstackclient (<em>necesitaremos la libreria de python3</em>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install python3-dev
pip install python-openstackclient
</code></pre></div><p>Nos vamos al &lsquo;<em>Acceso y Seguridad</em>&rsquo; del cloud y descargamos el fichero con las variables de entorno de nuestro proyecto. Este fichero tiene una extensión sh. Este script se ejecuta desde nuestro entorno virtual en el directorio del mismo. Pero antes deberemos de editar el fichero proporcionando la ruta del certificado del IES, añadiendo las siguiente línea (la ruta puede variar dependiendo de donde tengamos el certificado).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">export OS_CACERT=/usr/local/share/ca-certificates/gonzalonazareno.crt
</code></pre></div><p>A tener en cuenta:</p>
<ul>
<li>Deberemos de tener en nuestro fichero /etc/hosts bien configurada la ip con el nombre del cloud, siendo este:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ sudo nano /etc/hosts
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">172.22.222.1    jupiter.gonzalonazareno.org
</code></pre></div><ul>
<li>Como hemos dicho anteriormente el script debe estar ubicado dentro de nuestro entorno virtual. Lo ejecutamos con <strong>source</strong> y le pasamos la contraseña</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">
(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ source Proyecto\ de\ celia.garcia-openrc.sh
Please enter your OpenStack Password <span style="color:#66d9ef">for</span> project Proyecto de celia.garcia as user celia.garcia<span style="color:#960050;background-color:#1e0010">:</span> 
</code></pre></div><ul>
<li>Ahora listamos los servidores que tenemos en nuestro proyecto</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ openstack server list

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">
(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ openstack server list
+--------------------------------------+----------------+--------+---------------------------------------------------------------------+--------------------------------+---------+
| ID                                   | Name           | Status | Networks                                                            | Image                          | Flavor  |
+--------------------------------------+----------------+--------+---------------------------------------------------------------------+--------------------------------+---------+
| c39a7cc7-f485-4617-a62f-acdd39a19682 | Dulcinea       | ACTIVE | celia.garcia=10.0.1.6; red de celia.garcia=10.0.0.3, 172.22.200.222 | Debian Buster 10.6             | m1.mini |
| e23fc109-de1b-4bdf-8b88-cf7b2721350c | Quijote        | ACTIVE | celia.garcia=10.0.1.13                                              | CentOS 7                       | m1.mini |
| 26e2f672-2408-40d8-bcec-752059db35fa | Sancho         | ACTIVE | celia.garcia=10.0.1.11                                              | Ubuntu 20.04 LTS (focal fossa) | m1.mini |
| a460fd00-f4d7-4999-bc05-a42f54e3dd56 | cliente_nginx  | ACTIVE | red de celia.garcia=10.0.0.6, 172.22.200.148                        | Debian Buster 10.6             | m1.mini |
| d88962ae-4617-4fe3-be33-c1bbfe686c69 | servidor_nginx | ACTIVE | red de celia.garcia=10.0.0.5, 172.22.200.152                        | Debian Buster 10.6             | m1.mini |
+--------------------------------------+----------------+--------+---------------------------------------------------------------------+--------------------------------+---------+

</code></pre></div><ul>
<li>Listamos las redes que tenemos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ openstack network list
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">+--------------------------------------+---------------------+----------------------------------------------------------------------------+
| ID                                   | Name                | Subnets                                                                    |
+--------------------------------------+---------------------+----------------------------------------------------------------------------+
| 21124241-dddf-4c06-b646-eb15ed5cd84a | celia.garcia        | 46e30aa0-10de-4883-a8c7-707b5a884eec                                       |
| 49812d85-8e7a-4c31-baa2-d427692f6568 | ext-net             | 158bbe3e-3c98-485e-8042-ba6402111ea6, 6218710b-aa05-46f7-b198-7639efe3da95 |
| 90c37b05-bd26-49a3-b797-c6038b49a169 | red de celia.garcia | 029d2907-1315-41f3-af12-c1285ceb43d2                                       |

</code></pre></div><ul>
<li>Listar los puertos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ openstack port list
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ openstack port list
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------+--------+
| ID                                   | Name | MAC Address       | Fixed IP Addresses                                                       | Status |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------+--------+
| 73876736-71bc-4bfc-b240-e2bb0f1ca505 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>f7<span style="color:#960050;background-color:#1e0010">:</span>be<span style="color:#960050;background-color:#1e0010">:</span>35 | ip_address=<span style="color:#e6db74">&#39;10.0.1.13&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;46e30aa0-10de-4883-a8c7-707b5a884eec&#39;</span> | ACTIVE |
| 85b0d349-4240-4ea5-b277-fbd2bef00928 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>77<span style="color:#960050;background-color:#1e0010">:</span>40<span style="color:#960050;background-color:#1e0010">:</span>7a | ip_address=<span style="color:#e6db74">&#39;10.0.0.3&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;029d2907-1315-41f3-af12-c1285ceb43d2&#39;</span>  | ACTIVE |
| a9bdd25d-cd44-44e1-96f3-fb5228872245 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>04<span style="color:#960050;background-color:#1e0010">:</span>0d<span style="color:#960050;background-color:#1e0010">:</span>c4 | ip_address=<span style="color:#e6db74">&#39;10.0.0.1&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;029d2907-1315-41f3-af12-c1285ceb43d2&#39;</span>  | ACTIVE |
| b20a13b0-107c-44e1-91ad-b05c4c4ab6fb |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>eb<span style="color:#960050;background-color:#1e0010">:</span>33<span style="color:#960050;background-color:#1e0010">:</span>51 | ip_address=<span style="color:#e6db74">&#39;10.0.0.2&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;029d2907-1315-41f3-af12-c1285ceb43d2&#39;</span>  | ACTIVE |
| d6d4a998-73e9-4bc0-9ad1-57b481c146c5 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>08<span style="color:#960050;background-color:#1e0010">:</span>7a<span style="color:#960050;background-color:#1e0010">:</span>18 | ip_address=<span style="color:#e6db74">&#39;10.0.0.6&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;029d2907-1315-41f3-af12-c1285ceb43d2&#39;</span>  | ACTIVE |
| d87620fe-c4e4-47e1-9381-ee47211795e3 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>e8<span style="color:#960050;background-color:#1e0010">:</span>a3<span style="color:#960050;background-color:#1e0010">:</span>f7 | ip_address=<span style="color:#e6db74">&#39;10.0.1.2&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;46e30aa0-10de-4883-a8c7-707b5a884eec&#39;</span>  | ACTIVE |
| dac3549b-9fb3-488d-b399-ed7ee94ea724 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>9a<span style="color:#960050;background-color:#1e0010">:</span>c0<span style="color:#960050;background-color:#1e0010">:</span>6a | ip_address=<span style="color:#e6db74">&#39;10.0.0.5&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;029d2907-1315-41f3-af12-c1285ceb43d2&#39;</span>  | ACTIVE |
| e99aaf3f-c607-4d1d-9e05-fec50b132296 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>f2<span style="color:#960050;background-color:#1e0010">:</span>65<span style="color:#960050;background-color:#1e0010">:</span>68 | ip_address=<span style="color:#e6db74">&#39;10.0.1.11&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;46e30aa0-10de-4883-a8c7-707b5a884eec&#39;</span> | ACTIVE |
| fa58e181-e88f-4453-8f20-c4bd7d190179 |      | fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>e0<span style="color:#960050;background-color:#1e0010">:</span>bc<span style="color:#960050;background-color:#1e0010">:</span>db | ip_address=<span style="color:#e6db74">&#39;10.0.1.6&#39;</span>, subnet_id=<span style="color:#e6db74">&#39;46e30aa0-10de-4883-a8c7-707b5a884eec&#39;</span>  | ACTIVE |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------+--------+


</code></pre></div><hr>
<h3 id="deshabilitar-seguridad-de-un-puerto">Deshabilitar seguridad de un puerto</h3>
<ul>
<li>Vemos las caracteristicas de Dulcinea</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ openstack server show Dulcinea
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ openstack server show Dulcinea
+-----------------------------+---------------------------------------------------------------------+
| Field                       | Value                                                               |
+-----------------------------+---------------------------------------------------------------------+
| OS-DCF<span style="color:#960050;background-color:#1e0010">:</span>diskConfig           | AUTO                                                                |
| OS-EXT-AZ<span style="color:#960050;background-color:#1e0010">:</span>availability_zone | nova                                                                |
| OS-EXT-STS<span style="color:#960050;background-color:#1e0010">:</span>power_state      | Running                                                             |
| OS-EXT-STS<span style="color:#960050;background-color:#1e0010">:</span>task_state       | None                                                                |
| OS-EXT-STS<span style="color:#960050;background-color:#1e0010">:</span>vm_state         | active                                                              |
| OS-SRV-USG<span style="color:#960050;background-color:#1e0010">:</span>launched_at      | 2020-11-19T20<span style="color:#960050;background-color:#1e0010">:</span>28<span style="color:#960050;background-color:#1e0010">:</span>18.000000                                          |
| OS-SRV-USG<span style="color:#960050;background-color:#1e0010">:</span>terminated_at    | None                                                                |
| accessIPv4                  |                                                                     |
| accessIPv6                  |                                                                     |
| addresses                   | celia.garcia=10.0.1.6; red de celia.garcia=10.0.0.3, 172.22.200.222 |
| config_drive                |                                                                     |
| created                     | 2020-11-19T20<span style="color:#960050;background-color:#1e0010">:</span>27<span style="color:#960050;background-color:#1e0010">:</span>57Z                                                |
| flavor                      | m1.mini (12)                                                        |
| hostId                      | 829ef6cbc520f728c22007cd80702af381d72417f6ce13fbdcbf53e5            |
| id                          | c39a7cc7-f485-4617-a62f-acdd39a19682                                |
| image                       | Debian Buster 10.6 (51b38ecf-99e1-46a3-a497-9e1cc9c3c2d4)           |
| key_name                    | msi                                                                 |
| name                        | Dulcinea                                                            |
| progress                    | 0                                                                   |
| project_id                  | bf33696e5463476b95e310dd1e17f5f3                                    |
| properties                  |                                                                     |
| status                      | ACTIVE                                                              |
| updated                     | 2020-11-23T12<span style="color:#960050;background-color:#1e0010">:</span>04<span style="color:#960050;background-color:#1e0010">:</span>44Z                                                |
| user_id                     | bdfca7c57468ff40b7445535735bf867c444239818b740f4f59474b105c27dec    |
| volumes_attached            |                                                                     |
+-----------------------------+---------------------------------------------------------------------+

</code></pre></div><ul>
<li>Le quitamos el grupo de seguridad</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">openstack server remove security group Dulcinea <span style="color:#66d9ef">default</span>
</code></pre></div><ul>
<li>
<p>Miramos la ip fija que tiene , en este caso es la 10.0.0.11</p>
</li>
<li>
<p>Listamos los puertos y obtenemos el identificador de la máquina según la ip</p>
</li>
<li>
<p>Le quitamos la seguridad de puertos tanto de la red interna como de la red externa.</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">openstack port set --disable-port-security fa58e181-e88f-4453-8f20-c4bd7d190179
openstack port set --disable-port-security 85b0d349-4240-4ea5-b277-fbd2bef00928
</code></pre></div><ul>
<li>Ahora comprobamos la conexión y vemos que es correcta:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ ping 172.22.200.222
PING 172.22.200.222 (172.22.200.222) 56(84) bytes of data.
64 bytes from 172.22.200.222<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=1 ttl=61 time=71.1 ms
64 bytes from 172.22.200.222<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=2 ttl=61 time=70.1 ms
64 bytes from 172.22.200.222<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=3 ttl=61 time=95.5 ms
^C
--- 172.22.200.222 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 4ms
rtt min/avg/max/mdev = 70.115/78.910/95.549/11.771 ms
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(entorno) celiagm@debian<span style="color:#960050;background-color:#1e0010">:</span>~/venv/entorno$ ssh debian@172.22.200.222
Linux dulcinea 4.19.0-12-cloud-amd64 <span style="color:#75715e">#1 SMP Debian 4.19.152-1 (2020-10-18) x86_64</span>

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms <span style="color:#66d9ef">for</span> each program are described <span style="color:#66d9ef">in</span> the
individual files <span style="color:#66d9ef">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login<span style="color:#960050;background-color:#1e0010">:</span> Mon Nov 23 15<span style="color:#960050;background-color:#1e0010">:</span>59<span style="color:#960050;background-color:#1e0010">:</span>42 2020 from 172.23.0.70
debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ 

</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Crear Autoridad Certificadora y Certificado autofirmado</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/crear-autoridad-certificadora-y-certificado-autofirmado/</link>
            <pubDate>Thu, 19 Nov 2020 18:51:45 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/crear-autoridad-certificadora-y-certificado-autofirmado/</guid>
            <description>HTTPS / SSL Tarea 1: Certificado autofirmado PARTE 1 OBJETIVO:
Crear su autoridad certificadora (generar el certificado digital de la CA). Mostrar el fichero de configuración de la AC.
Conocimientos previos:
OpenSSL permite con una serie de comandos crear una autoridad de certificación o CA en la que los servidores y clientes internos confien. Las funciones de la CA incluyen crear certificados a partir de las solicitudes de los certificados para los servidores y también la revocación y renovación de certificados.</description>
            <content type="html"><![CDATA[<h1 id="https--ssl">HTTPS / SSL</h1>
<h2 id="tarea-1-certificado-autofirmado">Tarea 1: Certificado autofirmado</h2>
<h2 id="parte-1">PARTE 1</h2>
<p><strong>OBJETIVO:</strong></p>
<p>Crear su autoridad certificadora (generar el certificado digital de la CA). Mostrar el fichero de configuración de la AC.</p>
<p>Conocimientos previos:</p>
<p><strong>OpenSSL</strong> permite con una serie de comandos crear una autoridad de certificación o CA en la que los servidores y clientes internos confien. Las funciones de la CA incluyen crear certificados a partir de las solicitudes de los certificados para los servidores y también la revocación y renovación de certificados.</p>
<p>Para usar el protocolo HTTPS en un servidor web es necesario al menos generar un certificado autofirmado que incluya el dominio del sitio web. Ese certificado proporciona comunicaciones seguras entre el servidor y el cliente pero los clientes no lo consideran de confianza de modo que han de omitir la validación del certificado, un entorno de desarrollo o pruebas es suficiente pero en un escenario de producción para añadir más seguridad donde hay varios servidores que además requieren y validan también el certificado del cliente es necesario utilizar certificados generados por una entidad en la que se confíe, esta es la autoridad de certificación.</p>
<p>La autoridad de certificación o CA es una entidad en la que se confía, si una CA ha firmado digitalmente un certificado esta asegura que el certificado pertenece a quien dice pertenecer. Las funciones de una CA son firmar los certificados que se le envían, de revocar los certificados cuando han sido comprometidos o de renovarlos cuando su validez expira.</p>
<h4 id="crear-el-directorio-donde-vamos-a-alojar-los-ficheros-de-la-ca-y-le-damos-los-permisos-necesarios">Crear el directorio donde vamos a alojar los ficheros de la CA y le damos los permisos necesarios</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">DIR_CA=<span style="color:#e6db74">&#34;/root/ca&#34;</span>
mkdir /root/ca
cd /root/ca
mkdir certs csr crl newcerts private
chmod 700 private
touch index.txt
touch index.txt.attr
echo 1000 &gt; serial
</code></pre></div><h4 id="crear-las-variables-de-entorno-que-definiran-nuestra-ca-para-el-fichero-de-configuración">Crear las variables de entorno que definiran nuestra CA para el fichero de configuración</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">countryName_default=<span style="color:#e6db74">&#34;ES&#34;</span>
stateOrProvinceName_default=<span style="color:#e6db74">&#34;Sevilla&#34;</span>
localityName_default=<span style="color:#e6db74">&#34;Los Palacios&#34;</span>
organizationName_default=<span style="color:#e6db74">&#34;Celia&#34;</span>
organizationalUnitName_default=<span style="color:#e6db74">&#34;cgm&#34;</span>
emailAddress_default=<span style="color:#e6db74">&#34;cgarmai95@gmail.com&#34;</span>
</code></pre></div><h4 id="creamos-el-fichero-de-configuración">Creamos el fichero de configuración</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">DIR_CA=<span style="color:#e6db74">&#34;./&#34;</span>
cat &lt;&lt;EOF&gt;$DIR_CA/openssl.conf
[ ca ]
<span style="color:#75715e"># man ca</span>
default_ca = CA_default

[ CA_default ]
<span style="color:#75715e"># Directory and file locations.</span>
dir               = ${DIR_CA}
certs             = ${DIR_CA}certs
crl_dir           = ${DIR_CA}crl
new_certs_dir     = ${DIR_CA}newcerts
database          = ${DIR_CA}index.txt
serial            = ${DIR_CA}serial
RANDFILE          = ${DIR_CA}private/.rand

<span style="color:#75715e"># The root key and root certificate.</span>
private_key       = ${DIR_CA}private/ca.key.pem
certificate       = ${DIR_CA}certs/ca.cert.pem

<span style="color:#75715e"># For certificate revocation lists.</span>
crlnumber         = ${DIR_CA}crlnumber
crl               = ${DIR_CA}crl/ca.crl.pem
crl_extensions    = crl_ext
default_crl_days  = 30

<span style="color:#75715e"># SHA-1 is deprecated, so use SHA-2 instead.</span>
default_md        = sha256

name_opt          = ca_default
cert_opt          = ca_default
default_days      = 375
preserve          = no
policy            = policy_strict

[ policy_strict ]
<span style="color:#75715e"># The root CA should only sign intermediate certificates that match.</span>
<span style="color:#75715e"># See the POLICY FORMAT section of man ca.</span>
countryName             = match
stateOrProvinceName     = match
organizationName        = match
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ policy_loose ]
<span style="color:#75715e"># Allow the intermediate CA to sign a more diverse range of certificates.</span>
<span style="color:#75715e"># See the POLICY FORMAT section of the ca man page.</span>
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ req ]
<span style="color:#75715e"># Options for the req tool (man req).</span>
default_bits        = 2048
distinguished_name  = req_distinguished_name
string_mask         = utf8only
<span style="color:#75715e"># SHA-1 is deprecated, so use SHA-2 instead.</span>
default_md          = sha256
<span style="color:#75715e"># Extension to add when the -x509 option is used.</span>
x509_extensions     = v3_ca
<span style="color:#75715e"># Extension for SANs</span>
req_extensions      = v3_req

[ v3_req ]
<span style="color:#75715e"># Extensions to add to a certificate request</span>
<span style="color:#75715e"># Before invoke openssl use: export SAN=DNS:value1,DNS:value2</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
xxxsubjectAltNamexxx =

[ req_distinguished_name ]
<span style="color:#75715e"># See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.</span>
countryName                     = Country Name (2 letter code)
stateOrProvinceName             = State or Province Name
localityName                    = Locality Name
0.organizationName              = Organization Name
organizationalUnitName          = Organizational Unit Name
commonName                      = Common Name
emailAddress                    = Email Address

<span style="color:#75715e"># Optionally, specify some defaults.</span>
countryName_default             = $countryName_default
stateOrProvinceName_default     = $stateOrProvinceName_default
localityName_default            = $localityName_default
0.organizationName_default      = $organizationName_default
organizationalUnitName_default  = $organizationalUnitName_default
emailAddress_default            = $emailAddress_default

[ v3_ca ]
<span style="color:#75715e"># Extensions for a typical CA (man x509v3_config).</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid<span style="color:#960050;background-color:#1e0010">:</span>always,issuer
basicConstraints = critical, CA<span style="color:#960050;background-color:#1e0010">:</span>true
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ v3_intermediate_ca ]
<span style="color:#75715e"># Extensions for a typical intermediate CA (man x509v3_config).</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid<span style="color:#960050;background-color:#1e0010">:</span>always,issuer
basicConstraints = critical, CA<span style="color:#960050;background-color:#1e0010">:</span>true, pathlen<span style="color:#960050;background-color:#1e0010">:</span>0
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ usr_cert ]
<span style="color:#75715e"># Extensions for client certificates (man x509v3_config).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
nsCertType = client, email
nsComment = <span style="color:#e6db74">&#34;OpenSSL Generated Client Certificate&#34;</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth, emailProtection

[ server_cert ]
<span style="color:#75715e"># Extensions for server certificates (man x509v3_config).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
nsCertType = server
nsComment = <span style="color:#e6db74">&#34;OpenSSL Generated Server Certificate&#34;</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer<span style="color:#960050;background-color:#1e0010">:</span>always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth

[ crl_ext ]
<span style="color:#75715e"># Extension for CRLs (man x509v3_config).</span>
authorityKeyIdentifier=keyid<span style="color:#960050;background-color:#1e0010">:</span>always

[ ocsp ]
<span style="color:#75715e"># Extension for OCSP signing certificates (man ocsp).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, digitalSignature
extendedKeyUsage = critical, OCSPSigning
EOF
sed -i <span style="color:#e6db74">&#39;s|xxxsubjectAltNamexxx =|subjectAltName = ${ENV::SAN}|g&#39;</span> openssl.conf
</code></pre></div><h4 id="creamos-la-clave-y-certificado-de-la-autoridad-de-certificación">Creamos la clave y certificado de la autoridad de certificación</h4>
<p>Crear clave:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">openssl genrsa -aes256 -out private/ca.key.pem 4096
chmod 400 private/ca.key.pem
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">URL=celiagarcia.iesgn.org
export SAN=DNS<span style="color:#960050;background-color:#1e0010">:</span>$URL
</code></pre></div><p>Crear certificado</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">openssl req -config openssl.conf -key private/ca.key.pem -new -x509 -days 7300 -sha256 -extensions v3_ca -out certs/ca.cert.pem
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-https<span style="color:#960050;background-color:#1e0010">:</span>~/ca<span style="color:#75715e"># openssl req -config openssl.conf -key private/ca.key.pem -new -x509 -days 7300 -sha256 -extensions v3_ca -out certs/ca.cert.pem</span>
Enter pass phrase <span style="color:#66d9ef">for</span> private/ca.key.pem<span style="color:#960050;background-color:#1e0010">:</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
<span style="color:#66d9ef">For</span> some fields there will be a <span style="color:#66d9ef">default</span> value,
<span style="color:#66d9ef">If</span> you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
-----
Country Name (2 letter code) <span style="color:#66d9ef">[ES]</span><span style="color:#960050;background-color:#1e0010">:</span>
State or Province Name <span style="color:#66d9ef">[Sevilla]</span><span style="color:#960050;background-color:#1e0010">:</span>
Locality Name <span style="color:#66d9ef">[Los Palacios]</span><span style="color:#960050;background-color:#1e0010">:</span>
Organization Name <span style="color:#66d9ef">[Celia]</span><span style="color:#960050;background-color:#1e0010">:</span>
Organizational Unit Name <span style="color:#66d9ef">[cgm]</span><span style="color:#960050;background-color:#1e0010">:</span>
Common Name []<span style="color:#960050;background-color:#1e0010">:</span>
Email Address [cgarmai95@gmail.com]<span style="color:#960050;background-color:#1e0010">:</span>

</code></pre></div><p>Le damos los permisos necesarios.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">chmod 444 certs/ca.cert.pem
</code></pre></div><h3 id="estructura-de-directorios">Estructura de directorios</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-https<span style="color:#960050;background-color:#1e0010">:</span>~/ca<span style="color:#75715e"># tree</span>
.
<span style="color:#960050;background-color:#1e0010">├──</span> certs
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> ca.cert.pem
<span style="color:#960050;background-color:#1e0010">├──</span> crl
<span style="color:#960050;background-color:#1e0010">├──</span> csr
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> celia.iesgn.org.csr
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> jonathan.iesgn.org.csr
<span style="color:#960050;background-color:#1e0010">├──</span> index.txt
<span style="color:#960050;background-color:#1e0010">├──</span> index.txt.attr
<span style="color:#960050;background-color:#1e0010">├──</span> newcerts
<span style="color:#960050;background-color:#1e0010">├──</span> openssl.conf
<span style="color:#960050;background-color:#1e0010">├──</span> private
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> ca.key.pem
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> celia.iesgn.org.key.pem
<span style="color:#960050;background-color:#1e0010">└──</span> serial

</code></pre></div><h3 id="fichero-de-configuración-opensslconf">Fichero de configuración (openssl.conf)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[ ca ]
<span style="color:#75715e"># man ca</span>
default_ca = CA_default

[ CA_default ]
<span style="color:#75715e"># Directory and file locations.</span>
dir               = ./
certs             = ./certs
crl_dir           = ./crl
new_certs_dir     = ./newcerts
database          = ./index.txt
serial            = ./serial
RANDFILE          = ./private/.rand

<span style="color:#75715e"># The root key and root certificate.</span>
private_key       = ./private/ca.key.pem
certificate       = ./certs/ca.cert.pem

<span style="color:#75715e"># For certificate revocation lists.</span>
crlnumber         = ./crlnumber
crl               = ./crl/ca.crl.pem
crl_extensions    = crl_ext
default_crl_days  = 30

<span style="color:#75715e"># SHA-1 is deprecated, so use SHA-2 instead.</span>
default_md        = sha256

name_opt          = ca_default
cert_opt          = ca_default
default_days      = 375
preserve          = no
policy            = policy_strict

[ policy_strict ]
<span style="color:#75715e"># The root CA should only sign intermediate certificates that match.</span>
<span style="color:#75715e"># See the POLICY FORMAT section of man ca.</span>
countryName             = match
stateOrProvinceName     = match
organizationName        = match
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ policy_loose ]
<span style="color:#75715e"># Allow the intermediate CA to sign a more diverse range of certificates.</span>
<span style="color:#75715e"># See the POLICY FORMAT section of the ca man page.</span>
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ req ]
<span style="color:#75715e"># Options for the req tool (man req).</span>
default_bits        = 2048
distinguished_name  = req_distinguished_name
string_mask         = utf8only
<span style="color:#75715e"># SHA-1 is deprecated, so use SHA-2 instead.</span>
default_md          = sha256
<span style="color:#75715e"># Extension to add when the -x509 option is used.</span>
x509_extensions     = v3_ca
<span style="color:#75715e"># Extension for SANs</span>
req_extensions      = v3_req

[ v3_req ]
<span style="color:#75715e"># Extensions to add to a certificate request</span>
<span style="color:#75715e"># Before invoke openssl use: export SAN=DNS:value1,DNS:value2</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = ${ENV::SAN}

[ req_distinguished_name ]
<span style="color:#75715e"># See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.</span>
countryName                     = Country Name (2 letter code)
stateOrProvinceName             = State or Province Name
localityName                    = Locality Name
0.organizationName              = Organization Name
organizationalUnitName          = Organizational Unit Name
commonName                      = Common Name
emailAddress                    = Email Address

<span style="color:#75715e"># Optionally, specify some defaults.</span>
countryName_default             = ES
stateOrProvinceName_default     = Sevilla
localityName_default            = Los Palacios
0.organizationName_default      = Celia
organizationalUnitName_default  = cgm
emailAddress_default            = cgarmai95@gmail.com

[ v3_ca ]
<span style="color:#75715e"># Extensions for a typical CA (man x509v3_config).</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid<span style="color:#960050;background-color:#1e0010">:</span>always,issuer
basicConstraints = critical, CA<span style="color:#960050;background-color:#1e0010">:</span>true
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ v3_intermediate_ca ]
<span style="color:#75715e"># Extensions for a typical intermediate CA (man x509v3_config).</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid<span style="color:#960050;background-color:#1e0010">:</span>always,issuer
basicConstraints = critical, CA<span style="color:#960050;background-color:#1e0010">:</span>true, pathlen<span style="color:#960050;background-color:#1e0010">:</span>0
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ usr_cert ]
<span style="color:#75715e"># Extensions for client certificates (man x509v3_config).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
nsCertType = client, email
nsComment = <span style="color:#e6db74">&#34;OpenSSL Generated Client Certificate&#34;</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth, emailProtection

[ server_cert ]
<span style="color:#75715e"># Extensions for server certificates (man x509v3_config).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
nsCertType = server
nsComment = <span style="color:#e6db74">&#34;OpenSSL Generated Server Certificate&#34;</span>
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer<span style="color:#960050;background-color:#1e0010">:</span>always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth

[ crl_ext ]
<span style="color:#75715e"># Extension for CRLs (man x509v3_config).</span>
authorityKeyIdentifier=keyid<span style="color:#960050;background-color:#1e0010">:</span>always

[ ocsp ]
<span style="color:#75715e"># Extension for OCSP signing certificates (man ocsp).</span>
basicConstraints = CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, digitalSignature
extendedKeyUsage = critical, OCSPSigning

</code></pre></div><hr>
<h3 id="firmar-certificado">Firmar certificado</h3>
<p><strong>Debe recibir el fichero CSR (Solicitud de Firmar un Certificado) de su compañero, debe firmarlo y enviar el certificado generado a su compañero.</strong></p>
<ul>
<li>Una vez recibido el csr del compañero tenemos que firmarlo y devolverle el certificado generado firmado por la autoridad certificadora que hemos creado anteriormente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-https<span style="color:#960050;background-color:#1e0010">:</span>~/ca<span style="color:#75715e"># openssl ca -config ./openssl.conf -extensions v3_req -days 3650 -notext -md sha256 -in ./csr/jonathan.iesgn.org.csr -out ./certs/joni.firmado.csr.pem</span>
Using configuration from ./openssl.conf
Enter pass phrase <span style="color:#66d9ef">for</span> ./private/ca.key.pem<span style="color:#960050;background-color:#1e0010">:</span>
Check that the request matches the signature
Signature ok
Certificate Details<span style="color:#960050;background-color:#1e0010">:</span>
        Serial Number<span style="color:#960050;background-color:#1e0010">:</span> 4096 (0x1000)
        Validity
            Not Before<span style="color:#960050;background-color:#1e0010">:</span> Nov 19 16<span style="color:#960050;background-color:#1e0010">:</span>38<span style="color:#960050;background-color:#1e0010">:</span>06 2020 GMT
            Not After <span style="color:#960050;background-color:#1e0010">:</span> Nov 17 16<span style="color:#960050;background-color:#1e0010">:</span>38<span style="color:#960050;background-color:#1e0010">:</span>06 2030 GMT
        Subject<span style="color:#960050;background-color:#1e0010">:</span>
            countryName               = ES
            stateOrProvinceName       = Sevilla
            organizationName          = Celia
            commonName                = jonathan.iesgn.org
            emailAddress              = jonathanmarquezj@gmail.com
        X509v3 extensions<span style="color:#960050;background-color:#1e0010">:</span>
            X509v3 Basic Constraints<span style="color:#960050;background-color:#1e0010">:</span> 
                CA<span style="color:#960050;background-color:#1e0010">:</span>FALSE
            X509v3 Key Usage<span style="color:#960050;background-color:#1e0010">:</span> 
                Digital Signature, Non Repudiation, Key Encipherment
            X509v3 Subject Alternative Name<span style="color:#960050;background-color:#1e0010">:</span> 
                DNS<span style="color:#960050;background-color:#1e0010">:</span>celiagarcia.iesgn.org
Certificate is to be certified <span style="color:#66d9ef">until</span> Nov 17 16<span style="color:#960050;background-color:#1e0010">:</span>38<span style="color:#960050;background-color:#1e0010">:</span>06 2030 GMT (3650 days)
Sign the certificate? [y/n]<span style="color:#960050;background-color:#1e0010">:</span>y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated

</code></pre></div><p>Y el fichero generado se lo enviamos al compañero: <strong>joni.firmado.csr.pem</strong></p>
<p><strong>¿Qué otra información debes aportar a tu compañero para que éste configure de forma adecuada su servidor web con el certificado generado?</strong></p>
<p>Debemos aportar los datos requeridos que son:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">countryName_default
stateOrProvinceName_default
organizationName_default
</code></pre></div><p>Estos están configurados en el fichero openssl.conf con &lsquo;<strong>match</strong>&rsquo;</p>
<hr>
<h2 id="parte-2">PARTE 2</h2>
<h3 id="el-alumno-que-hace-de-administrador-del-servidor-web-debe-entrepregar-una-documentación-que-describa-los-siguientes-puntos">El alumno que hace de administrador del servidor web, debe entre<!-- raw HTML omitted -->gar una documentación que describa los siguientes puntos:</h3>
<p>Estos puntos que vienen a continuación los hemos realizado con la creación de la autoridad certificadora:</p>
<ul>
<li>
<p>Crea una clave privada RSA de 4096 bits para identificar el servidor</p>
</li>
<li>
<p>Utiliza la clave anterior para generar un CSR, considerando que deseas acceder al servidor con el FQDN (tunombre.iesgn.org).</p>
</li>
<li>
<p>Envía la solicitud de firma a la entidad certificadora (su compañero).</p>
</li>
</ul>
<hr>
<ul>
<li><strong>Recibe como respuesta un certificado X.509 para el servidor firmado y el certificado de la autoridad certificadora.</strong></li>
</ul>
<p>Recibimos el certificado firmado por la autoridad certificadora</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@debian-https<span style="color:#960050;background-color:#1e0010">:</span>~/ca/csr<span style="color:#75715e"># ls</span>
celia.iesgn.org.csr  celia.iesgn.org.csr.pem  jonathan.iesgn.org.csr
</code></pre></div><ul>
<li><strong>Configura tu servidor web con https en el puerto 443, haciendo que las peticiones http se redireccionen a https (forzar https).</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">&lt;VirtualHost *<span style="color:#960050;background-color:#1e0010">:</span>443&gt;
        ServerName celiagarcia.iesgn.org
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/celia

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile /root/ca/csr/celia.iesgn.org.csr.pem
        SSLCertificateKeyFile /root/ca/private/celia.iesgn.org.key.pem

        &lt;FilesMatch <span style="color:#e6db74">&#34;\.(php|py)$&#34;</span>&gt;
                SSLOptions +StdEnvVars
        &lt;/FilesMatch&gt;

        BrowserMatch <span style="color:#e6db74">&#34;MSIE [2-6]&#34;</span> \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
        BrowserMatch <span style="color:#e6db74">&#34;MSIE [17-9]&#34;</span> ssl-unclean-shutdown
&lt;/VirtualHost&gt;

</code></pre></div><p>Hay que habilitar el <strong>modulo de ssl</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">a2enmod ssl
</code></pre></div><p>Reiniciamos el servidor</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">systemctl restart apache2
</code></pre></div><p>Vamos a nuestro navegador y accedemos a <a href="https://celiagarcia.iesgn.org">https://celiagarcia.iesgn.org</a></p>
<p>Comprobamos que podemos acceder, nos notificará que no es una conexión segura ya que no se conoce la entidad certificadora pero añadimos una excepción. Y vemos el certificado en el que aparece la firma de la entidad certificadora de nuestro compañero.</p>
<ul>
<li><img src="/images/ca/https1.png" alt="https1.png"></li>
<li><img src="/images/ca/https2.png" alt="https2.png"></li>
<li><img src="/images/ca/https3.png" alt="https3.png"></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Instalación y configuración inicial de los servidores</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n-y-configuraci%C3%B3n-inicial-de-los-servidores/</link>
            <pubDate>Wed, 18 Nov 2020 18:22:12 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n-y-configuraci%C3%B3n-inicial-de-los-servidores/</guid>
            <description>En esta tarea se va a crear el escenario de trabajo que se va a usar durante todo el curso, que va a constar inicialmente de 3 instancias con nombres relacionados con el libro &amp;ldquo;Don Quijote de la Mancha&amp;rdquo;.
Pasos a realizar:
1. Creación de la red interna:  Nombre red interna de  10.0.1.0/24  2. Creación de las instancias   Dulcinea:
 Debian Buster sobre volumen de 10GB con sabor m1.</description>
            <content type="html"><![CDATA[<p>En esta tarea se va a crear el escenario de trabajo que se va a usar durante todo el curso, que va a constar inicialmente de 3 instancias con nombres relacionados con el libro &ldquo;Don Quijote de la Mancha&rdquo;.</p>
<p>Pasos a realizar:</p>
<h2 id="1-creación-de-la-red-interna">1. Creación de la red interna:</h2>
<ul>
<li>Nombre red interna de <!-- raw HTML omitted --></li>
<li>10.0.1.0/24</li>
</ul>
<h2 id="2-creación-de-las-instancias">2. Creación de las instancias</h2>
<ul>
<li>
<p><strong>Dulcinea</strong>:</p>
<ul>
<li><strong>Debian Buster</strong> sobre volumen de 10GB con sabor m1.mini</li>
<li>Accesible directamente a través de la red externa y con una IP flotante</li>
<li>Conectada a la red interna, de la que será la puerta de enlace</li>
</ul>
</li>
<li>
<p><strong>Sancho</strong>:</p>
<ul>
<li><strong>Ubuntu 20.04</strong> sobre volumen de 10GB con sabor m1.mini</li>
<li>Conectada a la red interna</li>
<li>Accesible indirectamente a través de dulcinea</li>
</ul>
</li>
<li>
<p><strong>Quijote</strong>:</p>
<ul>
<li><strong>CentOS 7</strong> sobre volumen de 10GB con sabor m1.mini</li>
<li>Conectada a la red interna</li>
<li>Accesible indirectamente a través de dulcinea</li>
</ul>
</li>
</ul>
<p>Escenario gráfico:</p>
<p><img src="/images/escenario/escenario.png" alt="escenario.png"></p>
<h2 id="3-configuración-de-nat-en-dulcinea">3. Configuración de NAT en Dulcinea</h2>
<h3 id="30-deshabilitar-la-seguidad-de-puertos">3.0. Deshabilitar la seguidad de puertos</h3>
<p>Guía para: <a href="https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalar-openstackclient-y-deshabilitar-la-seguridad-de-puertos/">Instalar Openstackclient y deshabilitar la seguridad de puertos</a></p>
<h3 id="31-activar-el-bit-de-fordward">3.1. Activar el bit de fordward</h3>
<p>Para que nuestra máquina actúe como router tenemos que activar el <strong>bit de fordward.</strong> Podemos hacerlo temporal o permanente. En este caso lo haremos permanente. Para ello editamos el fichero <em>/etc/sysctl.conf</em> , buscamos la línea ‘<strong>net.ipv4.ip_fordward=1</strong>' y la descomentamos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano /etc/sysctl.conf 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Uncomment the next line to enable packet forwarding for IPv4</span>
net.ipv4.ip_forward=1
</code></pre></div><h3 id="32-configurar-las-interfaces-de-red">3.2. Configurar las interfaces de red</h3>
<p>En segundo lugar vamos a configurar el fichero <em>/etc/network/interfaces</em> agregando dos reglas de <strong>‘iptable’</strong> para que nuestros clientes puedan acceder desde una interfaz a otra obteniendo acceso a internet. Añadiremos las siguientes líneas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano /etc/network/interfaces
</code></pre></div><h4 id="reglas-de-iptable">Reglas de iptable</h4>
<p>Las añadimos de forma permanente en el fichero interfaces, de forma que:</p>
<ul>
<li>
<p>-A POSTROUTING (Añade una regla a la cadena POSTROUTING)</p>
</li>
<li>
<p>-s ‘dirección’ : Se aplica a los paquetes que vengan de origen de la dirección especificada. En nuestro caso hemos añadido las direccion ip de nuestro cliente</p>
</li>
<li>
<p>-o eth0: Se aplica a los paquetes que salgan por eth0 (la que sale al exterior)</p>
</li>
<li>
<p>-j MASQUERADE: Cambia la dirección de origen (eth1) por la dirección de salida (eth0)</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># This file describes the network interfaces available on your system</span>
<span style="color:#75715e"># and how to activate them. For more information, see interfaces(5).</span>

<span style="color:#75715e"># The loopback network interface</span>
auto lo
iface lo inet loopback

<span style="color:#75715e"># The normal eth0 (red externa)</span>
auto eth0
iface eth0 inet dhcp
<span style="color:#75715e">#       post-up ip route del default dev $IFACE || true</span>

<span style="color:#75715e"># Reglas de iptable</span>
up iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -o eth0 -j MASQUERADE
down iptables -t nat -D POSTROUTING -s 10.0.1.0/24 -o eth0 -j MASQUERADE

<span style="color:#75715e"># Additional interfaces, just in case we&#39;re using</span>
<span style="color:#75715e"># multiple networks</span>

<span style="color:#75715e">#Red interna</span>
auto eth1
iface eth1 inet static
        address 10.0.1.6
        netmask 255.255.255.0

<span style="color:#75715e"># Set this one last, so that cloud-init or user can</span>
<span style="color:#75715e"># override defaults.</span>
source /etc/network/interfaces.d/*


</code></pre></div><p>Comprobamos que las reglas de iptable estan funcionando</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">sudo iptables -t nat -L -nv
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ sudo iptables -t nat -L -nv
Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt <span style="color:#66d9ef">in</span>     out     source               destination         

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt <span style="color:#66d9ef">in</span>     out     source               destination         

Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt <span style="color:#66d9ef">in</span>     out     source               destination         
    7   588 MASQUERADE  all  --  *      eth0    10.0.1.0/24          0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt <span style="color:#66d9ef">in</span>     out     source               destination    
</code></pre></div><h2 id="4-definición-de-contraseña-en-todas-las-instancias">4. Definición de contraseña en todas las instancias</h2>
<ul>
<li>Accedemos a Sancho y a Quijote por ssh desde Ducinea.</li>
<li>Le cambiamos la contraseña a todas las instancias.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">passwd root
passwd nombre_de_usuario ({debian},{ubuntu},{sancho})
</code></pre></div><h2 id="5-modificación-de-las-instancias-sancho-y-quijote-para-que-usen-direccionamiento-estático-y-dulcinea-como-puerta-de-enlace">5. Modificación de las instancias sancho y quijote para que usen direccionamiento estático y dulcinea como puerta de enlace</h2>
<h3 id="configuración-sancho-ubuntu">Configuración Sancho (Ubuntu)</h3>
<p>Editamos el fichero de configuración de interfaces</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano -c /etc/netplan/50-cloud-init.yaml
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># This file is generated from information provided by the datasource.  Changes</span>
<span style="color:#75715e"># to it will not persist across an instance reboot.  To disable cloud-init&#39;s</span>
<span style="color:#75715e"># network configuration capabilities, write a file</span>
<span style="color:#75715e"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span style="color:#75715e"># network: {config: disabled}</span>
network<span style="color:#960050;background-color:#1e0010">:</span>
    version<span style="color:#960050;background-color:#1e0010">:</span> 2
    ethernets<span style="color:#960050;background-color:#1e0010">:</span>
        ens3<span style="color:#960050;background-color:#1e0010">:</span>
             addresses<span style="color:#960050;background-color:#1e0010">:</span> [10.0.1.11/24]
             gateway4<span style="color:#960050;background-color:#1e0010">:</span> 10.0.1.6
<span style="color:#75715e">#             dhcp4: false</span>
<span style="color:#75715e">#             match:</span>
<span style="color:#75715e">#                macaddress: fa:16:3e💿4d:70</span>
<span style="color:#75715e">#             mtu: 8950</span>
<span style="color:#75715e">#             set-name: ens3  </span>

</code></pre></div><p>Aplicamos los cambios</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">netplan apply
</code></pre></div><p>Comprobamos que la* puerta de enlace* apunte a Dulcinea</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># ip r</span>
<span style="color:#66d9ef">default</span> via 10.0.1.6 dev ens3 
10.0.1.0/24 dev ens3 proto kernel scope link src 10.0.1.11 
169.254.169.254 via 10.0.1.2 dev ens3 
</code></pre></div><p>Comprobamos que tenemos <em>acceso al exterior</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># ping 172.22.0.1</span>
PING 172.22.0.1 (172.22.0.1) 56(84) bytes of data.
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=1 ttl=62 time=1.47 ms
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=2 ttl=62 time=1.87 ms
^C
--- 172.22.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 1.467/1.670/1.874/0.203 ms

</code></pre></div><h3 id="configuración-quijote-centos">Configuración Quijote (CentOS)</h3>
<p>Buscamos el fichero de configuración de interfaces</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[centos@quijote ~]$ ls -l /etc/sysconfig/network-scripts/ifcfg-*
-rw-r--r--. 1 root root 168 Nov 18 16<span style="color:#960050;background-color:#1e0010">:</span>58 /etc/sysconfig/network-scripts/ifcfg-eth0
-rw-r--r--. 1 root root 254 Aug 19  2019 /etc/sysconfig/network-scripts/ifcfg-lo

</code></pre></div><p>Editamos el fichero:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">vi /etc/sysconfig/network-scripts/ifcfg-eth0 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Created by cloud-init on instance boot automatically, do not edit.</span>
<span style="color:#75715e">#</span>
BOOTPROTO=<span style="color:#e6db74">&#34;static&#34;</span>
IPADDR=<span style="color:#e6db74">&#34;10.0.1.13&#34;</span>
GATEWAY=<span style="color:#e6db74">&#34;10.0.1.6&#34;</span>
NETMASK=<span style="color:#e6db74">&#34;255.255.255.0&#34;</span>
DEVICE=eth0
HWADDR=fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>f7<span style="color:#960050;background-color:#1e0010">:</span>be<span style="color:#960050;background-color:#1e0010">:</span>35
MTU=8950
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
~                                                                                                                                                                                      
<span style="color:#e6db74">&#34;/etc/sysconfig/network-scripts/ifcfg-eth0&#34;</span> 12L, 234C


</code></pre></div><p>Reiniamos el servicio</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">systemctl restart network.service
</code></pre></div><p>Comprobamos la <strong>puerta de enlace</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[root@quijote centos]<span style="color:#75715e"># ip r</span>
<span style="color:#66d9ef">default</span> via 10.0.1.6 dev eth0 
10.0.0.0/8 dev eth0 proto kernel scope link src 10.0.1.13 

</code></pre></div><p>Comprobamos el <strong>acceso al exterior</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[root@quijote centos]<span style="color:#75715e"># ping 172.22.0.1</span>
PING 172.22.0.1 (172.22.0.1) 56(84) bytes of data.
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=1 ttl=62 time=1.36 ms
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=2 ttl=62 time=1.50 ms
^C
--- 172.22.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 1.364/1.432/1.500/0.068 ms

</code></pre></div><h2 id="6-modificación-de-la-subred-de-la-red-interna-deshabilitando-el-servidor-dhcp">6. Modificación de la subred de la red interna, deshabilitando el servidor DHCP</h2>
<p>Vamos a la pataforma del cloud, en Networks &raquo; (Seleccionamos la interfaz interna) celia.garcia &raquo; Subnets &raquo; Edit Subnet &raquo; Next &raquo; (Deshabilitamos el DCHP) Enable DCHP</p>
<p><img src="/images/escenario/disable_dhcp.jpeg" alt="disable_dhcp.jpeg"></p>
<p>Una vez deshabilitado vamos a <strong>Sancho</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">ip a del 10.0.1.11/24 dev ens3
</code></pre></div><p>Intentamos hacer una petición al DCHP</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">dhclient ens3
</code></pre></div><p>No obtenemos respuesta por lo que está correctamente deshabilitado.</p>
<p>Ahora vamos a reiniciar el servicio de red</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">netplan apply
</code></pre></div><p>Comprobamos que tenemos de nuevo nuestra configuración estática:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># ip a</span>
1<span style="color:#960050;background-color:#1e0010">:</span> lo<span style="color:#960050;background-color:#1e0010">:</span> &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group <span style="color:#66d9ef">default</span> qlen 1000
    link/loopback 00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00 brd 00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00<span style="color:#960050;background-color:#1e0010">:</span>00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3<span style="color:#960050;background-color:#1e0010">:</span> ens3<span style="color:#960050;background-color:#1e0010">:</span> &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 8950 qdisc fq_codel state UP group <span style="color:#66d9ef">default</span> qlen 1000
    link/ether fa<span style="color:#960050;background-color:#1e0010">:</span>16<span style="color:#960050;background-color:#1e0010">:</span>3e<span style="color:#960050;background-color:#1e0010">:</span>f2<span style="color:#960050;background-color:#1e0010">:</span>65<span style="color:#960050;background-color:#1e0010">:</span>68 brd ff<span style="color:#960050;background-color:#1e0010">:</span>ff<span style="color:#960050;background-color:#1e0010">:</span>ff<span style="color:#960050;background-color:#1e0010">:</span>ff<span style="color:#960050;background-color:#1e0010">:</span>ff<span style="color:#960050;background-color:#1e0010">:</span>ff
    inet 10.0.1.11/24 brd 10.0.1.255 scope global ens3
       valid_lft forever preferred_lft forever
    inet6 fe80::f816<span style="color:#960050;background-color:#1e0010">:</span>3eff<span style="color:#960050;background-color:#1e0010">:</span>fef2<span style="color:#960050;background-color:#1e0010">:</span>6568/64 scope link 
       valid_lft forever preferred_lft forever

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># ip r</span>
<span style="color:#66d9ef">default</span> via 10.0.1.6 dev ens3 proto static 
10.0.1.0/24 dev ens3 proto kernel scope link src 10.0.1.11 

</code></pre></div><p>Hacemos el mismo procedimiento con <strong>Quijote</strong></p>
<p>Comprobamos que no tenemos respuesta por DHCP ya que lo hemos deshabilitado</p>
<p>Comprobamos que al reiniciar nuestro servicio de red configurado estaticamente tenemos acceso al exterior</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[root@quijote centos]<span style="color:#75715e"># ping 172.22.0.1</span>
PING 172.22.0.1 (172.22.0.1) 56(84) bytes of data.
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=1 ttl=62 time=1.44 ms
64 bytes from 172.22.0.1<span style="color:#960050;background-color:#1e0010">:</span> icmp_seq=2 ttl=62 time=1.99 ms
^C
--- 172.22.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 1.440/1.718/1.996/0.278 ms

</code></pre></div><h2 id="7-utilización-de-ssh-agent-para-acceder-a-las-instancias">7. Utilización de ssh-agent para acceder a las instancias</h2>
<h4 id="70-conceptos-previos">7.0. Conceptos previos</h4>
<p>El <strong>agente ssh</strong>, es un programa auxiliar que realiza un seguimiento de las claves de identidad del usuario y sus contraseñas. Permite usar las claves para iniciar sesión en otros servidores sin que el usuario escriba una contraseña o frase de contraseña. Esto implementa una forma de inicio de sesión único.</p>
<h4 id="71-iniciar-ssh-agent">7.1. Iniciar ssh-agent</h4>
<p>Normalmente no se inicia automáticamente al inciar el servidor por lo que tenemos que ejecutarlo manualmente</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">ssh-agent
</code></pre></div><p>Salida:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">SSH_AUTH_SOCK=/tmp/ssh-wMUFa5ft1Ae2/agent.13399; export SSH_AUTH_SOCK;
SSH_AGENT_PID=13400; export SSH_AGENT_PID;
echo Agent pid 13400;
</code></pre></div><p>Verificamos el valor de la variable que esté configurada</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ echo $SSH_AUTH_SOCK
/tmp/ssh-P9bFFkcDoMSo/agent.13396
</code></pre></div><h4 id="72-agregar-las-claves-y-comprobar-funcionamiento">7.2. Agregar las claves y comprobar funcionamiento</h4>
<p>Agregamos las claves que tenemos en el fichero .ssh, si no le indicamos ruta agregará todas las que se encuentren dentro de .ssh</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">ssh-add
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ ssh-add
Identity added<span style="color:#960050;background-color:#1e0010">:</span> /home/debian/.ssh/id_rsa (celiagm@debian)
</code></pre></div><p>Otras opciones de utilidad</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Listar las claves privadas</span>
ssh-add -l
<span style="color:#75715e"># Listar las claves públicas</span>
ssh-add -L
<span style="color:#75715e"># Eliminar las claves utilizadas por el agente</span>
ssh-add -D
</code></pre></div><p>Ahora ya podemos entrar directamente a Sancho y a Quijote sin especificar la clave</p>
<p><strong>SANCHO:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ ssh ubuntu@10.0.1.11
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-48-generic x86_64)

 * Documentation<span style="color:#960050;background-color:#1e0010">:</span>  https<span style="color:#960050;background-color:#1e0010">:</span>//help.ubuntu.com
 * Management<span style="color:#960050;background-color:#1e0010">:</span>     https<span style="color:#960050;background-color:#1e0010">:</span>//landscape.canonical.com
 * Support<span style="color:#960050;background-color:#1e0010">:</span>        https<span style="color:#960050;background-color:#1e0010">:</span>//ubuntu.com/advantage

  System information as of Mon Nov 23 19<span style="color:#960050;background-color:#1e0010">:</span>45<span style="color:#960050;background-color:#1e0010">:</span>13 UTC 2020

  System load<span style="color:#960050;background-color:#1e0010">:</span>  0.01              Processes<span style="color:#960050;background-color:#1e0010">:</span>             103
  Usage of /<span style="color:#960050;background-color:#1e0010">:</span>   13.1% of 9.52GB   Users logged <span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>       2
  Memory usage<span style="color:#960050;background-color:#1e0010">:</span> 40%               IPv4 address <span style="color:#66d9ef">for</span> ens3<span style="color:#960050;background-color:#1e0010">:</span> 10.0.1.11
  Swap usage<span style="color:#960050;background-color:#1e0010">:</span>   0%


1 update can be installed immediately.
0 of these updates are security updates.
To see these additional updates run<span style="color:#960050;background-color:#1e0010">:</span> apt list --upgradable


The list of available updates is more than a week old.
To check <span style="color:#66d9ef">for</span> new updates run<span style="color:#960050;background-color:#1e0010">:</span> sudo apt update
Failed to connect to https<span style="color:#960050;background-color:#1e0010">:</span>//changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login<span style="color:#960050;background-color:#1e0010">:</span> Mon Nov 23 15<span style="color:#960050;background-color:#1e0010">:</span>59<span style="color:#960050;background-color:#1e0010">:</span>15 2020 from 10.0.1.6
ubuntu@sancho<span style="color:#960050;background-color:#1e0010">:</span>~$ 

</code></pre></div><p><strong>CENTOS:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">debian@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>~$ ssh centos@10.0.1.13
Last login<span style="color:#960050;background-color:#1e0010">:</span> Mon Nov 23 15<span style="color:#960050;background-color:#1e0010">:</span>59<span style="color:#960050;background-color:#1e0010">:</span>55 2020 from host-10-0-1-6.openstacklocal
[centos@quijote ~]$ 

</code></pre></div><h2 id="8-creación-del-usuario-profesor-en-todas-las-instancias-usuario-que-puede-utilizar-sudo-sin-contraseña">8. Creación del usuario profesor en todas las instancias. Usuario que puede utilizar sudo sin contraseña.</h2>
<ul>
<li>Dulcinea</li>
</ul>
<p>Creamos el usuario profesor y lo añadimos al grupo sudo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">adduser profesor
adduser profesor sudo

</code></pre></div><p>Editamos el fichero &lsquo;sudoers&rsquo; e indicamos que el usuario no precise de contraseña al usar sudo</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nano /etc/sudoers
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">profesor ALL=(ALL) NOPASSWD<span style="color:#960050;background-color:#1e0010">:</span>ALL
</code></pre></div><ul>
<li>Sancho (Ponemos la misma configuración en <em>sudoers</em>)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">useradd profesor
usermod profesor -g sudo
passwd profesor
nano /etc/sudoers
</code></pre></div><ul>
<li>Quijote</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">adduser profesor
passwd profesor
usermod -aG wheel profesor
</code></pre></div><h2 id="9-copia-de-las-claves-públicas-de-todos-los-profesores-en-las-instancias-para-que-puedan-acceder-con-el-usuario-profesor">9. Copia de las claves públicas de todos los profesores en las instancias para que puedan acceder con el usuario profesor</h2>
<p>hecho.</p>
<h2 id="10-realiza-una-actualización-completa-de-todos-los-servidores">10. Realiza una actualización completa de todos los servidores</h2>
<p><strong>Dulcinea(Debian 10)</strong></p>
<p>Repositorios de Dulcinea</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">deb http<span style="color:#960050;background-color:#1e0010">:</span>//deb.debian.org/debian/ buster main
<span style="color:#75715e">#deb-src http://deb.debian.org/debian/ buster main</span>
deb http<span style="color:#960050;background-color:#1e0010">:</span>//deb.debian.org/debian/ buster-updates main
<span style="color:#75715e">#deb-src http://deb.debian.org/debian/ buster-updates main</span>
deb http<span style="color:#960050;background-color:#1e0010">:</span>//security.debian.org/ buster/updates main
<span style="color:#75715e">#deb-src http://security.debian.org/debian-security buster/updates main</span>

</code></pre></div><p>Actualizamos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">apt update
apt list --upgradable
apt upgrade
</code></pre></div><p><strong>Sancho (Ubuntu 20)</strong></p>
<p>Debemos asegurarnos que tenemos resolución de nombres</p>
<p>Fichero /etc/resolv</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">nameserver 192.168.202.2
</code></pre></div><p>Actualizamos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">apt update
apt upgrade
</code></pre></div><p><strong>Quijote (Centos7)</strong></p>
<p>Los repositorios de centos se ubican en :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[centos@quijote ~]$ ls -l /etc/yum.repos.d/
total 36
-rw-r--r--. 1 root root 1664 Apr  7  2020 CentOS-Base.repo
-rw-r--r--. 1 root root 1309 Apr  7  2020 CentOS-CR.repo
-rw-r--r--. 1 root root  649 Apr  7  2020 CentOS-Debuginfo.repo
-rw-r--r--. 1 root root  314 Apr  7  2020 CentOS-fasttrack.repo
-rw-r--r--. 1 root root  630 Apr  7  2020 CentOS-Media.repo
-rw-r--r--. 1 root root 1331 Apr  7  2020 CentOS-Sources.repo
-rw-r--r--. 1 root root 7577 Apr  7  2020 CentOS-Vault.repo
-rw-r--r--. 1 root root  616 Apr  7  2020 CentOS-x86_64-kernel.repo

</code></pre></div><p>Actualizamos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">yum update
</code></pre></div><h2 id="12-hasta-que-no-esté-configurado-el-servidor-dns-incluye-resolución-estática-en-las-tres-instancias-tanto-usando-nombre-completo-como-hostname">12. Hasta que no esté configurado el servidor DNS, incluye resolución estática en las tres instancias tanto usando nombre completo como hostname</h2>
<p><strong>Dulcinea</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">127.0.1.1 dulcinea.novalocal dulcinea
127.0.0.1 localhost
10.0.1.13 quijote.novalocal quijote
10.0.1.11 sancho.novalocal sancho
</code></pre></div><p><strong>Sancho</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">127.0.0.1 localhost
127.0.1.1 sancho.novalocal sancho
10.0.1.6 dulcinea.novalocal dulcinea
10.0.1.13 quijote.novalocal quijote
</code></pre></div><p><strong>Quijote</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
127.0.0.1   localhost quijote.novalocal quijote
10.0.1.6    dulcinea.novalocal dulcinea
10.0.1.11   sancho.novalocal sancho
</code></pre></div><h2 id="13-asegúrate-que-el-servidor-tiene-sincronizado-su-reloj-utilizando-un-servidor-ntp-externo">13. Asegúrate que el servidor tiene sincronizado su reloj utilizando un servidor NTP externo</h2>
<p><strong>Dulcinea</strong></p>
<p>Listamos las zonas</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">timedatectl list-timezones
</code></pre></div><p>Cambiamos la zona</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">timedatectl set-timezone Europe/Madrid
</code></pre></div><p>Comprobamos la hora</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@dulcinea<span style="color:#960050;background-color:#1e0010">:</span>/home/debian<span style="color:#75715e"># date</span>
Tue 24 Nov 2020 01<span style="color:#960050;background-color:#1e0010">:</span>42<span style="color:#960050;background-color:#1e0010">:</span>16 PM CET
</code></pre></div><p>Se sigue el mismo procedimiento con Sancho y Quijote.</p>
<p><strong>Sancho</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># timedatectl set-timezone Europe/Madrid</span>
root@sancho<span style="color:#960050;background-color:#1e0010">:</span>/home/ubuntu<span style="color:#75715e"># date</span>
Tue Nov 24 13<span style="color:#960050;background-color:#1e0010">:</span>46<span style="color:#960050;background-color:#1e0010">:</span>08 CET 2020
</code></pre></div><p><strong>Quijote</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">[root@quijote centos]<span style="color:#75715e"># timedatectl set-timezone Europe/Madrid</span>
[root@quijote centos]<span style="color:#75715e"># date</span>
Tue Nov 24 13<span style="color:#960050;background-color:#1e0010">:</span>46<span style="color:#960050;background-color:#1e0010">:</span>49 CET 2020
</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Compilación de un kernel linux a medida</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/compilaci%C3%B3n-de-un-kernel-linux-a-medida/</link>
            <pubDate>Sun, 15 Nov 2020 20:07:29 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/compilaci%C3%B3n-de-un-kernel-linux-a-medida/</guid>
            <description>Ejercicio planteado:
Al ser linux un kérnel libre, es posible descargar el código fuente, configurarlo y comprimirlo. Además, esta tarea a priori compleja, es más sencilla de lo que parece gracias a las herramientas disponibles.
En esta tarea debes tratar de compilar un kérnel completamente funcional que reconozca todo el hardware básico de tu equipo y que sea a la vez lo más pequeño posible, es decir que incluya un vmlinuz lo más pequeño posible y que incorpore sólo los módulos imprescindibles.</description>
            <content type="html"><![CDATA[<p>Ejercicio planteado:</p>
<p>Al ser linux un kérnel libre, es posible descargar el código fuente, configurarlo y comprimirlo. Además, esta tarea a priori compleja, es más sencilla de lo que parece gracias a las herramientas disponibles.</p>
<p>En esta tarea debes tratar de compilar un kérnel completamente funcional que reconozca todo el hardware básico de tu equipo y que sea a la vez lo más pequeño posible, es decir que incluya un vmlinuz lo más pequeño posible y que incorpore sólo los módulos imprescindibles. Para ello utiliza el método explicado en clase y entrega finalmente el fichero deb con el kérnel compilado por ti.</p>
<p>El hardware básico incluye como mínimo el teclado, la interfaz de red y la consola gráfica (texto).</p>
<hr>
<h2 id="1-obtener-el-código-fuente-del-kernel">1. Obtener el código fuente del kernel</h2>
<ul>
<li>Buscamos las <strong>fuentes</strong> en la paqueteria de Debian</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt search linux-source
</code></pre></div><p>Salida:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">linux-source/stable 4.19+105+deb10u7 all
  Linux kernel source <span style="color:#f92672">(</span>meta-package<span style="color:#f92672">)</span>

linux-source-4.19/stable 4.19.152-1 all
  Linux kernel source <span style="color:#66d9ef">for</span> version 4.19 with Debian patches

</code></pre></div><ul>
<li>Segun la versión de kernel que tenemos instalado:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt policy linux-source
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">linux-source:
  Instalados: <span style="color:#f92672">(</span>ninguno<span style="color:#f92672">)</span>
  Candidato:  4.19+105+deb10u7
  Tabla de versión:
     4.19+105+deb10u7 <span style="color:#ae81ff">500</span>
        <span style="color:#ae81ff">500</span> http://security.debian.org/debian-security buster/updates/main amd64 Packages
     4.19+105+deb10u6 <span style="color:#ae81ff">500</span>
        <span style="color:#ae81ff">500</span> http://deb.debian.org/debian buster/main amd64 Packages
</code></pre></div><ul>
<li>Entonces descargamos la versión del kernel que nos pertenece. Además del paquete <strong>build-essential</strong> y <strong>qtbase5-dev</strong>, que son esenciales para su compilación.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install linux-source<span style="color:#f92672">=</span>4.19+105+deb10u7 build-essential qtbase5-dev
</code></pre></div><h2 id="2-descomprimir-las-fuentes-en-un-directorio-seguro-como-usuario">2. Descomprimir las fuentes en un directorio &lsquo;seguro&rsquo; como usuario.</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /home/celiagm/compilar_kernel
sudo mv linux-source-4.19.tar.xz /home/celiagm/compilar_kernel/
cd /home/celiagm/compilar_kernel/
tar -xf linux-source-4.19.tar.xz 
</code></pre></div><ul>
<li>Vemos el tamaño</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ du -hs linux-source-4.19
910M	linux-source-4.19

</code></pre></div><ul>
<li>Vemos el <strong>contenido</strong> de nuestras fuentes</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ cd linux-source-4.19/
celiagm@debian:~/compilar_kernel/linux-source-4.19$ ls
arch   COPYING  Documentation  fs       ipc      kernel    MAINTAINERS  net      scripts   tools
block  CREDITS  drivers        include  Kbuild   lib       Makefile     README   security  usr
certs  crypto   firmware       init     Kconfig  LICENSES  mm           samples  sound     virt
</code></pre></div><ul>
<li>Para ver la <strong>ayuda</strong> de make</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make help
</code></pre></div><h2 id="3-copiar-la-configuración-del-kernel-que-tenemos-actualmente">3. Copiar la configuración del kernel que tenemos actualmente</h2>
<ul>
<li>Esta es la opción que nos muestra la ayuda</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"> oldconfig	  - Update current config utilising a provided .config as base
</code></pre></div><ul>
<li>Ahora copiamos el fichero de configuración que tenemos inicialmente en nuestro kernel a nuestro directorio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cp /boot/config-4.19.0-12-amd64 .config
</code></pre></div><ul>
<li>Ejecutamos <strong>make oldconfig</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make oldconfig
</code></pre></div><ul>
<li>Miramos el número de elementos que se van a compilar como modulos y estaticamente.</li>
</ul>
<p>Modulos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
</code></pre></div><p>Estatica:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
<span style="color:#ae81ff">3381</span>
celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
<span style="color:#ae81ff">2013</span>
</code></pre></div><h2 id="4-selección-y-reducción-de-elementos-loadmodconfig">4. Selección y reducción de elementos (loadmodconfig)</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make localmodconfig
</code></pre></div><ul>
<li>Vemos que se ha reducido sifgnificativamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
<span style="color:#ae81ff">182</span>
celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
<span style="color:#ae81ff">1449</span>
</code></pre></div><h2 id="5-primera-compilación">5. Primera compilación</h2>
<ul>
<li>
<p>Realizamos la primera compilación (indicandole el numero de nucleos que vayamos a utilizar para agilizar el proceso)</p>
</li>
<li>
<p>Nos aseguramos que tenemos estos paquetes instalados antes de proceder con la compilación:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">libelf-devel
libssl-dev
pkg-config
</code></pre></div><ul>
<li>Procedemos a la compilación. Con la opción <strong>-j</strong> le pasamos como parámetro el número de núcleos que queremos que utilice nuestro pc.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make -j <span style="color:#ae81ff">4</span> bindeb-pkg
</code></pre></div><h2 id="6-tamaño-del-fichero-deb">6. Tamaño del fichero deb</h2>
<ul>
<li>Comprobar el peso del fichero deb, en el directorio padre que es donde se han generado los ficheros deb</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ du -hs linux-image-4.19.152_4.19.152-1_amd64.deb 
11M	linux-image-4.19.152_4.19.152-1_amd64.deb

</code></pre></div><h2 id="7-instalarlo-y-comprobar-funcionamiento">7. Instalarlo y comprobar funcionamiento</h2>
<ul>
<li>Ver los kernel instalados</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">dpkg -l | grep linux-image
</code></pre></div><ul>
<li>Desinstalar el kernel que <strong>no funciona</strong> cuando sea necesario:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt-get remove --purge linux-image-X.X.X-X
</code></pre></div><ul>
<li>Instalar el &lsquo;nuevo&rsquo; kernel</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo dpkg -i linux-image-4.19.152_4.19.152-1_amd64.deb 
</code></pre></div><ul>
<li>Vemos que funciona correctamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~$ uname -r
4.19.152

</code></pre></div><h2 id="8-reducir-elementos">8. Reducir elementos.</h2>
<ul>
<li>Con el siguiente comando se nos abre una ventana y podemos elegir los módulos o elementos que queremos quitar.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make xconfig
</code></pre></div><h4 id="1º-reducción">1º REDUCCIÓN</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">RF switch subsystem support <span style="color:#f92672">(</span>RFKILL<span style="color:#f92672">)</span>: soporte para interruptor de tarjetas wifi y bluetooh
Bluetooth subsystem support <span style="color:#f92672">(</span>BT<span style="color:#f92672">)</span>: Bluetooth
QoS and/or fair queueing <span style="color:#f92672">(</span>NET_SCHED<span style="color:#f92672">)</span>: elegir paquetes retraso primero o en cola
Network packet filtering framework <span style="color:#f92672">(</span>Netfilter<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>NETFILTER<span style="color:#f92672">)</span>: filtrado de paquetes, cortafuegos
Multimedia support <span style="color:#f92672">(</span>MEDIA_SUPPORT<span style="color:#f92672">)</span>: Soporte para multimedia
Sound card support <span style="color:#f92672">(</span>SOUND<span style="color:#f92672">)</span>: Soporte para el sonido
Linux guest support <span style="color:#f92672">(</span>HYPERVISOR_GUEST<span style="color:#f92672">)</span>: Soporte para maquinas virtuales
Macintosh device drivers <span style="color:#f92672">(</span>MACINTOSH_DRIVERS<span style="color:#f92672">)</span>
Macintosh device drivers <span style="color:#f92672">(</span>MACINTOSH_DRIVERS<span style="color:#f92672">)</span>
Hardware Monitoring support <span style="color:#f92672">(</span>HWMON<span style="color:#f92672">)</span>: Monitoreo de hardware
Hardware crypto devices <span style="color:#f92672">(</span>CRYPTO_HW<span style="color:#f92672">)</span>: Encriptación de hardware
Virtualization <span style="color:#f92672">(</span>VIRTUALIZATION<span style="color:#f92672">)</span>

</code></pre></div><p>Numero de elementos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
<span style="color:#ae81ff">135</span>
celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
<span style="color:#ae81ff">1315</span>
</code></pre></div><p>Tamaño conseguido:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ du -hs linux-image-4.19.152_4.19.152-1_amd64.deb 
9,1M	linux-image-4.19.152_4.19.152-1_amd64.deb

</code></pre></div><h4 id="2º-reducción">2º REDUCCIÓN</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">DMA memory allocation support <span style="color:#f92672">(</span>ZONE_DMA<span style="color:#f92672">)</span>
Symmetric multi-processing support <span style="color:#f92672">(</span>SMP<span style="color:#f92672">)</span>
Memtest <span style="color:#f92672">(</span>MEMTEST<span style="color:#f92672">)</span>
Enable DMI scanning <span style="color:#f92672">(</span>DMI<span style="color:#f92672">)</span>
Platform support <span style="color:#66d9ef">for</span> Chrome hardware <span style="color:#f92672">(</span>CHROME_PLATFORMS<span style="color:#f92672">)</span>
IBM Calgary IOMMU support <span style="color:#f92672">(</span>CALGARY_IOMMU<span style="color:#f92672">)</span>
Enable support <span style="color:#66d9ef">for</span> 16-bit segments <span style="color:#f92672">(</span>X86_16BIT<span style="color:#f92672">)</span>
Allow <span style="color:#66d9ef">for</span> memory hot-add <span style="color:#f92672">(</span>MEMORY_HOTPLUG<span style="color:#f92672">)</span>
Track memory changes <span style="color:#f92672">(</span>MEM_SOFT_DIRTY<span style="color:#f92672">)</span>
x86 architectural random number generator
Supervisor Mode Access Prevention <span style="color:#f92672">(</span>X86_SMAP<span style="color:#f92672">)</span>
The IPv6 protocol <span style="color:#f92672">(</span>IPV6<span style="color:#f92672">)</span>
Battery <span style="color:#f92672">(</span>ACPI_BATTERY<span style="color:#f92672">)</span>
AMD MCE features <span style="color:#f92672">(</span>X86_MCE_AMD<span style="color:#f92672">)</span>
IP: multicast routing <span style="color:#f92672">(</span>IP_MROUTE<span style="color:#f92672">)</span>
LED Support <span style="color:#f92672">(</span>NEW_LEDS<span style="color:#f92672">)</span>
Accessibility support <span style="color:#f92672">(</span>ACCESSIBILITY<span style="color:#f92672">)</span>
Virtualization drivers <span style="color:#f92672">(</span>VIRT_DRIVERS<span style="color:#f92672">)</span>
Staging drivers <span style="color:#f92672">(</span>STAGING<span style="color:#f92672">)</span>
Network File Systems <span style="color:#f92672">(</span>NETWORK_FILESYSTEMS<span style="color:#f92672">)</span>

</code></pre></div><p>Numero de elementos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
<span style="color:#ae81ff">128</span>
celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
<span style="color:#ae81ff">1197</span>

</code></pre></div><p>Tamaño conseguido:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ du -hs linux-image-4.19.152_4.19.152-2_amd64.deb 
8,1M	linux-image-4.19.152_4.19.152-2_amd64.deb

</code></pre></div><h4 id="3º-reducción">3º REDUCCIÓN</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Support <span style="color:#66d9ef">for</span> paging of anonymous memory <span style="color:#f92672">(</span>swap<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SWAP<span style="color:#f92672">)</span>
Enable the block layer <span style="color:#f92672">(</span>BLOCK<span style="color:#f92672">)</span>
Namespaces support <span style="color:#f92672">(</span>NAMESPACES<span style="color:#f92672">)</span>


esenciales???
Extended Error Log support <span style="color:#f92672">(</span>ACPI_EXTLOG<span style="color:#f92672">)</span>
ACPI Platform Error Interface <span style="color:#f92672">(</span>APEI<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>ACPI_APEI<span style="color:#f92672">)</span>
/dev/agpgart <span style="color:#f92672">(</span>AGP Support<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>AGP<span style="color:#f92672">)</span>
Support <span style="color:#66d9ef">for</span> PCI Hotplug <span style="color:#f92672">(</span>HOTPLUG_PCI<span style="color:#f92672">)</span>
ACPI <span style="color:#f92672">(</span>Advanced Configuration and Power Interface<span style="color:#f92672">)</span> Support <span style="color:#f92672">(</span>ACPI<span style="color:#f92672">)</span> 
</code></pre></div><p>Numero de elementos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=m&#34;</span> .config|wc -l
<span style="color:#ae81ff">108</span>
celiagm@debian:~/compilar_kernel/linux-source-4.19$ grep <span style="color:#e6db74">&#34;=y&#34;</span> .config|wc -l
<span style="color:#ae81ff">1052</span>


</code></pre></div><p>Tamaño conseguido:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/compilar_kernel$ du -hs linux-image-4.19.152_4.19.152-4_amd64.deb 
7,0M	linux-image-4.19.152_4.19.152-4_amd64.deb


</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Instalación de un entorno LAMP</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n-de-un-entorno-lamp/</link>
            <pubDate>Wed, 11 Nov 2020 19:21:43 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n-de-un-entorno-lamp/</guid>
            <description>Instalación de un servidor LAMP Crea una instancia de vagrant basado en un box de debian o ubuntu  Primero creamos el fichero Vagrantfile  nano Vagrantfile  Le añadimos estas lineas para configurar nuestra máquina debian  # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(&amp;#34;2&amp;#34;) do |config| config.vm.box = &amp;#34;debian/buster64&amp;#34; config.vm.hostname = &amp;#34;debian-cms&amp;#34; config.vm.network :public_network, :bridge=&amp;gt;&amp;#34;enp5s0&amp;#34; end  Levantamos la máquina  vagrant up  Cuando esté lista entramos en la máquina por ssh  vagrant ssh  Una vez dentro le añadimos los repositorios esenciales y actualizamos la máquina  sudo su nano /etc/apt/sources.</description>
            <content type="html"><![CDATA[<h2 id="instalación-de-un-servidor-lamp">Instalación de un servidor LAMP</h2>
<h2 id="crea-una-instancia-de-vagrant-basado-en-un-box-de-debian-o-ubuntu">Crea una instancia de vagrant basado en un box de debian o ubuntu</h2>
<ul>
<li>Primero creamos el fichero <em>Vagrantfile</em></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano Vagrantfile
</code></pre></div><ul>
<li>Le añadimos estas lineas para configurar nuestra máquina debian</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># -*- mode: ruby -*-</span>
<span style="color:#75715e"># vi: set ft=ruby :</span>

Vagrant.configure<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">do</span> |config|
        config.vm.box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian/buster64&#34;</span>
        config.vm.hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian-cms&#34;</span>
        config.vm.network :public_network, :bridge<span style="color:#f92672">=</span>&gt;<span style="color:#e6db74">&#34;enp5s0&#34;</span>
end

</code></pre></div><ul>
<li>Levantamos la máquina</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vagrant up
</code></pre></div><ul>
<li>Cuando esté lista entramos en la máquina por ssh</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vagrant ssh
</code></pre></div><ul>
<li>Una vez dentro le añadimos los repositorios esenciales y actualizamos la máquina</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo su
nano /etc/apt/sources.list
</code></pre></div><ul>
<li>Dejamos la lista de repositorios de esta forma:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">deb http://deb.debian.org/debian buster main
deb-src http://deb.debian.org/debian buster main

deb http://deb.debian.org/debian-security/ buster/updates main
deb-src http://deb.debian.org/debian-security/ buster/updates main

deb http://deb.debian.org/debian buster-updates main
deb-src http://deb.debian.org/debian buster-updates main
</code></pre></div><ul>
<li>Actualizamos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt update
apt upgrade
</code></pre></div><h2 id="instala-en-esa-máquina-virtual-toda-una-pila-lamp">Instala en esa máquina virtual toda una pila LAMP</h2>
<h3 id="qué-es-lamp">¿Qué es LAMP?</h3>
<p><strong>LAMP</strong> es el acŕonimo usado para describir un sistema de infraestructura de internet que usa las siguientes herramientas:</p>
<ul>
<li><strong>Linux</strong>, como sistema operativo. En este caso usaremos la distribución Debian Buster.</li>
<li><strong>Apache</strong>, que va ser nuestro servidor web.</li>
<li><strong>MySQL/MariaDB</strong>, que va ser nuestro gestor de base de datos.</li>
<li><strong>PHP</strong>, como lenguaje de programación.</li>
</ul>
<h3 id="instalacion-de-apache-web-server">Instalacion de Apache Web Server</h3>
<ul>
<li>Instalamos <strong>apache2</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install apache2 apache2-utils
</code></pre></div><ul>
<li>Vemos la <strong>version</strong> de apache</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# apache2 -v
Server version: Apache/2.4.38 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span>
Server built:   2020-08-25T20:08:29

</code></pre></div><ul>
<li>Comprobamos que apache está funcionando correctamente</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# systemctl status apache2
● apache2.service - The Apache HTTP Server
   Loaded: loaded <span style="color:#f92672">(</span>/lib/systemd/system/apache2.service; enabled; vendor preset: enabled<span style="color:#f92672">)</span>
   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Sun 2020-11-01 13:38:34 GMT; 9min ago
     Docs: https://httpd.apache.org/docs/2.4/
 Main PID: <span style="color:#ae81ff">26137</span> <span style="color:#f92672">(</span>apache2<span style="color:#f92672">)</span>
    Tasks: <span style="color:#ae81ff">6</span> <span style="color:#f92672">(</span>limit: 544<span style="color:#f92672">)</span>
   Memory: 10.8M
   CGroup: /system.slice/apache2.service
           ├─26137 /usr/sbin/apache2 -k start
           ├─26141 /usr/sbin/apache2 -k start
           ├─26142 /usr/sbin/apache2 -k start
           ├─26143 /usr/sbin/apache2 -k start
           ├─26144 /usr/sbin/apache2 -k start
           └─26145 /usr/sbin/apache2 -k start

Nov <span style="color:#ae81ff">01</span> 13:38:34 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting The Apache HTTP Server...
Nov <span style="color:#ae81ff">01</span> 13:38:34 debian-cms apachectl<span style="color:#f92672">[</span>26133<span style="color:#f92672">]</span>: AH00558: apache2: Could not reliably determine the server<span style="color:#960050;background-color:#1e0010">&#39;</span>s 
Nov <span style="color:#ae81ff">01</span> 13:38:34 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Started The Apache HTTP Server.
lines 1-18/18 <span style="color:#f92672">(</span>END<span style="color:#f92672">)</span>

</code></pre></div><h3 id="instalación-de-mysqlmariadb">Instalación de MYSQL/MariaDB</h3>
<ul>
<li>Instalamos nuestro <strong>gestor de base de datos</strong> de la siguiente forma</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install mariadb-client mariadb-server
</code></pre></div><ul>
<li>Ahora entramos como root a mysql.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
Your MariaDB connection id is <span style="color:#ae81ff">49</span>
Server version: 10.3.25-MariaDB-0+deb10u1 Debian <span style="color:#ae81ff">10</span>

Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; 

</code></pre></div><ul>
<li>Creamos la base de datos, la llamaremos &lsquo;cms&rsquo;.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; create database cms;
Query OK, <span style="color:#ae81ff">1</span> row affected <span style="color:#f92672">(</span>0.002 sec<span style="color:#f92672">)</span>

</code></pre></div><ul>
<li>Creamos un <strong>usuario</strong> y le damos los <strong>privilegios</strong> para usar esa base de datos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; create user <span style="color:#e6db74">&#39;cgm&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span>;
Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.005 sec<span style="color:#f92672">)</span>

MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; grant all privileges on cms.* to <span style="color:#e6db74">&#39;cgm&#39;</span>@<span style="color:#e6db74">&#39;localhost&#39;</span> identified by <span style="color:#e6db74">&#39;cgm&#39;</span>;
Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.002 sec<span style="color:#f92672">)</span>

</code></pre></div><h3 id="instalación-de-php">Instalación de PHP</h3>
<ul>
<li>Instalamos <strong>PHP</strong>, el módulo para conectarnos a la base de datos y el módulo que nos permite conectarnos al sevidor.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install php php-mysql libapache2-mod-php php-gd
</code></pre></div><ul>
<li>Vemos la <strong>version</strong> de php</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# php -v
PHP 7.3.19-1~deb10u1 <span style="color:#f92672">(</span>cli<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>built: Jul  <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2020</span> 06:46:45<span style="color:#f92672">)</span> <span style="color:#f92672">(</span> NTS <span style="color:#f92672">)</span>
Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 1997-2018 The PHP Group
Zend Engine v3.3.19, Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 1998-2018 Zend Technologies
    with Zend OPcache v7.3.19-1~deb10u1, Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 1999-2018, by Zend Technologies

</code></pre></div><p>Con esto ya tendríamos <strong>LAMP</strong> operativo en nuestro sistema.</p>
<h2 id="funcionamiento">FUNCIONAMIENTO</h2>
<ul>
<li>
<p>Creamos un index.html sencillo dentro de nuestro directorio /var/www/html</p>
</li>
<li>
<p>Vemos que funciona nuestro entorno LAMP</p>
</li>
</ul>
<p>Mariadb en funcionamiento:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# systemctl status mariadb
● mariadb.service - MariaDB 10.3.25 database server
   Loaded: loaded <span style="color:#f92672">(</span>/lib/systemd/system/mariadb.service; enabled; vendor preset: enabled<span style="color:#f92672">)</span>
   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Fri 2020-11-06 12:03:53 GMT; 6h ago
     Docs: man:mysqld<span style="color:#f92672">(</span>8<span style="color:#f92672">)</span>
           https://mariadb.com/kb/en/library/systemd/
  Process: <span style="color:#ae81ff">414</span> ExecStartPre<span style="color:#f92672">=</span>/usr/bin/install -m <span style="color:#ae81ff">755</span> -o mysql -g root -d /var/run/mysqld <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, sta
  Process: <span style="color:#ae81ff">425</span> ExecStartPre<span style="color:#f92672">=</span>/bin/sh -c systemctl unset-environment _WSREP_START_POSITION <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, st
  Process: <span style="color:#ae81ff">431</span> ExecStartPre<span style="color:#f92672">=</span>/bin/sh -c <span style="color:#f92672">[</span> ! -e /usr/bin/galera_recovery <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> VAR<span style="color:#f92672">=</span> <span style="color:#f92672">||</span>   VAR<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>cd /usr/bin/..
  Process: <span style="color:#ae81ff">515</span> ExecStartPost<span style="color:#f92672">=</span>/bin/sh -c systemctl unset-environment _WSREP_START_POSITION <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, s
  Process: <span style="color:#ae81ff">517</span> ExecStartPost<span style="color:#f92672">=</span>/etc/mysql/debian-start <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, status<span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
 Main PID: <span style="color:#ae81ff">479</span> <span style="color:#f92672">(</span>mysqld<span style="color:#f92672">)</span>
   Status: <span style="color:#e6db74">&#34;Taking your SQL requests now...&#34;</span>
    Tasks: <span style="color:#ae81ff">30</span> <span style="color:#f92672">(</span>limit: 544<span style="color:#f92672">)</span>
   Memory: 149.6M
   CGroup: /system.slice/mariadb.service
           └─479 /usr/sbin/mysqld

Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting MariaDB 10.3.25 database server...
Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms mysqld<span style="color:#f92672">[</span>479<span style="color:#f92672">]</span>: 2020-11-06 12:03:52 <span style="color:#ae81ff">0</span> <span style="color:#f92672">[</span>Note<span style="color:#f92672">]</span> /usr/sbin/mysqld <span style="color:#f92672">(</span>mysqld 10.3.25-Mar
Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms mysqld<span style="color:#f92672">[</span>479<span style="color:#f92672">]</span>: 2020-11-06 12:03:52 <span style="color:#ae81ff">0</span> <span style="color:#f92672">[</span>Warning<span style="color:#f92672">]</span> Could not increase number of max_
Nov <span style="color:#ae81ff">06</span> 12:03:53 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Started MariaDB 10.3.25 database server.
Nov <span style="color:#ae81ff">06</span> 12:03:53 debian-cms /etc/mysql/debian-start<span style="color:#f92672">[</span>531<span style="color:#f92672">]</span>: Checking <span style="color:#66d9ef">for</span> insecure root accounts.
Nov <span style="color:#ae81ff">06</span> 12:03:53 debian-cms /etc/mysql/debian-start<span style="color:#f92672">[</span>535<span style="color:#f92672">]</span>: Triggering myisam-recover <span style="color:#66d9ef">for</span> all MyISAM tables 
lines 1-23/23 <span style="color:#f92672">(</span>END<span style="color:#f92672">)</span>

</code></pre></div><p>Apache en funcionamiento:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@debian-cms:/home/vagrant# systemctl status apache2
● apache2.service - The Apache HTTP Server
   Loaded: loaded <span style="color:#f92672">(</span>/lib/systemd/system/apache2.service; enabled; vendor preset: enabled<span style="color:#f92672">)</span>
   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Fri 2020-11-06 12:03:52 GMT; 6h ago
     Docs: https://httpd.apache.org/docs/2.4/
  Process: <span style="color:#ae81ff">416</span> ExecStart<span style="color:#f92672">=</span>/usr/sbin/apachectl start <span style="color:#f92672">(</span>code<span style="color:#f92672">=</span>exited, status<span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
 Main PID: <span style="color:#ae81ff">455</span> <span style="color:#f92672">(</span>apache2<span style="color:#f92672">)</span>
    Tasks: <span style="color:#ae81ff">9</span> <span style="color:#f92672">(</span>limit: 544<span style="color:#f92672">)</span>
   Memory: 34.6M
   CGroup: /system.slice/apache2.service
           ├─455 /usr/sbin/apache2 -k start
           ├─480 /usr/sbin/apache2 -k start
           ├─481 /usr/sbin/apache2 -k start
           ├─482 /usr/sbin/apache2 -k start
           ├─483 /usr/sbin/apache2 -k start
           ├─484 /usr/sbin/apache2 -k start
           ├─588 /usr/sbin/apache2 -k start
           ├─589 /usr/sbin/apache2 -k start
           └─590 /usr/sbin/apache2 -k start

Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting The Apache HTTP Server...
Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms apachectl<span style="color:#f92672">[</span>416<span style="color:#f92672">]</span>: AH00558: apache2: Could not reliably determine the server<span style="color:#960050;background-color:#1e0010">&#39;</span>s fu
Nov <span style="color:#ae81ff">06</span> 12:03:52 debian-cms systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Started The Apache HTTP Server.
lines 1-22/22 <span style="color:#f92672">(</span>END<span style="color:#f92672">)</span>

</code></pre></div><p><img src="/images/lamp/index.png" alt="index.png"></p>
<p>php en funcionamiento:</p>
<p><img src="/images/lamp/testphp.png" alt="testphp.png"></p>
<p>-&gt; <a href="https://github.com/CeliaGMqrz/cms_install_debian/blob/main/t2_drupal.md">Instalación de drupal</a></p>
]]></content>
        </item>
        
        <item>
            <title>Servidor Nginx</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/servidor-nginx/</link>
            <pubDate>Wed, 11 Nov 2020 17:51:13 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/servidor-nginx/</guid>
            <description>Servidor Web Nginxx NGINX es un servidor web open source de alta performance que ofrece el contenido estático de un sitio web de forma rápida y fácil de configurar. Ofrece recursos de equilibrio de carga, proxy inverso y streaming, además de gestionar miles de conexiones simultáneas. El resultado de sus aportes es una mayor velocidad y escalabilidad.
Además de otras tareas, los servidores web son los encargados de la entrega de aplicaciones web, respondiendo a peticiones HTTPS realizadas por usuarios, normalmente desde un navegador web.</description>
            <content type="html"><![CDATA[<h1 id="servidor-web-nginxx">Servidor Web Nginxx</h1>
<p><img src="/images/nginx/image.jpg" alt="image.jpg"></p>
<p><strong>NGINX</strong> es un servidor web open source de alta performance que ofrece el contenido estático de un sitio web de forma rápida y fácil de configurar. Ofrece recursos de equilibrio de carga, proxy inverso y streaming, además de gestionar miles de conexiones simultáneas. El resultado de sus aportes es una mayor velocidad y escalabilidad.</p>
<p>Además de otras tareas, los servidores web son los encargados de la entrega de aplicaciones web, respondiendo a peticiones HTTPS realizadas por usuarios, normalmente desde un navegador web.</p>
<p>El funcionamiento base de Nginx es similar al de otros servidores web, en el que un usuario realiza una petición a través del navegador al servidor, y este le envía la información solicitada al navegador.</p>
<p>Lo que hace diferente a Nginx es su arquitectura a la hora de manejar procesos, ya que otros servidores web como Apache crean un hilo por cada solicitud.</p>
<p>-&gt; <a href="https://rockcontent.com/es/blog/nginx/">Más informacion</a></p>
<h2 id="instalación-de-nginx">Instalación de Nginx</h2>
<ul>
<li>Para instalar Nginx vamos a usar el repositorio de Debian, así que lo primero será actualizar la información de paquetes.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo su
apt update
apt upgrade
</code></pre></div><ul>
<li>Instalamos el paquete nginx</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install nginx
</code></pre></div><ul>
<li>Modificar el html y visualizar el sitio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/var/www/html# nano index.html 
</code></pre></div><p><img src="/images/nginx/pruebahtml.png" alt="pruebahtml.png"></p>
<p><a href="https://github.com/CeliaGMqrz/servidor_Nginx/blob/main/t2_virtualhosting.md">Tarea 2: Crear virtualhosting</a></p>
<h2 id="virtual-hosting">Virtual Hosting</h2>
<p>Tarea 2 (2 punto)(Obligatorio): Configura la resolución estática en los clientes y muestra el acceso a cada una de las páginas.</p>
<hr>
<p>Queremos que nuestro servidor web ofrezca dos sitios web, teniendo en cuenta lo siguiente:</p>
<ol>
<li>
<p>Cada sitio web tendrá nombres distintos.</p>
</li>
<li>
<p>Cada sitio web compartirán la misma dirección IP y el mismo puerto (80).</p>
</li>
</ol>
<p>Los dos sitios web tendrán las siguientes características:</p>
<ul>
<li>
<p>El nombre de dominio del primero será <strong><a href="http://www.iesgn.org">www.iesgn.org</a></strong>, su directorio base será <strong>/srv/www/iesgn</strong> y contendrá una página llamada index.html, donde sólo se verá una bienvenida a la página del Instituto Gonzalo Nazareno.</p>
</li>
<li>
<p>En el segundo sitio vamos a crear una página donde se pondrán noticias por parte de los departamento, el nombre de este sitio será <strong>departamentos.iesgn.org</strong>, y su directorio base será <strong>/srv/www/departamentos</strong>. En este sitio sólo tendremos una página inicial index.html, dando la bienvenida a la página de los departamentos del instituto.</p>
</li>
</ul>
<hr>
<h2 id="crear-los-virtual-hosting">Crear los virtual hosting</h2>
<p>Crear el virtualhosting <strong>iesgn</strong> y el de <strong>departamentos</strong>. Para ello copiamos el archivo <em>default</em> que se encuentra en el fichero <em>/etc/nginx/sites-available</em> y le ponemos el nombre de cada virtualhost.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/etc/nginx/sites-available# cp default iesgn
root@servidor-nginx:/etc/nginx/sites-available# ls
default  iesgn
root@servidor-nginx:/etc/nginx/sites-available# cp default departamentos
root@servidor-nginx:/etc/nginx/sites-available# ls
default  departamentos	iesgn

</code></pre></div><p>Deberemos de modificar los ficheros de forma que, eliminamos el &lsquo;default_server&rsquo; para que no haya conflictos con el fichero &lsquo;default&rsquo; que viene por defecto. Cambiamos la ruta de directorios indicando /srv/www/directorio. Cambiamos el &lsquo;server_name&rsquo; indicando el nombre con el que vamos a acceder a nuestro sitio web.</p>
<h2 id="iesgn"><strong>IESGN</strong></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/nginx/sites-available/iesgn 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/iesgn;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name www.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><h2 id="departamentos"><strong>DEPARTAMENTOS</strong></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/nginx/sites-available/departamentos 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>

server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/departamentos;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name departamentos.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><p>Creamos los enlaces simbólicos para la carpeta &lsquo;sites-enabled&rsquo; y así activar nuestros virtualhosting, en apache utilizabamos una herramienta pero aquí hay que hacerlo manual.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ln -s /etc/nginx/sites-available/iesgn /etc/nginx/sites-enabled/iesgn
ln -s /etc/nginx/sites-available/departamentos /etc/nginx/sites-enabled/departamentos

</code></pre></div><p>Comprobamos que está bien configurado con <strong>nginx -t</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/etc/nginx/sites-available# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

</code></pre></div><p>Crear los <strong>directorios</strong> correspondientes, no es necesario dar permisos ya que con Nginx usa los permisos de superusuario &lsquo;root&rsquo;. Hemos creado la siguiente estructura tal y como se pide en el ejercicio:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/srv# tree
.
└── www
    ├── departamentos
    │   └── index.html
    └── iesgn
        └── index.html

<span style="color:#ae81ff">3</span> directories, <span style="color:#ae81ff">2</span> files


</code></pre></div><h4 id="configurar-el-cliente-máquina-anfitriona">Configurar el cliente (máquina anfitriona)</h4>
<p>Configuramos nuestro fichero /etc/hosts añadiendo estas líneas</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">172.22.200.152 www.iesgn.org
172.22.200.152 departamentos.iesgn.org

</code></pre></div><p>Reiniciamos el servicio</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl restart nginx
</code></pre></div><p>Comprobamos que podemos acceder a ellas</p>
<p><strong><a href="http://www.iesgn.org">www.iesgn.org</a></strong></p>
<p><img src="/images/nginx/iesgn.png" alt="iesgn.png"></p>
<p><strong>departamentos.iesgn.org</strong></p>
<p><img src="/images/nginx/departamentos.png" alt="departamentos.png"></p>
<h1 id="mapeo-de-url">Mapeo de URL</h1>
<p>Cambia la configuración del sitio web <a href="http://www.iesgn.org">www.iesgn.org</a> para que se comporte de la siguiente forma:</p>
<ul>
<li><strong>Tarea 3 (1 punto)(Obligatorio): Cuando se entre a la dirección <a href="http://www.iesgn.org">www.iesgn.org</a> se redireccionará automáticamente a <a href="http://www.iesgn.org/principal,">www.iesgn.org/principal,</a> donde se mostrará el mensaje de bienvenida. En el directorio principal no se permite ver la lista de los ficheros, no se permite que se siga los enlaces simbólicos y no se permite negociación de contenido. Muestra al profesor el funcionamiento.</strong></li>
</ul>
<p>Para redireccionar <em><a href="http://www.iesgn.org">www.iesgn.org</a></em> a <em><a href="http://www.iesgn.org/principal">www.iesgn.org/principal</a></em> necesitamos editar el fichero de configuracion de <em>iesgn</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
<span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/iesgn;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name www.iesgn.org;

        location <span style="color:#f92672">=</span> / <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">301</span> $scheme://www.iesgn.org/principal;
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;   
        <span style="color:#f92672">}</span>

        location /principal/ <span style="color:#f92672">{</span>
                <span style="color:#75715e"># No se permite ver la lista de ficheros</span>
                autoindex off;
                <span style="color:#75715e"># No se permite el seguimiento de enlaces simbólicos</span>
                disable_symlinks off;
                <span style="color:#75715e"># No se permite la negociación de contenido</span>
                try_files $uri $uri/ index.html;
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><p>No nos olvidemos de crear el directorio <em>principal</em> y mover el <em>index.html</em> a su interior.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /srv/www/iesgn/principal
mv /srv/www/iesgn/index.html /srv/www/iesgn/principal/
</code></pre></div><hr>
<ul>
<li><strong>Tarea 4 (1 punto)(Obligatorio): Si accedes a la página <a href="http://www.iesgn.org/principal/documentos">www.iesgn.org/principal/documentos</a> se visualizarán los documentos que hay en /srv/doc. Por lo tanto se permitirá el listado de fichero y el seguimiento de enlaces simbólicos siempre que sean a ficheros o directorios cuyo dueño sea el usuario. Muestra al profesor el funcionamiento.</strong></li>
</ul>
<p>Creamos los directorios <em>/srv/doc</em> y <em>/srv/www/iesgn/principal/documentos</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /srv/doc
mkdir /srv/www/iesgn/principal/documentos
</code></pre></div><p>Dentro de <em>/srv/doc</em> creamos los ficheros de prueba y le ponemos los permisos y propietarios adecuados para cada uno, de forma que uno sea de <strong>root</strong> y el otro sea del usuario <strong>debian</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/srv/doc# ls -l
total <span style="color:#ae81ff">8</span>
-rw-r--r-- <span style="color:#ae81ff">1</span> root   root   <span style="color:#ae81ff">32</span> Nov <span style="color:#ae81ff">10</span> 13:04 ficheroderoot.txt
-rw-r--r-- <span style="color:#ae81ff">1</span> debian debian <span style="color:#ae81ff">38</span> Nov <span style="color:#ae81ff">10</span> 13:07 ficherodeusuario.txt

</code></pre></div><p>Creamos el enlace simbólico del contendio que hay en doc hacia la carpeta documentos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:~# ln -svf /srv/doc /srv/www/iesgn/principal/documentos
<span style="color:#e6db74">&#39;/srv/www/iesgn/principal/documentos/doc&#39;</span> -&gt; <span style="color:#e6db74">&#39;/srv/doc&#39;</span>

</code></pre></div><p><strong>Fichero de configuración</strong></p>
<p>Usamos &lsquo;<em>alias</em>&rsquo; para poder mostrar los documentos de la ruta <em>/srv/doc</em>, activamos el listado de ficheros, el seguimiento de enlaces simbólicos y le ponemos la opción <em>if_not_owner</em> para que deniegue el acceso a un archivo si no es el propietario</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/iesgn;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name www.iesgn.org;

        location <span style="color:#f92672">=</span> / <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">301</span> $scheme://www.iesgn.org/principal;
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

        location /principal <span style="color:#f92672">{</span>
                <span style="color:#75715e"># No se permite ver la lista de ficheros</span>
                autoindex off;
                <span style="color:#75715e"># No se permite el seguimiento de enlaces simbólicos</span>
                disable_symlinks off;
                <span style="color:#75715e"># No se permite la negociación de contenido</span>
                try_files $uri $uri/ index.html;
        <span style="color:#f92672">}</span>

        location /principal/documentos <span style="color:#f92672">{</span>

                <span style="color:#75715e">#alias</span>
                alias /srv/doc;
                <span style="color:#75715e"># Permitir listado de ficheros</span>
                autoindex on;
                <span style="color:#75715e"># Permitir el seguimiento de enlaces simbólicos solo al propietario</span>
                disable_symlinks if_not_owner;
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


</code></pre></div><hr>
<p><img src="/images/nginx/documentos.png" alt="documentos.png"></p>
<hr>
<hr>
<ul>
<li><strong>Tarea 5 (1 punto): En todo el host virtual se debe redefinir los mensajes de error de objeto no encontrado y no permitido. Para el ello se crearan dos ficheros html dentro del directorio error. Entrega las modificaciones necesarias en la configuración y una comprobación del buen funcionamiento.</strong></li>
</ul>
<p>Creamos los dos ficheros html dentro de un directorio <em>error</em> en nuestro virtualhosting. Y modificamos el fichero de nuestro virtualhosting</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/etc/nginx# tree /srv/www/iesgn/error/
/srv/www/iesgn/error/
├── 403.html
└── 404.html
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>
<span style="color:#75715e">#</span>
server <span style="color:#f92672">{</span>
        listen 80;

        <span style="color:#75715e">#set $root_path /var/www/iesgn;</span>
        <span style="color:#75715e">#root $root_path;</span>
        root /srv/www/iesgn;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name www.iesgn.org;
        error_page 404 <span style="color:#f92672">=</span> /error/404.html;
        error_page 403 <span style="color:#f92672">=</span> /error/403.html;
        location <span style="color:#f92672">=</span> / <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">301</span> $scheme://www.iesgn.org/principal;
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                <span style="color:#75715e">#try_files $uri $uri/ =404;</span>

        <span style="color:#f92672">}</span>

        location /principal <span style="color:#f92672">{</span>
                <span style="color:#75715e"># No se permite ver la lista de ficheros</span>
                autoindex off;
                <span style="color:#75715e"># No se permite el seguimiento de enlaces simbólicos</span>
                disable_symlinks off;
                <span style="color:#75715e"># No se permite la negociación de contenido</span>
                try_files $uri $uri/ index.html;
        <span style="color:#f92672">}</span>

        location /principal/documentos <span style="color:#f92672">{</span>

                <span style="color:#75715e">#alias</span>
                alias /srv/doc;
                <span style="color:#75715e"># Permitir listado de ficheros</span>
                autoindex on;
                <span style="color:#75715e"># Permitir el seguimiento de enlaces simbólicos solo al propietario</span>
                disable_symlinks if_not_owner;

        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><p>Reiniciamos el servicio.</p>
<p>Provocamos un error en la url y vemos el <strong>error 404</strong>.</p>
<p><img src="/images/nginx/404.png" alt="404.png"></p>
<p>Cambiamos el &lsquo;autoindex on&rsquo; por &lsquo;<strong>autoindex off</strong>&rsquo; para denegar los permisos de visibilidad de ficheros y comprobamos que nos muestra la pagina de <strong>error 403</strong> que hemos creado.</p>
<p><img src="/images/nginx/403.png" alt="403.png"></p>
<h2 id="autentificación-autorización-y-control-de-acceso">Autentificación, Autorización y Control de Acceso</h2>
<ul>
<li><strong>Tarea 6 (1 punto)(Obligatorio): Añade al escenario otra máquina conectada por una red interna al servidor. A la URL departamentos.iesgn.org/intranet sólo se debe tener acceso desde el cliente de la red local, y no se pueda acceder desde la anfitriona por la red pública. A la URL departamentos.iesgn.org/internet, sin embargo, sólo se debe tener acceso desde la anfitriona por la red pública, y no desde la red local.</strong></li>
</ul>
<ol>
<li>Creamos la máquina (cliente) , cuya ip flotante es: <strong>172.22.200.148</strong></li>
</ol>
<p><img src="/images/nginx/instancias.png" alt="instancias.png"></p>
<ol start="3">
<li>Creamos los directorios internet e intranet con un index.html</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /srv/www/departamentos/intranet
mkdir /srv/www/departamentos/internet
cp /srv/www/iesgn/principal/index.html /srv/www/departamentos/intranet/
cp /srv/www/iesgn/principal/index.html /srv/www/departamentos/internet/
nano /srv/www/departamentos/internet/index.html 
nano /srv/www/departamentos/intranet/index.html 
</code></pre></div><ol start="2">
<li>Configuramos el servidor en nuestro virtualhost departamentos y el <em>/etc/hosts</em> en el cliente</li>
</ol>
<p>En el <strong>sevidor</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/nginx/sites-available/departamentos 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>

server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/departamentos;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name departamentos.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

        location /intranet <span style="color:#f92672">{</span>
                allow 10.0.0.6/24;
                deny all;
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>En el <strong>cliente</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/hosts
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Your system has configured &#39;manage_etc_hosts&#39; as True.</span>
<span style="color:#75715e"># As a result, if you wish for changes to this file to persist</span>
<span style="color:#75715e"># then you will need to either</span>
<span style="color:#75715e"># a.) make changes to the master file in /etc/cloud/templates/hosts.debian.tmpl</span>
<span style="color:#75715e"># b.) change or remove the value of &#39;manage_etc_hosts&#39; in</span>
<span style="color:#75715e">#     /etc/cloud/cloud.cfg or cloud-config from user-data</span>
<span style="color:#75715e">#</span>
127.0.1.1 cliente-nginx.novalocal cliente-nginx
127.0.0.1 localhost

10.0.0.5 departamentos.iesgn.org
<span style="color:#75715e"># The following lines are desirable for IPv6 capable hosts</span>
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts

</code></pre></div><ol start="3">
<li>Comprobamos que no podemos acceder desde el exterior (con nuestra máquina física) a la <strong>intranet</strong></li>
</ol>
<p><img src="/images/nginx/intranet_exterior.png" alt="intranet_exterior.png"></p>
<ol start="4">
<li>Comrprobamos que sí podemos acceder desde la red local (máquina cliente) a la <strong>intranet</strong>.</li>
</ol>
<p><img src="/images/nginx/intranet_interior.png" alt="intranet_interior.png"></p>
<ol start="5">
<li>Configuramos el servidor y el cliente para que desde la red local no se pueda acceder a <strong>internet</strong> pero sí desde el exterior.</li>
</ol>
<p>Desde el <strong>servidor</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>

server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/departamentos;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name departamentos.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

        location /intranet <span style="color:#f92672">{</span>
                allow 10.0.0.6/24;
                deny all;
        <span style="color:#f92672">}</span>

        location /internet <span style="color:#f92672">{</span>
                allow 172.23.0.0/16;
                deny all;
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


</code></pre></div><p>Desde el <strong>cliente</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Your system has configured &#39;manage_etc_hosts&#39; as True.</span>
<span style="color:#75715e"># As a result, if you wish for changes to this file to persist</span>
<span style="color:#75715e"># then you will need to either</span>
<span style="color:#75715e"># a.) make changes to the master file in /etc/cloud/templates/hosts.debian.tmpl</span>
<span style="color:#75715e"># b.) change or remove the value of &#39;manage_etc_hosts&#39; in</span>
<span style="color:#75715e">#     /etc/cloud/cloud.cfg or cloud-config from user-data</span>
<span style="color:#75715e">#</span>
127.0.1.1 cliente-nginx.novalocal cliente-nginx
127.0.0.1 localhost

10.0.0.5 departamentos.iesgn.org
<span style="color:#75715e"># The following lines are desirable for IPv6 capable hosts</span>
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts

</code></pre></div><ol start="6">
<li>Comprobamos que podemos acceder desde el exterior con la red pública a &lsquo;internet&rsquo; pero no desde el interior por la red local.</li>
</ol>
<ul>
<li>Red pública:</li>
</ul>
<p><img src="/images/nginx/internet_publica.png" alt="internet_publica.png"></p>
<ul>
<li>Red local:</li>
</ul>
<p><img src="/images/nginx/internet_cliente.png" alt="internet_cliente.png"></p>
<ul>
<li><strong>Tarea 7 (1 punto): Autentificación básica. Limita el acceso a la URL departamentos.iesgn.org/secreto. Comprueba las cabeceras de los mensajes HTTP que se intercambian entre el servidor y el cliente.</strong></li>
</ul>
<p>Creamos el direcotorio secreto en departamentos y le añadimos un index.html</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@servidor-nginx:/home/debian# mkdir /srv/www/departamentos/secreto
root@servidor-nginx:/home/debian# cd /srv/www/departamentos/
root@servidor-nginx:/srv/www/departamentos# ls
index.html  internet  intranet	secreto
root@servidor-nginx:/srv/www/departamentos# cp index.html secreto/
root@servidor-nginx:/srv/www/departamentos# cd secreto/
root@servidor-nginx:/srv/www/departamentos/secreto# ls
index.html
root@servidor-nginx:/srv/www/departamentos/secreto# nano index.html 

</code></pre></div><p>Creamos el fichero .htpasswd con el paquete <strong>apache2-utils</strong> en el directorio /srv</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">htpasswd -cb .htpasswd servidor servidor1
</code></pre></div><p>Configuramos nuestro fichero de configuracion de &lsquo;departamentos&rsquo; y le añadimos la opción de autentificación básica. Apuntamos al fichero /srv/.htpasswd donde tenemos el usuario (servidor) y la contraseña (servidor1) que hemos configurado previamente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Default server configuration</span>

server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/departamentos;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name departamentos.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

        location /intranet <span style="color:#f92672">{</span>
                allow 10.0.0.6/24;
                deny all;
        <span style="color:#f92672">}</span>

        location /internet <span style="color:#f92672">{</span>
                allow 172.23.0.0/16;
                deny all;
        <span style="color:#f92672">}</span>

        location /secreto <span style="color:#f92672">{</span>
                auth_basic <span style="color:#e6db74">&#34;Zona de control&#34;</span>;
                auth_basic_user_file /srv/.htpasswd;
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>Ahora comprobamos que desde nuestra máquina física nos pide usuario y contraseña</p>
<p><img src="/images/nginx/secreto1.png" alt="secreto1.png"></p>
<p><img src="/images/nginx/secreto2.png" alt="secreto2.png"></p>
<p>Vemos las cabeceras http con el comando <strong>curl</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/github/servidor_Nginx$ curl -I departamentos.iesgn.org/secreto
HTTP/1.1 <span style="color:#ae81ff">401</span> Unauthorized
Server: nginx/1.14.2
Date: Wed, <span style="color:#ae81ff">11</span> Nov <span style="color:#ae81ff">2020</span> 13:24:34 GMT
Content-Type: text/html
Content-Length: <span style="color:#ae81ff">195</span>
Connection: keep-alive
WWW-Authenticate: Basic realm<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Zona de control&#34;</span>

</code></pre></div><p>Vemos las cabeceras http con el comando <strong>wget</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celiagm@debian:~/github/servidor_Nginx$ wget -S departamentos.iesgn.org/secreto
--2020-11-11 14:26:09--  http://departamentos.iesgn.org/secreto
Resolviendo departamentos.iesgn.org <span style="color:#f92672">(</span>departamentos.iesgn.org<span style="color:#f92672">)</span>... 172.22.200.152
Conectando con departamentos.iesgn.org <span style="color:#f92672">(</span>departamentos.iesgn.org<span style="color:#f92672">)[</span>172.22.200.152<span style="color:#f92672">]</span>:80... conectado.
Petición HTTP enviada, esperando respuesta... 
  HTTP/1.1 <span style="color:#ae81ff">401</span> Unauthorized
  Server: nginx/1.14.2
  Date: Wed, <span style="color:#ae81ff">11</span> Nov <span style="color:#ae81ff">2020</span> 13:26:09 GMT
  Content-Type: text/html
  Content-Length: <span style="color:#ae81ff">195</span>
  Connection: keep-alive
  WWW-Authenticate: Basic realm<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Zona de control&#34;</span>

La autentificación usuario/contraseña falló.

</code></pre></div><ul>
<li><strong>Tarea 8 (2 punto): Vamos a combinar el control de acceso (tarea 6) y la autentificación (tarea 7), y vamos a configurar el virtual host para que se comporte de la siguiente manera: el acceso a la URL departamentos.iesgn.org/secreto se hace forma directa desde la intranet, desde la red pública te pide la autentificación. Muestra el resultado al profesor.</strong></li>
</ul>
<p>Para ello debemos modificar el fichero de configuración de departaentos en el servidor:</p>
<p>Añadimos estas dos líneas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
                satisfy any;
                allow 10.0.0.0/24;

</code></pre></div><p>De forma que con la directiva <strong>safisfy any</strong> se concede el acceso si un cliente cumple al menos una condición. Es decir se le permite el acceso al cliente y al resto de máquinas que estén conectadas a la red interna, pero se le pide autentificación al resto.</p>
<p>Quedaría tal que así:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">
<span style="color:#75715e"># Default server configuration</span>

server <span style="color:#f92672">{</span>
        listen 80;

        root /srv/www/departamentos;

        <span style="color:#75715e"># Add index.php to the list if you are using PHP</span>
        index index.html index.htm index.nginx-debian.html;

        server_name departamentos.iesgn.org;

        location / <span style="color:#f92672">{</span>
                <span style="color:#75715e"># First attempt to serve request as file, then</span>
                <span style="color:#75715e"># as directory, then fall back to displaying a 404.</span>
                try_files $uri $uri/ <span style="color:#f92672">=</span>404;
        <span style="color:#f92672">}</span>

        location /intranet <span style="color:#f92672">{</span>
                allow 10.0.0.6/24;
                deny all;
        <span style="color:#f92672">}</span>

        location /internet <span style="color:#f92672">{</span>
                allow 172.23.0.0/16;
                deny all;
        <span style="color:#f92672">}</span>

        location /secreto <span style="color:#f92672">{</span>
                satisfy any;
                allow 10.0.0.0/24;
                auth_basic <span style="color:#e6db74">&#34;Zona de control&#34;</span>;
                auth_basic_user_file /srv/.htpasswd;
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>Vemos que que desde fuera nos pide autentificación.</p>
<p>Para que se pueda probar la autentificacion el usuario es <strong>servidor</strong> y la contraseña es <strong>servidor1</strong>.</p>
<p><img src="/images/nginx/secreto3.png" alt="secreto3.png"></p>
<p><img src="/images/nginx/secreto4.png" alt="secreto4.png"></p>
<p>Aquí vemos que desde fuera nos pide la autentifición y desde la intranet nos deja entrar sin autentificación.</p>
<p><img src="/images/nginx/secreto5.png" alt="secreto5.png"></p>
]]></content>
        </item>
        
        <item>
            <title>Compilar un programa en C con Makefile</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/compilar-un-programa-en-c-con-makefile/</link>
            <pubDate>Sat, 31 Oct 2020 18:13:42 +0100</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/compilar-un-programa-en-c-con-makefile/</guid>
            <description>Compilación de un programa en C utilizando un Makefile Requisitos previos  Suponemos que tenemos una máquina virtual con Debian Buster, en este caso voy a usar Vagrant con qemu-kvm para crearla. Necesitaremos tener instalado los paquetes necesarios (vagrant, qemu-kvm, virt-manager&amp;hellip;).  Usaremos el siguiente fichero Vagrantfile:
Vagrant.configure(&amp;#34;2&amp;#34;) do |config| config.vm.box = &amp;#34;debian/buster64&amp;#34; config.vm.hostname = &amp;#34;buster&amp;#34; config.vm.synced_folder &amp;#34;.&amp;#34;, &amp;#34;/vagrant&amp;#34;, disabled: true config.vm.provider :libvirt do |libvirt| libvirt.uri = &amp;#39;qemu+unix:///system&amp;#39; libvirt.host = &amp;#34;debian&amp;#34; libvirt.</description>
            <content type="html"><![CDATA[<h1 id="compilación-de-un-programa-en-c-utilizando-un-makefile">Compilación de un programa en C utilizando un Makefile</h1>
<h2 id="requisitos-previos">Requisitos previos</h2>
<ul>
<li>Suponemos que tenemos una máquina virtual con Debian Buster, en este caso voy a usar <strong>Vagrant</strong> con <strong>qemu-kvm</strong> para crearla. Necesitaremos tener instalado los paquetes necesarios (vagrant, qemu-kvm, virt-manager&hellip;).</li>
</ul>
<p>Usaremos el siguiente fichero Vagrantfile:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Vagrant.configure<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">do</span> |config|
    config.vm.box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian/buster64&#34;</span>
    config.vm.hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;buster&#34;</span>
    config.vm.synced_folder <span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#e6db74">&#34;/vagrant&#34;</span>, disabled: true
    config.vm.provider :libvirt <span style="color:#66d9ef">do</span> |libvirt|
        libvirt.uri <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;qemu+unix:///system&#39;</span>
        libvirt.host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debian&#34;</span>
        libvirt.cpus <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        libvirt.memory <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
    end
end
</code></pre></div><ul>
<li>La máquina deberá estar actualizada y con los repositorios en orden</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nano /etc/apt/souces.list
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">deb http://deb.debian.org/debian buster main
deb-src http://deb.debian.org/debian buster main

deb http://deb.debian.org/debian-security/ buster/updates main
deb-src http://deb.debian.org/debian-security/ buster/updates main

deb http://deb.debian.org/debian buster-updates main
deb-src http://deb.debian.org/debian buster-updates main

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt update
sudo apt upgrade
</code></pre></div><ul>
<li>Ademas necesitaremos instalar algunos paquetes claves que nos pedirá al hacer la compilación e instalación de nuestro paquete. Uno de ellos lo vamos a descargar ya. Se trata de un paquete que contiene una lista informativa de los paquetes que se consideran esenciales para la creación de paquetes Debian, este es <strong>build-essential</strong>.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get install build-essential
</code></pre></div><h2 id="programa-escrito-en-c-lynx">Programa escrito en C: Lynx</h2>
<p><strong>Lynx</strong> es un navegador web y cliente de gopher en modo texto. Este navegador es usado desde la linea de comandos, en terminales. Es muy útil para sistemas sin entorno gráfico y a la vez es fácil e intuitivo para su manejo.</p>
<p>Está escrito en C, y en las fuentes aparece un fichero Makefile para poder compilarlo.</p>
<ul>
<li>
<p><a href="https://packages.debian.org/buster/lynx">Información oficial del paquete</a></p>
</li>
<li>
<p><a href="https://sources.debian.org/src/lynx/2.8.9rel.1-3/">Contenido del paquete</a></p>
</li>
</ul>
<h3 id="descargar-las-fuentes">Descargar las fuentes</h3>
<ul>
<li>Primero vamos a ubicarnos en un sitio adecuado para descargar las fuentes. En este caso vamos a /usr/local para no interferir con otros archivos del sistema y creamos una carpeta llamada lynx.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd /usr/local
mkdir lynx
</code></pre></div><ul>
<li>Vamos a descargarnos el código fuente:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt source lynx
</code></pre></div><ul>
<li>Vemos el contenido:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx# ls
lynx-2.8.9rel.1			 lynx_2.8.9rel.1-3.dsc	       lynx_2.8.9rel.1.orig.tar.bz2.asc
lynx_2.8.9rel.1-3.debian.tar.xz  lynx_2.8.9rel.1.orig.tar.bz2


</code></pre></div><ul>
<li>Descomprimimos</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo tar -xjvf lynx_2.8.9rel.1.orig.tar.bz2 

</code></pre></div><ul>
<li>Vemos el contenido de nuestra carpeta descomprimida</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vagrant@buster:/usr/local/lynx/lynx2.8.9rel.1$ ls
ABOUT-NLS       COPYING.asc      VMSPrint.com  config.guess  fixed512.com  make-msc.bat  samples
AUTHORS         INSTALLATION     WWW           config.hin    install-sh    makefile.bcb  scripts
BUILD           LYHelp.hin       aclocal.m4    config.sub    lib           makefile.in   src
CHANGES         LYMessages_en.h  bcblibs.bat   configure     lynx.cfg      makefile.msc  test
COPYHEADER      PACKAGE          build.bat     configure.in  lynx.hlp      makelynx.bat  userdefs.h
COPYHEADER.asc  PROBLEMS         build.com     descrip.mms   lynx.man      makew32.bat
COPYING         README           clean.com     docs          lynx_help     po

</code></pre></div><p>Como podemos comprobar hay un fichero llamado <em>INSTALLATION</em>, que nos va a indicar como tenemos que compilar e instalar lynx.</p>
<h3 id="autoconfigurar-debemos-utilizar-configure">Autoconfigurar. Debemos utilizar ./configure</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx/lynx2.8.9rel.1# ./configure
</code></pre></div><ul>
<li>Nos encontramos con el siguiente error:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">configure: WARNING: pkg-config is not installed

</code></pre></div><p>Nos está diciendo que necesitamos un paquete esencial para la compilación, lo instalamos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt-get install pkg-config
</code></pre></div><ul>
<li>Volvemos a ejecutar <strong>./configure</strong> y encontramos otro error:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">configure: error: No curses header-files found
</code></pre></div><p>Buscando este error por internet, he encontrado que se debe a que necesita una biblioteca que permite escribir interfaces basadas en texto llamada Ncurses. En concreto nos hace falta una librería que es la siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt-get install libncurses5-dev
</code></pre></div><ul>
<li>Volvemos a ejecutar configure y vemos que ahora se ejecuta perfectamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./configure
</code></pre></div><p>Haz click aquí para ver la salida -&raquo; <a href="https://github.com/CeliaGMqrz/utilidades/blob/main/salida.md">salida</a></p>
<h3 id="compilar-makefile">COMPILAR. MAKEFILE</h3>
<ul>
<li>Según la guía de <em>INSTALLATION</em> ahora tenemos que ejecutar <strong>make</strong> para crear los objetos y archivos necesarios.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make
</code></pre></div><ul>
<li>Estas son las últimas líneas que nos han salido:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Copying Lynx executable into top-level directory
rm -f ../lynx
cp lynx ../
Welcome to Lynx!
make<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Leaving directory <span style="color:#e6db74">&#39;/usr/local/lynx/lynx2.8.9rel.1/src&#39;</span>

</code></pre></div><ul>
<li>Vamos al directorio que nos ha creado y vemos donde están todos los ficheros objetos:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd lynx/lynx2.8.9rel.1/src/

</code></pre></div><p><img src="/images/objetos.png" alt="objetos.png"></p>
<ul>
<li>Ahora deberemos de hacer un <em>make install</em> en el directorio adecuado:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx/lynx2.8.9rel.1# make install
/bin/sh -c <span style="color:#e6db74">&#34;P=`echo lynx|sed &#39;s,x,x,&#39;`; \
</span><span style="color:#e6db74">if test -f /usr/local/bin/</span>$P<span style="color:#e6db74"> ; then \
</span><span style="color:#e6db74">      mv -f /usr/local/bin/</span>$P<span style="color:#e6db74"> /usr/local/bin/</span>$P<span style="color:#e6db74">.old; fi&#34;</span>
/usr/bin/install -c lynx /usr/local/bin/<span style="color:#e6db74">`</span>echo lynx|sed <span style="color:#e6db74">&#39;s,x,x,&#39;</span><span style="color:#e6db74">`</span>
mkdir -p /usr/local/share/man/man1
/usr/bin/install -c -m <span style="color:#ae81ff">644</span> ./lynx.man /usr/local/share/man/man1/<span style="color:#e6db74">`</span>echo lynx|sed <span style="color:#e6db74">&#39;s,x,x,&#39;</span><span style="color:#e6db74">`</span>.1
** installing ./lynx.cfg as /usr/local/etc/lynx.cfg
** installing ./samples/lynx.lss as /usr/local/etc/lynx.lss

Use make install-help to install the help-files
Use make install-doc to install extra documentation files

</code></pre></div><p>Después de todo esto ya tendriamos instalado <strong>lynx</strong>, nos muestra cómo podemos instalar la ayuda y la documentación extra.</p>
<ul>
<li>Ahora ejecutamos <strong>lynx</strong> y vemos que funciona perfectamente.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">lynx www.google.es
</code></pre></div><p><img src="/images/googlelynx.png" alt="googlelynx.png"></p>
<h2 id="instalar-la-ayuda">Instalar la ayuda</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx/lynx2.8.9rel.1# make install-help
mkdir -p /usr/local/share/lynx_help
/bin/sh -c <span style="color:#e6db74">&#39;if cd &#34;/usr/local/share/lynx_help&#34; ; then \
</span><span style="color:#e6db74">	WD=`pwd` ; \
</span><span style="color:#e6db74">	TAIL=`basename &#34;/usr/local/share/lynx_help&#34;` ; \
</span><span style="color:#e6db74">	HEAD=`echo &#34;$WD&#34;|sed -e &#34;s,/${TAIL}$,,&#34;` ; \
</span><span style="color:#e6db74">	test &#34;x$WD&#34; != &#34;x$HEAD&#34; &amp;&amp; rm -fr * ; \
</span><span style="color:#e6db74">	fi&#39;</span>
test -d /usr/local/share/lynx_help/keystrokes <span style="color:#f92672">||</span> mkdir /usr/local/share/lynx_help/keystrokes
Translating/copying html files
/bin/sh -c <span style="color:#e6db74">&#39;sed_prog=`pwd`/help_files.sed &amp;&amp; \
</span><span style="color:#e6db74">	cd ./lynx_help &amp;&amp; \
</span><span style="color:#e6db74">	dirs=keystrokes &amp;&amp; \
</span><span style="color:#e6db74">	files=&#34;*.html */*.html&#34; &amp;&amp; \
</span><span style="color:#e6db74">	for f in $files ; do \
</span><span style="color:#e6db74">		sed -f $sed_prog $f &gt; /usr/local/share/lynx_help/$f ; \
</span><span style="color:#e6db74">	done &amp;&amp; \
</span><span style="color:#e6db74">	if test &#34;&#34; != &#34;&#34; ; then \
</span><span style="color:#e6db74">		(cd /usr/local/share/lynx_help &amp;&amp;  $files ) \
</span><span style="color:#e6db74">	fi&#39;</span>
Updating /usr/local/etc/lynx.cfg
/bin/sh -c <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#39;if test -f /usr/local/etc/lynx.cfg ; then \
</span><span style="color:#e6db74">	mv /usr/local/etc/lynx.cfg /usr/local/etc/lynx.tmp ; \
</span><span style="color:#e6db74">else \
</span><span style="color:#e6db74">	cp ./lynx.cfg /usr/local/etc/lynx.tmp ; \
</span><span style="color:#e6db74">fi&#39;</span>
Updating /usr/local/etc/lynx.cfg to point to installed help-files
sed	-e <span style="color:#e6db74">&#39;/^HELPFILE:http/s!^!#!&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	-e <span style="color:#e6db74">&#39;/^#HELPFILE:file/s!#!!&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	/usr/local/etc/lynx.tmp | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>/bin/sh ./scripts/cfg_path.sh lynx_help /usr/local/share/lynx_help | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>/bin/sh ./scripts/cfg_path.sh lynx_doc  /usr/local/share/lynx_help | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>sed	-e <span style="color:#e6db74">&#39;/^HELPFILE:file/s!$!!&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	-e <span style="color:#e6db74">&#39;/^HELPFILE:file/s!$!!&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	&gt;/usr/local/etc/lynx.cfg
chmod <span style="color:#ae81ff">644</span> /usr/local/etc/lynx.cfg
rm -f /usr/local/etc/lynx.tmp

</code></pre></div><ul>
<li>Comprobamos que tenemos la ayuda instalada</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx/lynx2.8.9rel.1# lynx --help
USAGE: lynx <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
Options are:
  -                 receive options and arguments from stdin
  -accept_all_cookies 
                    accept cookies without prompting <span style="color:#66d9ef">if</span> Set-Cookie handling
                    is on <span style="color:#f92672">(</span>off<span style="color:#f92672">)</span>
  -anonymous        apply restrictions <span style="color:#66d9ef">for</span> anonymous account,
                    see also -restrictions
  -assume_charset<span style="color:#f92672">=</span>MIMEname
                    charset <span style="color:#66d9ef">for</span> documents that don<span style="color:#960050;background-color:#1e0010">&#39;</span>t specify it
  -assume_local_charset<span style="color:#f92672">=</span>MIMEname
                    charset assumed <span style="color:#66d9ef">for</span> local files
  -assume_unrec_charset<span style="color:#f92672">=</span>MIMEname
                    use this instead of unrecognized charsets
  -auth<span style="color:#f92672">=</span>id:pw       authentication information <span style="color:#66d9ef">for</span> protected documents
  -base             prepend a request URL comment and BASE tag to text/html
                    outputs <span style="color:#66d9ef">for</span> -source dumps
  -bibhost<span style="color:#f92672">=</span>URL      local bibp server <span style="color:#f92672">(</span>default http://bibhost/<span style="color:#f92672">)</span>
  -book             use the bookmark page as the startfile <span style="color:#f92672">(</span>off<span style="color:#f92672">)</span>
  -buried_news      toggles scanning of news articles <span style="color:#66d9ef">for</span> buried references <span style="color:#f92672">(</span>on<span style="color:#f92672">)</span>
  -cache<span style="color:#f92672">=</span>NUMBER     NUMBER of documents cached in memory

</code></pre></div><ul>
<li>También podemos instalar la documentación</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/usr/local/lynx/lynx2.8.9rel.1# make install-doc
mkdir -p /usr/local/share/lynx_doc
Copying sample files
/bin/sh -c <span style="color:#e6db74">&#39;\
</span><span style="color:#e6db74">	( umask 022; \
</span><span style="color:#e6db74">	  cd . &amp;&amp; \
</span><span style="color:#e6db74">	  /usr/bin/tar -cf - C[HO]* PROBLEMS README docs samples test ) | \
</span><span style="color:#e6db74">	( umask 022; \
</span><span style="color:#e6db74">	  cd /usr/local/share/lynx_doc &amp;&amp; \
</span><span style="color:#e6db74">	  chmod -R u+w . &amp;&amp; /usr/bin/tar -xf - )&#39;</span>
/bin/sh -c <span style="color:#e6db74">&#39;if test &#34;&#34; != &#34;&#34; ; then \
</span><span style="color:#e6db74">	(cd /usr/local/share/lynx_doc &amp;&amp;  -f docs/CHANGES*.[0-9] docs/*.announce ) \
</span><span style="color:#e6db74">fi&#39;</span>
/bin/sh -c <span style="color:#e6db74">&#39;for name in COPYING COPYHEADER; do \
</span><span style="color:#e6db74">	cd /usr/local/share/lynx_help &amp;&amp; rm -f $name ;\
</span><span style="color:#e6db74">	r= ;\
</span><span style="color:#e6db74">	test &#34;ln -s&#34; = &#34;ln -s&#34; || r=`echo /usr/local/share/lynx_help|sed -e &#34;s%[^/]\+%..%g&#34; -e &#34;s%^.%%&#34;`; \
</span><span style="color:#e6db74">	cd /usr/local/share/lynx_help &amp;&amp; ( ln -s $r/usr/local/share/lynx_doc/$name . || cp /usr/local/share/lynx_doc/$name . );\
</span><span style="color:#e6db74">	done&#39;</span>
/bin/sh -c <span style="color:#e6db74">&#39;case `id|sed -e &#34;s/(.*//&#34;` in uid=0) chown -R root /usr/local/share/lynx_doc;; esac&#39;</span>

</code></pre></div><ul>
<li>Miramos donde está instalado el paquete</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@buster:/home/vagrant# whereis lynx
lynx: /usr/local/bin/lynx /usr/local/etc/lynx.lss /usr/local/etc/lynx.cfg /usr/local/lynx

root@buster:/home/vagrant# which lynx
/usr/local/bin/lynx
</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Cifrado Asimétrico con GPG y OpenSSL</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/cifrado-asim%C3%A9trico-con-gpg-y-openssl/</link>
            <pubDate>Sat, 24 Oct 2020 14:45:15 +0200</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/cifrado-asim%C3%A9trico-con-gpg-y-openssl/</guid>
            <description>Práctica: Cifrado asimétrico con gpg y openssl En esta práctica vamos a cifrar ficheros utilizando cifrado asimétrico utilizando el programa gpg.
Cifrado Asimétrico con GPG   Tarea 1: Generación de claves
  Tarea 2: Importar / exportar clave pública
  Tarea 3: Cifrado asimétrico con claves públicas
  Tarea 4: Exportar clave a un servidor público de claves PGP
  Cifrado asimétrico con OPENSSL  Tarea 5: Cifrado asimétrico con openssl  </description>
            <content type="html"><![CDATA[<h1 id="práctica-cifrado-asimétrico-con-gpg-y-openssl">Práctica: Cifrado asimétrico con gpg y openssl</h1>
<p>En esta práctica vamos a cifrar ficheros utilizando cifrado asimétrico utilizando el programa gpg.</p>
<h2 id="cifrado-asimétrico-con-gpg">Cifrado Asimétrico con GPG</h2>
<ul>
<li>
<p>Tarea 1: <a href="https://github.com/CeliaGMqrz/cifrado_asimetrico_gpg_openssl/blob/main/cifrado_asim%C3%A9trico_gpg_openssl.md">Generación de claves</a></p>
</li>
<li>
<p>Tarea 2: <a href="https://github.com/CeliaGMqrz/cifrado_asimetrico_gpg_openssl/blob/main/importar_exportar_clavepub.md">Importar / exportar clave pública</a></p>
</li>
<li>
<p>Tarea 3: <a href="https://github.com/CeliaGMqrz/cifrado_asimetrico_gpg_openssl/blob/main/cifrado_asimetrico_claves_publicas.md">Cifrado asimétrico con claves públicas</a></p>
</li>
<li>
<p>Tarea 4: <a href="https://github.com/CeliaGMqrz/cifrado_asimetrico_gpg_openssl/blob/main/exportar_servidor_publico.md">Exportar clave a un servidor público de claves PGP</a></p>
</li>
</ul>
<h2 id="cifrado-asimétrico-con-openssl">Cifrado asimétrico con OPENSSL</h2>
<ul>
<li>Tarea 5: <a href="https://github.com/CeliaGMqrz/cifrado_asimetrico_gpg_openssl/blob/main/asimetrico_openssl.md">Cifrado asimétrico con openssl</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Guia de Virtual Hosting Con Apache</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/guia-de-virtual-hosting-con-apache/</link>
            <pubDate>Wed, 21 Oct 2020 21:54:22 +0200</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/guia-de-virtual-hosting-con-apache/</guid>
            <description>VirtualHosting con Apache Conceptos previos ¿Qué es un sitio web? Un sitio web es un conjunto de páginas web, propiamente dicho. Las páginas están relacionadas entre sí. Y a ese sitio web se accede en una dirección ip y a través de un puerto(80). Normalmente si cambiamos la ip o el puerto serviría otro sitio web.
¿Qué es Hosting Virtual? El término Hosting Virtual se refiere a hacer funcionar más de un sitio web (tales como www.</description>
            <content type="html"><![CDATA[<h1 id="virtualhosting-con-apache">VirtualHosting con Apache</h1>
<h2 id="conceptos-previos">Conceptos previos</h2>
<h3 id="qué-es-un-sitio-web">¿Qué es un sitio web?</h3>
<p>Un sitio web es un conjunto de páginas web, propiamente dicho. Las páginas están relacionadas entre sí. Y a ese sitio web se accede en una dirección ip y a través de un puerto(80). Normalmente si cambiamos la ip o el puerto serviría otro sitio web.</p>
<h3 id="qué-es-hosting-virtual">¿Qué es Hosting Virtual?</h3>
<p>El término <strong>Hosting Virtual</strong> se refiere a hacer funcionar más de un sitio web (tales como <a href="http://www.company1.com">www.company1.com</a> y <a href="http://www.company2.com">www.company2.com</a>) en una sola máquina. Los sitios web virtuales pueden estar “basados en direcciones IP”, lo que significa que cada sitio web tiene una dirección IP diferente, o “basados en nombres diferentes”, lo que significa que con una sola dirección IP están funcionando sitios web con diferentes nombres (de dominio). Apache fue uno de los primeros servidores web en soportar hosting virtual basado en direcciones IP.</p>
<p>En definitiva:</p>
<p>Usando virtualhosting, el servidor desde una misma ip y desde el mismo puerto puede servir <strong>varios sitios web</strong>. Y cada uno podemos acceder por separado. Esto lo hace de manera que las peticiones al servidor se hacen con un <strong>nombre</strong> configurado en la <strong>cabecera host del servidor</strong>. Dependiendo del nombre con el que se acceda al servidor servirá un sitio o otro.</p>
<p>En Apache hay configurado un virtualhost por defecto. Se llama <strong>default</strong>. El server name no está indicado, es decir que podemos entrar con cualquier nombre o con la misma dirección ip. El document root donde están los ficheros es <strong>/var/www/html</strong>.</p>
<h2 id="objetivo">Objetivo</h2>
<p>El objetivo de esta práctica es la puesta en marcha de dos sitios web utilizando el mismo servidor web apache. Hay que tener en cuenta lo siguiente:</p>
<ul>
<li>
<p>Cada sitio web tendrá nombres distintos.</p>
</li>
<li>
<p>Cada sitio web compartirán la misma dirección IP y el mismo puerto (80).</p>
</li>
</ul>
<p>Queremos construir en nuestro servidor web apache dos sitios web con las siguientes características:</p>
<ul>
<li>
<p>El nombre de dominio del primero será <a href="http://www.iesgn.org">www.iesgn.org</a>, su directorio base será /var/www/iesgn y contendrá una página llamada index.html, donde sólo se verá una bienvenida a la página del Instituto Gonzalo Nazareno.</p>
</li>
<li>
<p>En el segundo sitio vamos a crear una página donde se pondrán noticias por parte de los departamento, el nombre de este sitio será <a href="http://www.departamentosgn.org">www.departamentosgn.org</a>, y su directorio base será /var/www/departamentos. En este sitio sólo tendremos una página inicial index.html, dando la bienvenida a la página de los departamentos del instituto.</p>
</li>
</ul>
<h2 id="1-crear-los-ficheros-de-configuración-para-cada-sitio-web">1. Crear los ficheros de configuración para cada sitio web</h2>
<p>Los ficheros de configuración de los sitios webs se encuentran en el directorio <strong>/etc/apache2/sites-available</strong>, por defecto hay dos ficheros, uno se llama &lsquo;000-default.conf&rsquo; que es la configuración del sitio web por defecto. Necesitamos tener dos ficheros para realizar la configuración de los dos sitios virtuales, para ello vamos a copiar el fichero 000-default.conf:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@mimaquina:/etc/apache2# cd sites-available/

root@mimaquina:/etc/apache2/sites-available# ls
000-default.conf  default-ssl.conf

root@mimaquina:/etc/apache2/sites-available# cp 000-default.conf iesgn.conf

root@mimaquina:/etc/apache2/sites-available# cp 000-default.conf departamentos.conf

root@mimaquina:/etc/apache2/sites-available# ls
000-default.conf  default-ssl.conf  departamentos.conf	iesgn.conf

</code></pre></div><p>De esta manera tendremos un fichero llamado <strong>iesgn.conf</strong> para realizar la configuración del sitio web <strong><a href="http://www.iesgn.org">www.iesgn.org</a></strong>, y otro llamado <strong>departamentos.conf</strong> para el sitio web <strong><a href="http://www.departamentosgn.org">www.departamentosgn.org</a></strong>.</p>
<h2 id="2-modificar-los-ficheros-de-configuración">2. Modificar los ficheros de configuración</h2>
<p>Modificamos los ficheros iesgn.conf y departamentos.conf, para indicar el nombre que vamos ausar para acceder al host virtual (ServerName) y el directorio de trabajo (DocumentRoot).</p>
<ul>
<li>Editamos iesgn.conf:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">        ServerName www.iesgn.org

        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/iesgn
</code></pre></div><ul>
<li>Editamos departamentos.conf:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">        ServerName www.departamentosgn.org

        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/departamentosgn
</code></pre></div><h2 id="3-crear-enlace-simbólico">3. Crear enlace simbólico</h2>
<p>No es suficiente crear los ficheros de configuración de cada sitio web, es necesario crear un enlace simbólico a estos ficheros dentro del directorio <strong>/etc/apache2/sites-enabled</strong>, para ello:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@mimaquina:~# a2ensite iesgn.conf
Enabling site iesgn.
To activate the new configuration, you need to run:
  systemctl reload apache2
root@mimaquina:~# a2ensite departamentos
Enabling site departamentos.
To activate the new configuration, you need to run:
  systemctl reload apache2


root@mimaquina:/etc/apache2/sites-enabled# ls
000-default.conf  departamentos.conf  iesgn.conf

</code></pre></div><p>La creación de los enlaces simbólicos se puede hacer con la instrucción <strong>a2ensite nombre_fichero_configuracion</strong>, para deshabilitar el sitio tenemos que borrar el enlace simbólico o usar la instrucción <strong>a2dissite nombre_fichero_configuracion</strong>.</p>
<h2 id="4-crear-indexhtml-necesario">4. Crear index.html necesario</h2>
<p>Crea los directorios y los ficheros index.html necesarios en /var/www y reiniciamos el servicio.</p>
<ul>
<li>Creamos el directorio &lsquo;iesgn&rsquo; con su index.html</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@mimaquina:/var/www# mkdir iesgn
root@mimaquina:/var/www# cd iesgn/
root@mimaquina:/var/www/iesgn# nano index.html

</code></pre></div><ul>
<li>Creamos el directorio &lsquo;departamentosgn&rsquo; con su index.html</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@mimaquina:/var/www# mkdir departamentosgn
root@mimaquina:/var/www# cd departamentosgn/
root@mimaquina:/var/www/departamentosgn# ls
root@mimaquina:/var/www/departamentosgn# cp ../iesgn/index.html index.html
root@mimaquina:/var/www/departamentosgn# ls
index.html
root@mimaquina:/var/www/departamentosgn# nano index.html 
</code></pre></div><ul>
<li>Le damos los propietarios adecuados:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@mimaquina:~# chown -R www-data:www-data /var/www/departamentosgn
root@mimaquina:~# chown -R www-data:www-data /var/www/iesgn

</code></pre></div><ul>
<li>Reiniciamos el servicio</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># systemctl reload apache2</span>
</code></pre></div><h2 id="5-modificar-fichero-hosts-de-nuestra-máquina-física">5. Modificar fichero hosts de nuestra máquina física</h2>
<p>Para terminar lo único que tendremos que hacer es cambiar el fichero hosts en los clientes y poner dos nuevas líneas donde se haga la conversión entre los dos nombre de dominio y la dirección IP del servidor.</p>
<p>Le ponemos la dirección del servidor, osea la ip de nuestra máquina virtual, que, en este caso está conectada por un puente a nuestra anfitriona.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  GNU nano 3.2                      /etc/hosts                                

127.0.0.1       localhost
127.0.1.1       mimaquina       mimaquina

192.168.100.143      www.iesgn.org
192.168.100.143      www.departamentosgn.org
<span style="color:#75715e"># The following lines are desirable for IPv6 capable hosts</span>
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters


</code></pre></div><ul>
<li>Hacemos ping a las urls desde nuestra máquina anfitriona</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">celia@debian:~/vagrant/virtualhosting$ ping www.departamentosgn.org
PING www.departamentosgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from www.iesgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.406 ms
<span style="color:#ae81ff">64</span> bytes from www.iesgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.374 ms
^C
--- www.departamentosgn.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 15ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.374/0.390/0.406/0.016 ms


celia@debian:~/vagrant/virtualhosting$ ping www.iesgn.org
PING www.iesgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span> 56<span style="color:#f92672">(</span>84<span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from www.iesgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.389 ms
<span style="color:#ae81ff">64</span> bytes from www.iesgn.org <span style="color:#f92672">(</span>192.168.100.143<span style="color:#f92672">)</span>: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span>0.396 ms
^C
--- www.iesgn.org ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, 0% packet loss, time 16ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> 0.389/0.392/0.396/0.020 ms
celia@debian:~/vagrant/virtualhosting$ 

</code></pre></div><ul>
<li>Lo vemos desde nuestro navegador en la máquina anfitriona:</li>
</ul>
<p><strong><a href="http://www.iesgn.org">www.iesgn.org</a></strong>
<img src="/images/cap2.jpeg" alt="cap2.jpeg"></p>
<p><strong><a href="http://www.departamentosgn.org">www.departamentosgn.org</a></strong>
<img src="/images/cap1.jpeg" alt="cap1.jpeg"></p>
<h3 id="repite-el-ejercicio-cambiando-los-directorios-de-trabajo-a-srvwww-qué-modificación-debes-hacer-en-el-fichero-etcapache2apache2conf">Repite el ejercicio cambiando los directorios de trabajo a /srv/www. ¿Qué modificación debes hacer en el fichero /etc/apache2/apache2.conf?</h3>
<p>Sería el mismo procedimiento solo que debemos editar el fichero de configuración de apache2.conf de la siguiente forma. Comentando el directorio que coge por defecto y descomentando el nuevo directorio. En él podemos copiar las carpetas que teniamos en www y hacemos el mismo procedimiento, cambiando el documenroot a los ficheros de configuracion antes de iniciarlos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#&lt;Directory /var/www/&gt;</span>
<span style="color:#75715e">#        Options Indexes FollowSymLinks</span>
<span style="color:#75715e">#        AllowOverride None</span>
<span style="color:#75715e">#        Require all granted</span>
<span style="color:#75715e">#&lt;/Directory&gt;</span>

&lt;Directory /srv/&gt;
       Options Indexes FollowSymLinks
       AllowOverride None
       Require all granted
&lt;/Directory&gt;

</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Instalación de VisualCode en Debian Buster</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/instalaci%C3%B3n-de-visualcode-en-debian-buster/</link>
            <pubDate>Thu, 15 Oct 2020 22:22:11 +0200</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/instalaci%C3%B3n-de-visualcode-en-debian-buster/</guid>
            <description>Instalar Visual Code en Debian 10 Instalar dependencias.
$ sudo apt install software-properties-common apt-transport-https Descargamos la llave GPG del repositorio.
sudo wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add - Introducimos el repositorio correspondiente
$ sudo add-apt-repository &amp;#34;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main&amp;#34; Actualizamos los paquetes
$ sudo apt update Instalamos Visual Code.
$ sudo apt-get install code </description>
            <content type="html"><![CDATA[<h3 id="instalar-visual-code-en-debian-10">Instalar Visual Code en Debian 10</h3>
<p><img src="/images/vscode.png" alt="image"></p>
<p>Instalar dependencias.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt install software-properties-common apt-transport-https
</code></pre></div><p>Descargamos la llave GPG del repositorio.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add -
</code></pre></div><p>Introducimos el repositorio correspondiente</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo add-apt-repository <span style="color:#e6db74">&#34;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main&#34;</span>
</code></pre></div><p>Actualizamos los paquetes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt update
</code></pre></div><p>Instalamos Visual Code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt-get install code
</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Instalación de Virtualbox en Debian Buster</title>
            <link>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/instalaci%C3%B3n-de-virtualbox-en-debian-buster/</link>
            <pubDate>Thu, 15 Oct 2020 15:50:23 +0200</pubDate>
            
            <guid>https://unbitdeinformacioncadadia.netlify.app/posts/2020/10/instalaci%C3%B3n-de-virtualbox-en-debian-buster/</guid>
            <description>Instalar Virtualbox 6.0 en Debian Buster VirtualBox no viene en el repositorio predeterminado de Debian 10, por tanto lo instalaremos desde el repositorio oficial de Oracle. Para ello vamos a agregar el repositorio en el fichero correspondiente:
$ sudo nano /etc/apt/sources.list Añadimos el repositorio y guardamos el fichero.
deb https://download.virtualbox.org/virtualbox/debian buster contrib Descargamos e importamos la clave pública de Oracle GPG en nuestro Debian 10.
$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add - Actualizamos los paquetes</description>
            <content type="html"><![CDATA[<h3 id="instalar-virtualbox-60-en-debian-buster">Instalar Virtualbox 6.0 en Debian Buster</h3>
<p><img src="/images/vbox.jpg" alt="image"></p>
<p>VirtualBox no viene en el repositorio predeterminado de Debian 10, por tanto lo instalaremos desde el repositorio oficial de Oracle.
Para ello vamos a agregar el repositorio en el fichero correspondiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo nano /etc/apt/sources.list
</code></pre></div><p>Añadimos el repositorio y guardamos el fichero.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">deb https://download.virtualbox.org/virtualbox/debian buster contrib
</code></pre></div><p>Descargamos e importamos la clave pública de Oracle GPG en nuestro Debian 10.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -
</code></pre></div><p>Actualizamos los paquetes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt update
</code></pre></div><p>Instalamos la versión que queramos de virtualbox</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ apt search virtualbox
$ sudo apt-get install virtualbox-6.0
</code></pre></div>]]></content>
        </item>
        
    </channel>
</rss>
